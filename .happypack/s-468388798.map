{"version":3,"sources":["src/Containers/Operation/CustomerManage/AgreementList/Renew/Edit/index.js"],"names":["JoinCreate","params","props","context","openConfirmCreateDialog","bind","onCreateSubmit","onCancel","state","stationVos","initialValues","optionValues","formValues","openConfirmCreate","dispatch","console","log","callAPI","then","response","show","message","type","ajaxListData","cityName","communityName","createDateBegin","createDateEnd","createrName","customerName","page","pageSize","salerName","openEditAgreement","catch","err","setState","_this","customerId","mainBillId","orderId","communityId","contractstate","mainbillid","signdate","Date","getTime","communityAddress","customer","leaseAddress","customerAddress","contracttype","fnaCorporationList","fnaCorporation","map","item","index","value","id","label","corporationName","paymentList","payment","dicName","payTypeList","payType","floorList","floor","communityid","mainbillCommunityId","lessorContactName","contractFileList","leaseId","contractcode","leaseContact","leaseContacttel","lessorContactid","firstpaydate","paymodel","totaldeposit","paytype","rentaluse","contractmark","totalrent","contractVersionType","contractVersion","rentamount","lessorContacttel","leaseBegindate","leaseEnddate","marginTop","onConfrimSubmit","contextTypes","PropTypes","object","isRequired","childContextTypes"],"mappings":";;;;;;;;;AAAA;;;;AAIA;;AAMA;;AAIA;;;;AAEA;;AASA;;;;AACA;;;;AACA;;AACA;;;;;;;;;;;;IACqBA,U;;;;;sCASD;AACZ,aAAO;AACHC,gBAAQ,KAAKC,KAAL,CAAWD;AADhB,OAAP;AAGC;;;AAEP,sBAAYC,KAAZ,EAAmBC,OAAnB,EAA4B;AAAA;;AAAA,yHACpBD,KADoB,EACbC,OADa;;AAG1B,WAAKC,uBAAL,GAA+B,OAAKA,uBAAL,CAA6BC,IAA7B,QAA/B;AACA,WAAKC,cAAL,GAAsB,OAAKA,cAAL,CAAoBD,IAApB,QAAtB;AACA,WAAKE,QAAL,GAAgB,OAAKA,QAAL,CAAcF,IAAd,QAAhB;;AAEA,WAAKG,KAAL,GAAa;AACXC,kBAAY,EADD;AAEXC,qBAAe,EAFJ;AAGXC,oBAAc,EAHH;AAIXC,kBAAY,EAJD;AAKXC,yBAAmB;AALR,KAAb;;AAQA,iBAAMC,QAAN,CAAe,sBAAM,kBAAN,CAAf;;AAf0B;AAiB3B;;;;mCAEcF,U,EAAY;AAAA,UAEvBX,MAFuB,GAGrB,KAAKC,KAHgB,CAEvBD,MAFuB;;AAIzBc,cAAQC,GAAR,CAAY,YAAZ;;AAEA,mBAAMF,QAAN,CAAe,eAAQG,OAAR,CAAgB,2BAAhB,EAA6C,EAA7C,EAAiDL,UAAjD,CAAf,EAA6EM,IAA7E,CAAkF,UAASC,QAAT,EAAmB;AACnG,qBAAOC,IAAP,CAAY,CAAC;AACXC,mBAAS,MADE;AAEXC,gBAAM;AAFK,SAAD,CAAZ;AAIA,wBAASC,YAAT,CAAsB,EAACC,UAAS,EAAV,EAAaC,eAAc,EAA3B,EAA8BC,iBAAgB,EAA9C,EAAiDC,eAAc,EAA/D,EAAkEC,aAAY,EAA9E,EAAiFC,cAAa,EAA9F,EAAiGC,MAAK,EAAtG,EAAyGC,UAAS,EAAlH,EAAqHC,WAAU,EAA/H,EAAtB;AACA,wBAASC,iBAAT,GAA2B,KAA3B;;AAEA;AAED,OAVD,EAUGC,KAVH,CAUS,UAASC,GAAT,EAAc;AACrB,qBAAOf,IAAP,CAAY,CAAC;AACXC,mBAASc,IAAId,OADF;AAEXC,gBAAM;AAFK,SAAD,CAAZ;AAID,OAfD;AAgBD;;;+BAEU;AAAA,UAEPrB,MAFO,GAGL,KAAKE,OAHA,CAEPF,MAFO;;AAIT,sBAASgC,iBAAT,GAA2B,KAA3B;AACA;AACD;;;8CAEyB;AACxB,WAAKG,QAAL,CAAc;AACZvB,2BAAmB,CAAC,KAAKL,KAAL,CAAWK;AADnB,OAAd;AAGD;;;wCAEmB;;AAElB,UAAIwB,QAAQ,IAAZ;AAFkB,UAIhBpC,MAJgB,GAKd,KAAKC,KALS,CAIhBD,MAJgB;;AAMlB,UAAIS,gBAAgB,EAApB;AACA,UAAIC,eAAe,EAAnB;AACA,UAAIF,aAAa,EAAjB;;AAEA,mBAAMK,QAAN,CAAe,eAAQG,OAAR,CAAgB,yBAAhB,EAA2C;AACxDqB,oBAAYrC,OAAOqC,UADqC;AAExDC,oBAAYtC,OAAOuC,OAFqC;AAGxDC,qBAAa;AAH2C,OAA3C,CAAf,EAIIvB,IAJJ,CAIS,UAASC,QAAT,EAAmB;;AAE1BT,sBAAcgC,aAAd,GAA8B,SAA9B;AACAhC,sBAAciC,UAAd,GAA2B1C,OAAOuC,OAAlC;;AAEA9B,sBAAckC,QAAd,GAAyB,CAAC,IAAIC,IAAJ,CAAU,IAAIA,IAAJ,EAAD,CAAaC,OAAb,KAAyB,KAAK,EAAL,GAAU,EAAV,GAAe,IAAjD,CAA1B;;AAEAnC,qBAAaoC,gBAAb,GAAgC5B,SAAS6B,QAAT,CAAkBD,gBAAlD;AACApC,qBAAasC,YAAb,GAA4B9B,SAAS6B,QAAT,CAAkBE,eAA9C;AACA;AACAxC,sBAAcyC,YAAd,GAA6B,OAA7B;;AAEAxC,qBAAayC,kBAAb,GAAkCjC,SAASkC,cAAT,CAAwBC,GAAxB,CAA4B,UAASC,IAAT,EAAeC,KAAf,EAAsB;AAClFD,eAAKE,KAAL,GAAaF,KAAKG,EAAlB;AACAH,eAAKI,KAAL,GAAaJ,KAAKK,eAAlB;AACA,iBAAOL,IAAP;AACD,SAJiC,CAAlC;AAKA5C,qBAAakD,WAAb,GAA2B1C,SAAS2C,OAAT,CAAiBR,GAAjB,CAAqB,UAASC,IAAT,EAAeC,KAAf,EAAsB;AACpED,eAAKE,KAAL,GAAaF,KAAKG,EAAlB;AACAH,eAAKI,KAAL,GAAaJ,KAAKQ,OAAlB;AACA,iBAAOR,IAAP;AACD,SAJ0B,CAA3B;AAKA5C,qBAAaqD,WAAb,GAA2B7C,SAAS8C,OAAT,CAAiBX,GAAjB,CAAqB,UAASC,IAAT,EAAeC,KAAf,EAAsB;AACpED,eAAKE,KAAL,GAAaF,KAAKG,EAAlB;AACAH,eAAKI,KAAL,GAAaJ,KAAKQ,OAAlB;AACA,iBAAOR,IAAP;AACD,SAJ0B,CAA3B;;AAMA5C,qBAAauD,SAAb,GAAyB/C,SAAS6B,QAAT,CAAkBmB,KAA3C;AACAxD,qBAAakB,YAAb,GAA4BV,SAAS6B,QAAT,CAAkBnB,YAA9C;AACAlB,qBAAasC,YAAb,GAA4B9B,SAAS6B,QAAT,CAAkBE,eAA9C;AACAvC,qBAAac,aAAb,GAA6BN,SAAS6B,QAAT,CAAkBvB,aAA/C;AACAd,qBAAa8B,WAAb,GAA2BtB,SAAS6B,QAAT,CAAkBoB,WAA7C;AACAzD,qBAAa0D,mBAAb,GAAmClD,SAASkD,mBAAT,IAAgC,CAAnE;;AAEA,qBAAMvD,QAAN,CAAe,eAAQG,OAAR,CAAgB,WAAhB,EAA6B;AAC1CyC,cAAIzD,OAAOyD;AAD+B,SAA7B,CAAf,EAEIxC,IAFJ,CAES,UAASC,QAAT,EAAmB;;AAG1BR,uBAAa2D,iBAAb,GAAiCnD,SAASmD,iBAA1C;;AAEA3D,uBAAa4D,gBAAb,GAAgCpD,SAASoD,gBAAzC;;AAEA7D,wBAAcgD,EAAd,GAAmBvC,SAASuC,EAA5B;AACAhD,wBAAc8D,OAAd,GAAwBrD,SAASqD,OAAjC;AACA9D,wBAAc+D,YAAd,GAA6BtD,SAASsD,YAAtC;AACA/D,wBAAcuC,YAAd,GAA6B9B,SAAS8B,YAAtC;AACAvC,wBAAc4D,iBAAd,GAAkCnD,SAASmD,iBAA3C;AACA5D,wBAAcgE,YAAd,GAA6BvD,SAASuD,YAAtC;AACAhE,wBAAciE,eAAd,GAAgCxD,SAASwD,eAAzC;AACAjE,wBAAckE,eAAd,GAAgCzD,SAASyD,eAAzC;AACAlE,wBAAcmE,YAAd,GAA6B1D,SAAS0D,YAAtC;AACAnE,wBAAcuD,OAAd,GAAwB9C,SAAS8C,OAAT,CAAiBP,EAAzC;AACAhD,wBAAcoE,QAAd,GAAyB3D,SAAS2C,OAAT,CAAiBJ,EAA1C;AACAhD,wBAAcqE,YAAd,GAA6B5D,SAAS4D,YAAtC;AACArE,wBAAcsE,OAAd,GAAwB7D,SAAS8C,OAAT,CAAiBP,EAAzC;AACAhD,wBAAcuE,SAAd,GAA0B9D,SAAS8D,SAAnC;AACAvE,wBAAcwE,YAAd,GAA6B/D,SAAS+D,YAAtC;AACAxE,wBAAcyE,SAAd,GAA0BhE,SAASgE,SAAnC;AACAzE,wBAAc0E,mBAAd,GAAoCjE,SAASkE,eAA7C;AACA,cAAIlE,SAASmE,UAAb,EAAyB;AACvBA,yBAAanE,SAASmE,UAAtB;AACAjD,kBAAMD,QAAN,CAAe;AACbkD;AADa,aAAf;AAID;AACD5E,wBAAc6E,gBAAd,GAAiCpE,SAASoE,gBAA1C;;AAEA;AACA7E,wBAAcmE,YAAd,GAA6B,IAAIhC,IAAJ,CAAS1B,SAAS0D,YAAlB,CAA7B;AACAnE,wBAAckC,QAAd,GAAyB,IAAIC,IAAJ,CAAS1B,SAASyB,QAAlB,CAAzB;AACAlC,wBAAc8E,cAAd,GAA+B,IAAI3C,IAAJ,CAAS1B,SAASqE,cAAlB,CAA/B;AACA9E,wBAAc+E,YAAd,GAA6B,IAAI5C,IAAJ,CAAS1B,SAASsE,YAAlB,CAA7B;;AAIA;AACAhF,uBAAaU,SAASV,UAAtB;;AAGA4B,gBAAMD,QAAN,CAAe;AACb1B,wCADa;AAEbC,sCAFa;AAGbF;AAHa,WAAf;AAMD,SArDD,EAqDGyB,KArDH,CAqDS,UAASC,GAAT,EAAc;AACrBpB,kBAAQC,GAAR,CAAYmB,GAAZ;AACA,uBAAOf,IAAP,CAAY,CAAC;AACXC,qBAAS,YADE;AAEXC,kBAAM;AAFK,WAAD,CAAZ;AAID,SA3DD;AA8DD,OArGD,EAqGGY,KArGH,CAqGS,UAASC,GAAT,EAAc;AACrB,qBAAOf,IAAP,CAAY,CAAC;AACXC,mBAAS,YADE;AAEXC,gBAAM;AAFK,SAAD,CAAZ;AAID,OA1GD;AA4GD;;;6BAGQ;AAAA,mBAMH,KAAKd,KANF;AAAA,UAGLE,aAHK,UAGLA,aAHK;AAAA,UAILC,YAJK,UAILA,YAJK;AAAA,UAKLF,UALK,UAKLA,UALK;;;AAQP,aAEE;AAAA;AAAA;AACG,qDAAO,OAAM,qEAAb,GADH;AAEA,2DAAa,UAAU,CAAC,MAAD,EAAQ,MAAR,EAAe,MAAf,CAAvB,GAFA;AAGA;AAAA;AAAA,YAAK,OAAO,EAACiF,WAAU,EAAX,EAAZ;AACI,mEAAe,UAAU,KAAKpF,cAA9B,EAA8C,eAAeI,aAA7D,EAA4E,UAAU,KAAKH,QAA3F,EAAqG,cAAcI,YAAnH,EAAiI,YAAYF,UAA7I;AADJ,SAHA;AAOA;AAAA;AAAA;AACE,mBAAM,0BADR;AAEE,mBAAO,IAFT;AAGE,mCAAuB,IAHzB;AAIE,oCAAwB,IAJ1B;AAKE,kBAAM,KAAKD,KAAL,CAAWK,iBALnB,EAKsC,SAAS,KAAKT,uBALpD;AAMM,uEAAmB,QAAQ,KAAKI,KAAL,CAAWI,UAAtC,EAAkD,UAAU,KAAK+E,eAAjE,EAAkF,UAAU,KAAKvF,uBAAjG;AANN;AAPA,OAFF;AAmBD;;;;;;AA5NkBJ,U,CAEZ4F,Y,GAAe;AACpB3F,UAAQ,gBAAM4F,SAAN,CAAgBC,MAAhB,CAAuBC;AADX,C;AAFH/F,U,CAKZgG,iB,GAAoB;AACrB/F,UAAQ,gBAAM4F,SAAN,CAAgBC,MAAhB,CAAuBC;AADV,C;kBALR/F,U;;;;;;;;gCAAAA,U","file":"index.js","sourceRoot":"/Users/liuyihao/Code/kr-admin","sourcesContent":["import React, {\n  Component,\n  PropTypes\n} from 'react';\nimport {\n  reduxForm,\n  submitForm,\n  change,\n  reset\n} from 'redux-form';\nimport {\n  Actions,\n  Store\n} from 'kr/Redux';\nimport http from 'kr/Redux/Utils/fetch';\n\nimport {\n  Dialog,\n  Section,\n  Grid,\n  Notify,\n  BreadCrumbs,\n  Title,\n} from 'kr-ui';\n\nimport NewCreateForm from './NewCreateForm';\nimport ConfirmFormDetail from './ConfirmFormDetail';\nimport './index.less';\nimport allState from \"../../State\";\nexport default class JoinCreate extends Component {\n\n  static contextTypes = {\n    params: React.PropTypes.object.isRequired\n  }\n  static childContextTypes = {\n        params: React.PropTypes.object.isRequired\n     }\n\n  getChildContext() {\n        return {\n            params: this.props.params\n          }\n        }\n\n  constructor(props, context) {\n    super(props, context);\n\n    this.openConfirmCreateDialog = this.openConfirmCreateDialog.bind(this);\n    this.onCreateSubmit = this.onCreateSubmit.bind(this);\n    this.onCancel = this.onCancel.bind(this);\n\n    this.state = {\n      stationVos: [],\n      initialValues: {},\n      optionValues: {},\n      formValues: {},\n      openConfirmCreate: false\n    }\n\n    Store.dispatch(reset('reduceCreateForm'));\n\n  }\n\n  onCreateSubmit(formValues) {\n    let {\n      params\n    } = this.props;\n    console.log('dasdasdasd');\n\n    Store.dispatch(Actions.callAPI('addOrEditContinueContract', {}, formValues)).then(function(response) {\n      Notify.show([{\n        message: '更新成功',\n        type: 'success',\n      }]);\n      allState.ajaxListData({cityName:'',communityName:'',createDateBegin:'',createDateEnd:'',createrName:'',customerName:'',page:'',pageSize:'',salerName:''})\n      allState.openEditAgreement=false;\n      \n      // location.href = \"./#/operation/customerManage/\" + params.customerId + \"/order/\" + params.orderId + \"/agreement/renew/\" + response.contractId + \"/detail\";\n\n    }).catch(function(err) {\n      Notify.show([{\n        message: err.message,\n        type: 'danger',\n      }]);\n    });\n  }\n\n  onCancel() {\n    let {\n      params\n    } = this.context;\n    allState.openEditAgreement=false;\n    // window.location.href = `./#/operation/customerManage/${params.customerId}/order/${params.orderId}/detail`;\n  }\n\n  openConfirmCreateDialog() {\n    this.setState({\n      openConfirmCreate: !this.state.openConfirmCreate\n    });\n  }\n\n  componentDidMount() {\n\n    var _this = this;\n    const {\n      params\n    } = this.props;\n    let initialValues = {};\n    let optionValues = {};\n    let stationVos = [];\n\n    Store.dispatch(Actions.callAPI('fina-contract-intention', {\n      customerId: params.customerId,\n      mainBillId: params.orderId,\n      communityId: 1\n    })).then(function(response) {\n\n      initialValues.contractstate = 'UNSTART';\n      initialValues.mainbillid = params.orderId;\n\n      initialValues.signdate = +new Date((new Date()).getTime() - 24 * 60 * 60 * 1000);\n\n      optionValues.communityAddress = response.customer.communityAddress;\n      optionValues.leaseAddress = response.customer.customerAddress;\n      //合同类别，枚举类型（1:意向书,2:入住协议,3:增租协议,4.续租协议,5:减租协议,6退租协议）\n      initialValues.contracttype = 'RENEW';\n\n      optionValues.fnaCorporationList = response.fnaCorporation.map(function(item, index) {\n        item.value = item.id;\n        item.label = item.corporationName;\n        return item;\n      });\n      optionValues.paymentList = response.payment.map(function(item, index) {\n        item.value = item.id;\n        item.label = item.dicName;\n        return item;\n      });\n      optionValues.payTypeList = response.payType.map(function(item, index) {\n        item.value = item.id;\n        item.label = item.dicName;\n        return item;\n      });\n\n      optionValues.floorList = response.customer.floor;\n      optionValues.customerName = response.customer.customerName;\n      optionValues.leaseAddress = response.customer.customerAddress;\n      optionValues.communityName = response.customer.communityName;\n      optionValues.communityId = response.customer.communityid;\n      optionValues.mainbillCommunityId = response.mainbillCommunityId || 1;\n\n      Store.dispatch(Actions.callAPI('renewshow', {\n        id: params.id\n      })).then(function(response) {\n\n\n        optionValues.lessorContactName = response.lessorContactName;\n\n        optionValues.contractFileList = response.contractFileList;\n\n        initialValues.id = response.id;\n        initialValues.leaseId = response.leaseId;\n        initialValues.contractcode = response.contractcode;\n        initialValues.leaseAddress = response.leaseAddress;\n        initialValues.lessorContactName = response.lessorContactName;\n        initialValues.leaseContact = response.leaseContact;\n        initialValues.leaseContacttel = response.leaseContacttel;\n        initialValues.lessorContactid = response.lessorContactid;\n        initialValues.firstpaydate = response.firstpaydate;\n        initialValues.payType = response.payType.id\n        initialValues.paymodel = response.payment.id;\n        initialValues.totaldeposit = response.totaldeposit;\n        initialValues.paytype = response.payType.id;\n        initialValues.rentaluse = response.rentaluse;\n        initialValues.contractmark = response.contractmark;\n        initialValues.totalrent = response.totalrent;\n        initialValues.contractVersionType = response.contractVersion;\n        if (response.rentamount) {\n          rentamount = response.rentamount;\n          _this.setState({\n            rentamount\n          });\n\n        }\n        initialValues.lessorContacttel = response.lessorContacttel;\n\n        //时间\n        initialValues.firstpaydate = new Date(response.firstpaydate);\n        initialValues.signdate = new Date(response.signdate);\n        initialValues.leaseBegindate = new Date(response.leaseBegindate);\n        initialValues.leaseEnddate = new Date(response.leaseEnddate);\n\n\n\n        //处理stationvos\n        stationVos = response.stationVos;\n\n\n        _this.setState({\n          initialValues,\n          optionValues,\n          stationVos,\n        });\n\n      }).catch(function(err) {\n        console.log(err);\n        Notify.show([{\n          message: '后台出错请联系管理员',\n          type: 'danger',\n        }]);\n      });\n\n\n    }).catch(function(err) {\n      Notify.show([{\n        message: '后台出错请联系管理员',\n        type: 'danger',\n      }]);\n    });\n\n  }\n\n\n  render() {\n\n    let {\n      initialValues,\n      optionValues,\n      stationVos\n    } = this.state;\n\n    return (\n\n      <div>\n        \t<Title value=\"编辑续租协议书_财务管理\"/>\n      <BreadCrumbs children={['系统运营','客户管理','续租协议']}/>\n      <div style={{marginTop:10}}>\n          <NewCreateForm onSubmit={this.onCreateSubmit} initialValues={initialValues} onCancel={this.onCancel} optionValues={optionValues} stationVos={stationVos}/>\n      </div>\n\n      <Dialog\n        title=\"确定新建\"\n        modal={true}\n        autoScrollBodyContent={true}\n        autoDetectWindowHeight={true}\n        open={this.state.openConfirmCreate} onClose={this.openConfirmCreateDialog}>\n            <ConfirmFormDetail detail={this.state.formValues} onSubmit={this.onConfrimSubmit} onCancel={this.openConfirmCreateDialog} />\n        </Dialog>\n    </div>\n    );\n  }\n}"]}