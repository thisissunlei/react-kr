'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reduxForm = require('redux-form');

var _Notify = require('../../Notify');

var _Notify2 = _interopRequireDefault(_Notify);

var _reactDom = require('react-dom');

var _reactDom2 = _interopRequireDefault(_reactDom);

require('./index.less');

var _refresh = require('./images/refresh.svg');

var _refresh2 = _interopRequireDefault(_refresh);

var _deleteImg = require('./images/deleteImg.svg');

var _deleteImg2 = _interopRequireDefault(_deleteImg);

var _Redux = require('kr/Redux');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var UploadImageComponent = function (_Component) {
	_inherits(UploadImageComponent, _Component);

	function UploadImageComponent(props, context) {
		_classCallCheck(this, UploadImageComponent);

		var _this2 = _possibleConstructorReturn(this, (UploadImageComponent.__proto__ || Object.getPrototypeOf(UploadImageComponent)).call(this, props, context));

		_this2.operationImg = function () {
			// console.log("this.state.imgUpload)",this.state.imgUpload);
			if (_this2.state.imgUpload) {
				_this2.setState({
					operateImg: true
				});
			}
		};

		_this2.notOperateImg = function () {
			if (_this2.state.imgUpload) {
				_this2.setState({
					operateImg: false
				});
			}
		};

		_this2.onError = function (message) {
			message = message || '上传文件失败，请重新上传';
			_Notify2.default.show([{
				message: message,
				type: 'danger'
			}]);

			_this2.setState({
				progress: 0,
				imgUpload: false
			});
		};

		_this2.onChange = function (event) {
			_this2.setState({
				imgSrc: "",
				operateImg: false,
				imgUpload: false,
				errorHide: true
			});
			var _this = _this2;
			var file = event.target.files[0];

			if (!file) {
				return;
			}
			if (file) {
				var progress = 0;
				var timer = window.setInterval(function () {
					if (progress >= 100) {
						window.clearInterval(timer);
						// _this.setState({
						// 	progress: 0,
						// 	isUploading: false
						// });
					}
					progress += 10;
					_this.setState({
						progress: progress
					});
				}, 300);
			}
			var imgType = file.type;
			var imgSize = Math.round(file.size / 1024 * 100) / 100;
			if (imgType !== "image/jpg" && imgType !== "image/jpeg") {
				_this2.refs.inputImg.value = "";
				_this2.refs.inputImgNew.value = "";
				_this2.refs.uploadImage.src = "";
				_this.setState({
					errorHide: false,
					errorTip: "请上传正确格式的图片"
				});
				return;
			}
			if (imgSize > 32) {
				_this2.refs.inputImg.value = "";
				_this2.refs.inputImgNew.value = "";
				_this2.refs.uploadImage.src = "";
				_this.setState({
					errorHide: false,
					errorTip: "图片尺寸不得大于32K"
				});
				return;
			}
			var form = new FormData();
			form.append('file', file);
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function () {
				if (xhr.readyState === 4) {
					if (xhr.status === 200) {
						var response = xhr.response.data;
						// console.log("response",response);
						form.append('sourceservicetoken', response.token);
						form.append('docTypeCode', response.docTypeCode);
						form.append('operater', response.operater);
						_this.onTokenSuccess({
							sourceservicetoken: response.token,
							docTypeCode: response.docTypeCode,
							operater: response.operater
						});
						var xhrfile = new XMLHttpRequest();
						xhrfile.onreadystatechange = function () {
							if (xhrfile.readyState === 4) {
								var fileResponse = xhrfile.response;
								if (xhrfile.status === 200) {
									if (fileResponse && fileResponse.code > 0) {
										_this.functionHeightWidth(file, xhrfile);
									} else {
										_this.onError(fileResponse.msg);
										return;
									}
								} else if (xhrfile.status == 413) {
									_this.onError('您上传的文件过大！');
								} else {
									_this.onError('后台报错请联系管理员！');
								}
							}
						};
						xhrfile.onerror = function (e) {
							console.error(xhr.statusText);
						};
						xhrfile.open('POST', '/api/krspace-finance-web/community/sysDeviceDefinition/upload-pic', true);
						xhrfile.responseType = 'json';
						xhrfile.send(form);
					} else {
						_this.onTokenError();
					}
				}
			};

			xhr.onerror = function (e) {
				console.error(xhr.statusText);
			};
			xhr.open('GET', '/api/krspace-finance-web/finacontractdetail/getSourceServiceToken', true);
			xhr.responseType = 'json';
			xhr.send(null);
			// 暂时觉得此处用不着了，等连上服务器需要再检查一下
			_this.setState({
				imgUpload: true,
				operateImg: false
			});
		};

		_this2.functionHeightWidth = function (file, xhrfile) {
			var _this = _this2;
			if (file) {
				var fileData = file;
				//读取图片数据
				var reader = new FileReader();
				reader.onload = function (e) {
					// console.log("e",e);
					var data = e.target.result;
					//加载图片获取图片真实宽度和高度
					var image = new Image();
					image.onload = function () {
						var width = image.width;
						var height = image.height;
						if (width !== 212 || height !== 136) {
							_this.refs.inputImg.value = "";
							_this.refs.inputImgNew.value = "";
							_this.refs.uploadImage.src = "";
							_this.setState({
								errorHide: false,
								errorTip: "图片宽度必须是212*136",
								imageStatus: false,
								imgUpload: false
							});
						} else {
							_this.refs.uploadImage.src = xhrfile.response.data;
							_this.setState({
								imageStatus: true,
								imgUpload: true,
								operateImg: false
							});
							var input = _this.props.input;

							input.onChange(xhrfile.response.data);
						}
					};
					image.src = data;
				};
				reader.readAsDataURL(fileData);
			}
		};

		_this2.deleteImg = function () {
			_this2.setState({
				imgSrc: "",
				imgUpload: false,
				operateImg: false
			});
			_this2.refs.inputImg.value = "";
			_this2.refs.inputImgNew.value = "";
			_this2.refs.uploadImage.src = "";
			var input = _this2.props.input;

			input.onChange("");
		};

		_this2.state = {
			imgSrc: '',
			errorHide: true,
			errorTip: '',
			// 图片是否已经上传到界面
			imgUpload: false,
			timer: "",
			operateImg: false,
			files: {},
			imageStatus: true
		};
		return _this2;
	}

	_createClass(UploadImageComponent, [{
		key: 'componentWillUnmount',
		value: function componentWillUnmount() {
			this.setState({
				files: []
			});
		}
	}, {
		key: 'componentDidMount',
		value: function componentDidMount() {}
	}, {
		key: 'componentWillReceiveProps',
		value: function componentWillReceiveProps(nextProps) {}
	}, {
		key: 'onTokenError',
		value: function onTokenError() {
			_Notify2.default.show([{
				message: '初始化上传文件失败,请重新上传',
				type: 'danger'
			}]);
		}
	}, {
		key: 'onTokenSuccess',
		value: function onTokenSuccess(form) {
			this.setState({
				form: form
			});
		}
		// 校验宽高

		// 删除图片

	}, {
		key: 'render',
		value: function render() {
			var _props = this.props,
			    children = _props.children,
			    className = _props.className,
			    style = _props.style,
			    type = _props.type,
			    name = _props.name,
			    disabled = _props.disabled,
			    photoSize = _props.photoSize,
			    pictureFormat = _props.pictureFormat,
			    pictureMemory = _props.pictureMemory,
			    requestURI = _props.requestURI,
			    other = _objectWithoutProperties(_props, ['children', 'className', 'style', 'type', 'name', 'disabled', 'photoSize', 'pictureFormat', 'pictureMemory', 'requestURI']);

			var operateImg = this.state.operateImg;
			// console.log("this.state.operateImg",this.state.operateImg)

			return _react2.default.createElement(
				'div',
				{ className: 'ui-uploadimg-box', style: style },
				_react2.default.createElement(
					'div',
					{ className: 'ui-uploadimg-outbox' },
					_react2.default.createElement(
						'div',
						{ className: 'ui-uploadimg-innerbox', onMouseEnter: this.operationImg, onMouseLeave: this.notOperateImg },
						_react2.default.createElement(
							'div',
							{ className: 'ui-uploadimg-inner' },
							_react2.default.createElement('img', { className: 'image', src: this.state.imgSrc, ref: 'uploadImage' }),
							_react2.default.createElement(
								'span',
								{ className: 'ui-uploadimg-button' },
								'+'
							),
							_react2.default.createElement('input', { type: 'file', onChange: this.onChange, ref: 'inputImg' }),
							_react2.default.createElement(
								'span',
								{ className: 'ui-uploadimg-tip' },
								'\u4E0A\u4F20\u56FE\u7247'
							)
						),
						_react2.default.createElement(
							'div',
							{ className: 'ui-uploadimg-fresh-delete', style: { display: this.state.operateImg ? "block" : "none" } },
							_react2.default.createElement(
								'div',
								{ className: 'ui-uploadimg-operateimg ui-uploadimg-operateimg-left', onClick: this.reFreshImg },
								_react2.default.createElement('img', { src: _refresh2.default, className: 'ui-uploadimg-operateimg-btn ui-uploadimg-operateimg-refresh' }),
								_react2.default.createElement('input', { type: 'file', onChange: this.onChange, ref: 'inputImgNew', className: 'ui-refreshImgBtn' })
							),
							_react2.default.createElement(
								'div',
								{ className: 'ui-uploadimg-operateimg ui-uploadimg-operateimg-right', onClick: this.deleteImg },
								_react2.default.createElement('img', { src: _deleteImg2.default, className: 'ui-uploadimg-operateimg-btn ui-uploadimg-operateimg-delete' })
							)
						)
					)
				),
				_react2.default.createElement(
					'p',
					{ className: 'ui-uploadimg-notice' },
					'\u63D0\u793A\uFF1A\u56FE\u7247\u5C3A\u5BF8\u4E3A',
					photoSize,
					'\uFF0C\u56FE\u7247\u5C0F\u4E8E',
					pictureMemory,
					',\u683C\u5F0F\u4E3A',
					pictureFormat
				),
				_react2.default.createElement(
					'p',
					{ className: 'ui-uploadimg-error', style: { display: this.state.errorHide ? "none" : "block" } },
					this.state.errorTip
				)
			);
		}
	}]);

	return UploadImageComponent;
}(_react.Component);

UploadImageComponent.defaultProps = {};
UploadImageComponent.PropTypes = {
	className: _react2.default.PropTypes.string
};
exports.default = UploadImageComponent;
;

var _temp = function () {
	if (typeof __REACT_HOT_LOADER__ === 'undefined') {
		return;
	}

	__REACT_HOT_LOADER__.register(UploadImageComponent, 'UploadImageComponent', '/Users/liuyihao/Code/kr-admin/src/Components/KrField/UploadImageComponent/index.js');
}();

;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9Db21wb25lbnRzL0tyRmllbGQvVXBsb2FkSW1hZ2VDb21wb25lbnQvaW5kZXguanMiXSwibmFtZXMiOlsiVXBsb2FkSW1hZ2VDb21wb25lbnQiLCJwcm9wcyIsImNvbnRleHQiLCJvcGVyYXRpb25JbWciLCJzdGF0ZSIsImltZ1VwbG9hZCIsInNldFN0YXRlIiwib3BlcmF0ZUltZyIsIm5vdE9wZXJhdGVJbWciLCJvbkVycm9yIiwibWVzc2FnZSIsInNob3ciLCJ0eXBlIiwicHJvZ3Jlc3MiLCJvbkNoYW5nZSIsImV2ZW50IiwiaW1nU3JjIiwiZXJyb3JIaWRlIiwiX3RoaXMiLCJmaWxlIiwidGFyZ2V0IiwiZmlsZXMiLCJ0aW1lciIsIndpbmRvdyIsInNldEludGVydmFsIiwiY2xlYXJJbnRlcnZhbCIsImltZ1R5cGUiLCJpbWdTaXplIiwiTWF0aCIsInJvdW5kIiwic2l6ZSIsInJlZnMiLCJpbnB1dEltZyIsInZhbHVlIiwiaW5wdXRJbWdOZXciLCJ1cGxvYWRJbWFnZSIsInNyYyIsImVycm9yVGlwIiwiZm9ybSIsIkZvcm1EYXRhIiwiYXBwZW5kIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwicmVzcG9uc2UiLCJkYXRhIiwidG9rZW4iLCJkb2NUeXBlQ29kZSIsIm9wZXJhdGVyIiwib25Ub2tlblN1Y2Nlc3MiLCJzb3VyY2VzZXJ2aWNldG9rZW4iLCJ4aHJmaWxlIiwiZmlsZVJlc3BvbnNlIiwiY29kZSIsImZ1bmN0aW9uSGVpZ2h0V2lkdGgiLCJtc2ciLCJvbmVycm9yIiwiZSIsImNvbnNvbGUiLCJlcnJvciIsInN0YXR1c1RleHQiLCJvcGVuIiwicmVzcG9uc2VUeXBlIiwic2VuZCIsIm9uVG9rZW5FcnJvciIsImZpbGVEYXRhIiwicmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsInJlc3VsdCIsImltYWdlIiwiSW1hZ2UiLCJ3aWR0aCIsImhlaWdodCIsImltYWdlU3RhdHVzIiwiaW5wdXQiLCJyZWFkQXNEYXRhVVJMIiwiZGVsZXRlSW1nIiwibmV4dFByb3BzIiwiY2hpbGRyZW4iLCJjbGFzc05hbWUiLCJzdHlsZSIsIm5hbWUiLCJkaXNhYmxlZCIsInBob3RvU2l6ZSIsInBpY3R1cmVGb3JtYXQiLCJwaWN0dXJlTWVtb3J5IiwicmVxdWVzdFVSSSIsIm90aGVyIiwiZGlzcGxheSIsInJlRnJlc2hJbWciLCJkZWZhdWx0UHJvcHMiLCJQcm9wVHlwZXMiLCJzdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOzs7O0FBR0E7O0FBSUE7Ozs7QUFDQTs7OztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7Ozs7Ozs7O0lBQ3FCQSxvQjs7O0FBT3BCLCtCQUFZQyxLQUFaLEVBQWtCQyxPQUFsQixFQUEwQjtBQUFBOztBQUFBLDJJQUNuQkQsS0FEbUIsRUFDYkMsT0FEYTs7QUFBQSxTQThCMUJDLFlBOUIwQixHQThCYixZQUFJO0FBQ2hCO0FBQ0EsT0FBRyxPQUFLQyxLQUFMLENBQVdDLFNBQWQsRUFBd0I7QUFDdkIsV0FBS0MsUUFBTCxDQUFjO0FBQ2JDLGlCQUFZO0FBREMsS0FBZDtBQUdBO0FBQ0QsR0FyQ3lCOztBQUFBLFNBc0MxQkMsYUF0QzBCLEdBc0NaLFlBQUk7QUFDakIsT0FBRyxPQUFLSixLQUFMLENBQVdDLFNBQWQsRUFBd0I7QUFDdkIsV0FBS0MsUUFBTCxDQUFjO0FBQ2JDLGlCQUFZO0FBREMsS0FBZDtBQUdBO0FBQ0QsR0E1Q3lCOztBQUFBLFNBa0QxQkUsT0FsRDBCLEdBa0RsQixVQUFDQyxPQUFELEVBQVc7QUFDbEJBLGFBQVVBLFdBQVcsY0FBckI7QUFDQSxvQkFBT0MsSUFBUCxDQUFZLENBQUM7QUFDWkQsYUFBU0EsT0FERztBQUVaRSxVQUFNO0FBRk0sSUFBRCxDQUFaOztBQUtBLFVBQUtOLFFBQUwsQ0FBYztBQUNiTyxjQUFVLENBREc7QUFFYlIsZUFBVztBQUZFLElBQWQ7QUFJQSxHQTdEeUI7O0FBQUEsU0E4RDFCUyxR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RixLQUFMLENBQVdHLFVBQVgsR0FBc0IsT0FBdEIsR0FBOEIsTUFBdkMsRUFBbEQ7QUFDQztBQUFBO0FBQUEsVUFBSyxXQUFVLHNEQUFmLEVBQXNFLFNBQVMsS0FBS3FGLFVBQXBGO0FBQ0MsK0NBQUssc0JBQUwsRUFBbUIsV0FBVSw2REFBN0IsR0FERDtBQUVDLGlEQUFPLE1BQUssTUFBWixFQUFtQixVQUFVLEtBQUs5RSxRQUFsQyxFQUE0QyxLQUFJLGFBQWhELEVBQThELFdBQVUsa0JBQXhFO0FBRkQsUUFERDtBQUtDO0FBQUE7QUFBQSxVQUFLLFdBQVUsdURBQWYsRUFBdUUsU0FBUyxLQUFLaUUsU0FBckY7QUFDQywrQ0FBSyx3QkFBTCxFQUFxQixXQUFVLDREQUEvQjtBQUREO0FBTEQ7QUFQRDtBQURELEtBREQ7QUFvQkM7QUFBQTtBQUFBLE9BQUcsV0FBVSxxQkFBYjtBQUFBO0FBQ1VPLGNBRFY7QUFBQTtBQUMwQkUsa0JBRDFCO0FBQUE7QUFDNkNEO0FBRDdDLEtBcEJEO0FBdUJDO0FBQUE7QUFBQSxPQUFHLFdBQVUsb0JBQWIsRUFBa0MsT0FBTyxFQUFDSSxTQUFRLEtBQUt2RixLQUFMLENBQVdhLFNBQVgsR0FBcUIsTUFBckIsR0FBNEIsT0FBckMsRUFBekM7QUFDRSxVQUFLYixLQUFMLENBQVdpQztBQURiO0FBdkJELElBREQ7QUE2QkE7Ozs7OztBQTNRbUJyQyxvQixDQUNiNkYsWSxHQUFlLEU7QUFERjdGLG9CLENBSWI4RixTLEdBQVk7QUFDbEJaLFlBQVcsZ0JBQU1ZLFNBQU4sQ0FBZ0JDO0FBRFQsQztrQkFKQy9GLG9COzs7Ozs7OzsrQkFBQUEsb0IiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2xpdXlpaGFvL0NvZGUva3ItYWRtaW4iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcblx0Q29tcG9uZW50XG59IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG5cdEZpZWxkLFxuXHRyZWR1eEZvcm1cbn0gZnJvbSAncmVkdXgtZm9ybSc7XG5pbXBvcnQgTm90aWZ5IGZyb20gJy4uLy4uL05vdGlmeSc7XG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCAnLi9pbmRleC5sZXNzJztcbmltcG9ydCByZWZyZXNoIGZyb20gXCIuL2ltYWdlcy9yZWZyZXNoLnN2Z1wiO1xuaW1wb3J0IGRlbGV0ZUltZyBmcm9tIFwiLi9pbWFnZXMvZGVsZXRlSW1nLnN2Z1wiO1xuaW1wb3J0IHtBY3Rpb25zLFN0b3JlfSBmcm9tICdrci9SZWR1eCc7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVcGxvYWRJbWFnZUNvbXBvbmVudCBleHRlbmRzIENvbXBvbmVudCB7XG5cdHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG5cdFx0XG5cdH1cblx0c3RhdGljIFByb3BUeXBlcyA9IHtcblx0XHRjbGFzc05hbWU6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmdcblx0fVxuXHRjb25zdHJ1Y3Rvcihwcm9wcyxjb250ZXh0KXtcblx0XHRzdXBlcihwcm9wcyxjb250ZXh0KTtcblx0XHR0aGlzLnN0YXRlPXtcblx0XHRcdGltZ1NyYzonJyxcblx0XHRcdGVycm9ySGlkZTogdHJ1ZSxcblx0XHRcdGVycm9yVGlwOicnLFxuXHRcdFx0Ly8g5Zu+54mH5piv5ZCm5bey57uP5LiK5Lyg5Yiw55WM6Z2iXG5cdFx0XHRpbWdVcGxvYWQ6IGZhbHNlLFxuXHRcdFx0dGltZXIgOlwiXCIsXG5cdFx0XHRvcGVyYXRlSW1nIDpmYWxzZSxcblx0XHRcdGZpbGVzIDp7fSxcblx0XHRcdGltYWdlU3RhdHVzIDogdHJ1ZVxuXHRcdH1cblx0fVxuXHRjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcblx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdGZpbGVzOiBbXVxuXHRcdH0pO1xuXHR9XG5cdGNvbXBvbmVudERpZE1vdW50KCkge1xuXG5cdH1cblx0Y29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpe1xuXHR9XG5cdG9uVG9rZW5FcnJvcigpIHtcblx0XHROb3RpZnkuc2hvdyhbe1xuXHRcdFx0bWVzc2FnZTogJ+WIneWni+WMluS4iuS8oOaWh+S7tuWksei0pSzor7fph43mlrDkuIrkvKAnLFxuXHRcdFx0dHlwZTogJ2RhbmdlcicsXG5cdFx0fV0pO1xuXHR9XG5cdG9wZXJhdGlvbkltZz0oKT0+e1xuXHRcdC8vIGNvbnNvbGUubG9nKFwidGhpcy5zdGF0ZS5pbWdVcGxvYWQpXCIsdGhpcy5zdGF0ZS5pbWdVcGxvYWQpO1xuXHRcdGlmKHRoaXMuc3RhdGUuaW1nVXBsb2FkKXtcblx0XHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRvcGVyYXRlSW1nIDp0cnVlXG5cdFx0XHR9KVxuXHRcdH1cblx0fVxuXHRub3RPcGVyYXRlSW1nPSgpPT57XG5cdFx0aWYodGhpcy5zdGF0ZS5pbWdVcGxvYWQpe1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdG9wZXJhdGVJbWcgOmZhbHNlXG5cdFx0XHR9KVxuXHRcdH1cblx0fVxuXHRvblRva2VuU3VjY2Vzcyhmb3JtKSB7XG5cdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRmb3JtXG5cdFx0fSk7XG5cdH1cblx0b25FcnJvcj0obWVzc2FnZSk9Pntcblx0XHRtZXNzYWdlID0gbWVzc2FnZSB8fCAn5LiK5Lyg5paH5Lu25aSx6LSl77yM6K+36YeN5paw5LiK5LygJztcblx0XHROb3RpZnkuc2hvdyhbe1xuXHRcdFx0bWVzc2FnZTogbWVzc2FnZSxcblx0XHRcdHR5cGU6ICdkYW5nZXInLFxuXHRcdH1dKTtcblxuXHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0cHJvZ3Jlc3M6IDAsXG5cdFx0XHRpbWdVcGxvYWQ6IGZhbHNlXG5cdFx0fSk7XG5cdH1cblx0b25DaGFuZ2U9KGV2ZW50KT0+e1xuXHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0aW1nU3JjOiBcIlwiLFxuXHRcdFx0b3BlcmF0ZUltZyA6ZmFsc2UsXG5cdFx0XHRpbWdVcGxvYWQgOmZhbHNlLFxuXHRcdFx0ZXJyb3JIaWRlOiB0cnVlXG5cdFx0fSlcblx0XHRsZXQgX3RoaXMgPSB0aGlzO1xuXHRcdGxldCBmaWxlID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdO1xuXG5cdFx0aWYgKCFmaWxlKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVx0XHRcblx0XHRpZiAoZmlsZSkge1xuXHRcdFx0dmFyIHByb2dyZXNzID0gMDtcblx0XHRcdHZhciB0aW1lciA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHByb2dyZXNzID49IDEwMCkge1xuXHRcdFx0XHRcdHdpbmRvdy5jbGVhckludGVydmFsKHRpbWVyKTtcblx0XHRcdFx0XHQvLyBfdGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdFx0Ly8gXHRwcm9ncmVzczogMCxcblx0XHRcdFx0XHQvLyBcdGlzVXBsb2FkaW5nOiBmYWxzZVxuXHRcdFx0XHRcdC8vIH0pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHByb2dyZXNzICs9IDEwO1xuXHRcdFx0XHRfdGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdFx0cHJvZ3Jlc3Ncblx0XHRcdFx0fSk7XG5cdFx0XHR9LCAzMDApO1xuXHRcdH1cblx0XHRsZXQgaW1nVHlwZSA9IGZpbGUudHlwZTtcblx0XHRsZXQgaW1nU2l6ZSA9IE1hdGgucm91bmQoZmlsZS5zaXplLzEwMjQqMTAwKS8xMDA7XG5cdFx0aWYoaW1nVHlwZSE9PSBcImltYWdlL2pwZ1wiICYmIGltZ1R5cGUhPT0gXCJpbWFnZS9qcGVnXCIpe1xuXHRcdFx0dGhpcy5yZWZzLmlucHV0SW1nLnZhbHVlID1cIlwiO1xuXHRcdFx0dGhpcy5yZWZzLmlucHV0SW1nTmV3LnZhbHVlID1cIlwiO1xuXHRcdFx0dGhpcy5yZWZzLnVwbG9hZEltYWdlLnNyYz1cIlwiO1xuXHRcdFx0X3RoaXMuc2V0U3RhdGUoe1xuICBcdFx0XHRcdGVycm9ySGlkZTogZmFsc2UsXG4gIFx0XHRcdFx0ZXJyb3JUaXA6XCLor7fkuIrkvKDmraPnoa7moLzlvI/nmoTlm77niYdcIlxuICBcdFx0XHR9KVxuICBcdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdGlmKGltZ1NpemU+MzIpe1xuXHRcdFx0dGhpcy5yZWZzLmlucHV0SW1nLnZhbHVlID1cIlwiO1xuXHRcdFx0dGhpcy5yZWZzLmlucHV0SW1nTmV3LnZhbHVlID1cIlwiO1xuXHRcdFx0dGhpcy5yZWZzLnVwbG9hZEltYWdlLnNyYz1cIlwiO1xuXHRcdFx0X3RoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRlcnJvckhpZGU6IGZhbHNlLFxuXHRcdFx0XHRlcnJvclRpcDpcIuWbvueJh+WwuuWvuOS4jeW+l+Wkp+S6jjMyS1wiXG5cdFx0XHR9KVxuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHR2YXIgZm9ybSA9IG5ldyBGb3JtRGF0YSgpO1xuXHRcdGZvcm0uYXBwZW5kKCdmaWxlJywgZmlsZSk7XG5cdFx0dmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXHRcdHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcblx0XHRcdGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkge1xuXHRcdFx0XHRpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7XG5cdFx0XHRcdFx0dmFyIHJlc3BvbnNlID0geGhyLnJlc3BvbnNlLmRhdGE7XG5cdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coXCJyZXNwb25zZVwiLHJlc3BvbnNlKTtcblx0XHRcdFx0XHRmb3JtLmFwcGVuZCgnc291cmNlc2VydmljZXRva2VuJywgcmVzcG9uc2UudG9rZW4pO1xuXHRcdFx0XHRcdGZvcm0uYXBwZW5kKCdkb2NUeXBlQ29kZScsIHJlc3BvbnNlLmRvY1R5cGVDb2RlKTtcblx0XHRcdFx0XHRmb3JtLmFwcGVuZCgnb3BlcmF0ZXInLCByZXNwb25zZS5vcGVyYXRlcik7XG5cdFx0XHRcdFx0X3RoaXMub25Ub2tlblN1Y2Nlc3Moe1xuXHRcdFx0XHRcdFx0c291cmNlc2VydmljZXRva2VuOiByZXNwb25zZS50b2tlbixcblx0XHRcdFx0XHRcdGRvY1R5cGVDb2RlOiByZXNwb25zZS5kb2NUeXBlQ29kZSxcblx0XHRcdFx0XHRcdG9wZXJhdGVyOiByZXNwb25zZS5vcGVyYXRlclxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdHZhciB4aHJmaWxlID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cdFx0XHRcdFx0eGhyZmlsZS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdGlmICh4aHJmaWxlLnJlYWR5U3RhdGUgPT09IDQpIHtcblx0XHRcdFx0XHRcdFx0dmFyIGZpbGVSZXNwb25zZSA9IHhocmZpbGUucmVzcG9uc2U7XG5cdFx0XHRcdFx0XHRcdGlmICh4aHJmaWxlLnN0YXR1cyA9PT0gMjAwKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKGZpbGVSZXNwb25zZSAmJiBmaWxlUmVzcG9uc2UuY29kZSA+IDApIHtcblx0XHRcdFx0XHRcdFx0XHRcdF90aGlzLmZ1bmN0aW9uSGVpZ2h0V2lkdGgoZmlsZSx4aHJmaWxlKTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0X3RoaXMub25FcnJvcihmaWxlUmVzcG9uc2UubXNnKTtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoeGhyZmlsZS5zdGF0dXMgPT0gNDEzKSB7XG5cdFx0XHRcdFx0XHRcdFx0X3RoaXMub25FcnJvcign5oKo5LiK5Lyg55qE5paH5Lu26L+H5aSn77yBJyk7XG5cdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0X3RoaXMub25FcnJvcign5ZCO5Y+w5oql6ZSZ6K+36IGU57O7566h55CG5ZGY77yBJyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdHhocmZpbGUub25lcnJvciA9IGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoeGhyLnN0YXR1c1RleHQpO1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0eGhyZmlsZS5vcGVuKCdQT1NUJywgJy9hcGkva3JzcGFjZS1maW5hbmNlLXdlYi9jb21tdW5pdHkvc3lzRGV2aWNlRGVmaW5pdGlvbi91cGxvYWQtcGljJywgdHJ1ZSk7XG5cdFx0XHRcdFx0eGhyZmlsZS5yZXNwb25zZVR5cGUgPSAnanNvbic7XG5cdFx0XHRcdFx0eGhyZmlsZS5zZW5kKGZvcm0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdF90aGlzLm9uVG9rZW5FcnJvcigpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdHhoci5vbmVycm9yID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0Y29uc29sZS5lcnJvcih4aHIuc3RhdHVzVGV4dCk7XG5cdFx0fTtcblx0XHR4aHIub3BlbignR0VUJywgJy9hcGkva3JzcGFjZS1maW5hbmNlLXdlYi9maW5hY29udHJhY3RkZXRhaWwvZ2V0U291cmNlU2VydmljZVRva2VuJywgdHJ1ZSk7XG5cdFx0eGhyLnJlc3BvbnNlVHlwZSA9ICdqc29uJztcblx0XHR4aHIuc2VuZChudWxsKTtcblx0XHQvLyDmmoLml7bop4nlvpfmraTlpITnlKjkuI3nnYDkuobvvIznrYnov57kuIrmnI3liqHlmajpnIDopoHlho3mo4Dmn6XkuIDkuItcblx0XHRfdGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRpbWdVcGxvYWQ6IHRydWUsXG5cdFx0XHRvcGVyYXRlSW1nIDogZmFsc2Vcblx0XHR9KTtcblx0fVxuXHQvLyDmoKHpqozlrr3pq5hcblx0ZnVuY3Rpb25IZWlnaHRXaWR0aD0oZmlsZSx4aHJmaWxlKT0+e1xuXHRcdGxldCBfdGhpcyA9IHRoaXM7XG5cdFx0aWYoZmlsZSApe1xuICAgICAgICAgICAgICAgIHZhciBmaWxlRGF0YSA9IGZpbGU7XG4gICAgICAgICAgICAgICAgIC8v6K+75Y+W5Zu+54mH5pWw5o2uXG4gICAgICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgIFx0Ly8gY29uc29sZS5sb2coXCJlXCIsZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gZS50YXJnZXQucmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgLy/liqDovb3lm77niYfojrflj5blm77niYfnnJ/lrp7lrr3luqblkozpq5jluqZcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlLm9ubG9hZD1mdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3aWR0aCA9IGltYWdlLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgaWYod2lkdGggIT09IDIxMiB8fCBoZWlnaHQgIT09IDEzNil7XG4gICAgICAgICAgICAgICAgICAgICAgICAgXHRfdGhpcy5yZWZzLmlucHV0SW1nLnZhbHVlID1cIlwiO1xuXHRcdFx0XHRcdFx0XHRfdGhpcy5yZWZzLmlucHV0SW1nTmV3LnZhbHVlID1cIlwiO1xuXHRcdFx0XHRcdFx0XHRfdGhpcy5yZWZzLnVwbG9hZEltYWdlLnNyYz1cIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgIFx0X3RoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRcdFx0XHRcdGVycm9ySGlkZTogZmFsc2UsXG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3JUaXA6XCLlm77niYflrr3luqblv4XpobvmmK8yMTIqMTM2XCIsXG5cdFx0XHRcdFx0XHRcdFx0aW1hZ2VTdGF0dXMgOiBmYWxzZSxcblx0XHRcdFx0XHRcdFx0XHRpbWdVcGxvYWQgOiBmYWxzZVxuXHRcdFx0XHRcdFx0XHR9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgXHRfdGhpcy5yZWZzLnVwbG9hZEltYWdlLnNyYyA9IHhocmZpbGUucmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFx0X3RoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRcdFx0XHRcdGltYWdlU3RhdHVzIDogdHJ1ZSxcblx0XHRcdFx0XHRcdFx0XHRpbWdVcGxvYWQgOiB0cnVlLFxuXHRcdFx0XHRcdFx0XHRcdG9wZXJhdGVJbWcgOiBmYWxzZVxuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0Y29uc3Qge2lucHV0fT1fdGhpcy5wcm9wcztcblx0XHRcdFx0XHRcdFx0aW5wdXQub25DaGFuZ2UoeGhyZmlsZS5yZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpbWFnZS5zcmM9IGRhdGE7XG4gICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGVEYXRhKTtcbiBcbiAgICAgICAgICAgICB9XG5cdH1cblx0Ly8g5Yig6Zmk5Zu+54mHXG5cdGRlbGV0ZUltZz0oKT0+e1xuXHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0aW1nU3JjOiBcIlwiLFxuXHRcdFx0aW1nVXBsb2FkOiBmYWxzZSxcblx0XHRcdG9wZXJhdGVJbWcgOmZhbHNlXG5cdFx0fSlcblx0XHR0aGlzLnJlZnMuaW5wdXRJbWcudmFsdWUgPVwiXCI7XG5cdFx0dGhpcy5yZWZzLmlucHV0SW1nTmV3LnZhbHVlID1cIlwiO1xuXHRcdHRoaXMucmVmcy51cGxvYWRJbWFnZS5zcmM9XCJcIjtcblx0XHRjb25zdCB7aW5wdXR9PXRoaXMucHJvcHM7XG5cdFx0aW5wdXQub25DaGFuZ2UoXCJcIik7XG5cdH1cblx0cmVuZGVyKCkge1xuXHRcdGxldCB7Y2hpbGRyZW4sY2xhc3NOYW1lLHN0eWxlLHR5cGUsbmFtZSxkaXNhYmxlZCxwaG90b1NpemUscGljdHVyZUZvcm1hdCxwaWN0dXJlTWVtb3J5LHJlcXVlc3RVUkksLi4ub3RoZXJ9ID0gdGhpcy5wcm9wcztcblx0XHRsZXQge29wZXJhdGVJbWd9ID0gdGhpcy5zdGF0ZTtcblx0XHQvLyBjb25zb2xlLmxvZyhcInRoaXMuc3RhdGUub3BlcmF0ZUltZ1wiLHRoaXMuc3RhdGUub3BlcmF0ZUltZylcblx0XHRyZXR1cm4oXG5cdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cInVpLXVwbG9hZGltZy1ib3hcIiBzdHlsZT17c3R5bGV9PlxuXHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT0ndWktdXBsb2FkaW1nLW91dGJveCcgPlxuXHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPSd1aS11cGxvYWRpbWctaW5uZXJib3gnIG9uTW91c2VFbnRlcj17dGhpcy5vcGVyYXRpb25JbWd9IG9uTW91c2VMZWF2ZT17dGhpcy5ub3RPcGVyYXRlSW1nfT5cblx0XHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPSd1aS11cGxvYWRpbWctaW5uZXInID5cblx0XHRcdFx0XHRcdFx0PGltZyBjbGFzc05hbWU9XCJpbWFnZVwiICBzcmM9e3RoaXMuc3RhdGUuaW1nU3JjfSAgcmVmPVwidXBsb2FkSW1hZ2VcIiAvPlxuXHRcdFx0XHRcdFx0XHQ8c3BhbiBjbGFzc05hbWU9J3VpLXVwbG9hZGltZy1idXR0b24nPis8L3NwYW4+XG5cdFx0XHRcdFx0XHRcdDxpbnB1dCB0eXBlPSdmaWxlJyBvbkNoYW5nZT17dGhpcy5vbkNoYW5nZX0gcmVmPVwiaW5wdXRJbWdcIi8+XG5cdFx0XHRcdFx0XHRcdDxzcGFuIGNsYXNzTmFtZT0ndWktdXBsb2FkaW1nLXRpcCc+5LiK5Lyg5Zu+54mHPC9zcGFuPlxuXHRcdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cInVpLXVwbG9hZGltZy1mcmVzaC1kZWxldGVcIiBzdHlsZT17e2Rpc3BsYXk6dGhpcy5zdGF0ZS5vcGVyYXRlSW1nP1wiYmxvY2tcIjpcIm5vbmVcIn19PlxuXHRcdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cInVpLXVwbG9hZGltZy1vcGVyYXRlaW1nIHVpLXVwbG9hZGltZy1vcGVyYXRlaW1nLWxlZnRcIiBvbkNsaWNrPXt0aGlzLnJlRnJlc2hJbWd9PlxuXHRcdFx0XHRcdFx0XHRcdDxpbWcgc3JjPXtyZWZyZXNofSBjbGFzc05hbWU9XCJ1aS11cGxvYWRpbWctb3BlcmF0ZWltZy1idG4gdWktdXBsb2FkaW1nLW9wZXJhdGVpbWctcmVmcmVzaFwiLz5cblx0XHRcdFx0XHRcdFx0XHQ8aW5wdXQgdHlwZT0nZmlsZScgb25DaGFuZ2U9e3RoaXMub25DaGFuZ2V9IHJlZj1cImlucHV0SW1nTmV3XCIgY2xhc3NOYW1lPVwidWktcmVmcmVzaEltZ0J0blwiLz5cblx0XHRcdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwidWktdXBsb2FkaW1nLW9wZXJhdGVpbWcgdWktdXBsb2FkaW1nLW9wZXJhdGVpbWctcmlnaHRcIiBvbkNsaWNrPXt0aGlzLmRlbGV0ZUltZ30+XG5cdFx0XHRcdFx0XHRcdFx0PGltZyBzcmM9e2RlbGV0ZUltZ30gY2xhc3NOYW1lPVwidWktdXBsb2FkaW1nLW9wZXJhdGVpbWctYnRuIHVpLXVwbG9hZGltZy1vcGVyYXRlaW1nLWRlbGV0ZVwiLz5cblx0XHRcdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdFx0XHQ8L2Rpdj5cblx0XHRcdFx0XHQ8L2Rpdj5cblx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdDxwIGNsYXNzTmFtZT1cInVpLXVwbG9hZGltZy1ub3RpY2VcIj5cblx0XHRcdFx0XHTmj5DnpLrvvJrlm77niYflsLrlr7jkuLp7cGhvdG9TaXplfe+8jOWbvueJh+Wwj+S6jntwaWN0dXJlTWVtb3J5fSzmoLzlvI/kuLp7cGljdHVyZUZvcm1hdH1cblx0XHRcdFx0PC9wPlxuXHRcdFx0XHQ8cCBjbGFzc05hbWU9XCJ1aS11cGxvYWRpbWctZXJyb3JcIiBzdHlsZT17e2Rpc3BsYXk6dGhpcy5zdGF0ZS5lcnJvckhpZGU/XCJub25lXCI6XCJibG9ja1wifX0gPlxuXHRcdFx0XHRcdHt0aGlzLnN0YXRlLmVycm9yVGlwfVxuXHRcdFx0XHQ8L3A+XG5cdFx0XHQ8L2Rpdj5cblx0XHQpO1xuXHR9XG59XG4iXX0=