'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _class;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Redux = require('kr/Redux');

var _reduxForm = require('redux-form');

var _mobxReact = require('mobx-react');

var _krUi = require('kr-ui');

var _State = require('./State');

var _State2 = _interopRequireDefault(_State);

var _State3 = require('../Merchants/State');

var _State4 = _interopRequireDefault(_State3);

var _State5 = require('../Personal/State');

var _State6 = _interopRequireDefault(_State5);

var _State7 = require('../SignedClient/State');

var _State8 = _interopRequireDefault(_State7);

var _State9 = require('../LookCustomerList/State');

var _State10 = _interopRequireDefault(_State9);

require('./index.less');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var NewVisitIndent = (0, _mobxReact.observer)(_class = function (_Component) {
	_inherits(NewVisitIndent, _Component);

	function NewVisitIndent(props) {
		_classCallCheck(this, NewVisitIndent);

		var _this2 = _possibleConstructorReturn(this, (NewVisitIndent.__proto__ || Object.getPrototypeOf(NewVisitIndent)).call(this, props));

		_this2.onSubmit = function (values) {
			var _this2$props = _this2.props,
			    listId = _this2$props.listId,
			    operType = _this2$props.operType;

			var _this = _this2;
			_Redux.Store.dispatch(_Redux.Actions.callAPI('customerVisitRecord', {}, values)).then(function (response) {
				_State10.default.lookListId(listId, operType);
				if (operType == "SHARE") {
					_State4.default.searchParams = {
						page: 1,
						pageSize: 15,
						time: +new Date()
					};
				}
				if (operType == "PERSON") {
					_State6.default.searchParams = {
						page: 1,
						pageSize: 15,
						time: +new Date()
					};
				}
				if (operType == "SIGN") {
					_State8.default.searchParams = {
						page: 1,
						pageSize: 15,
						time: +new Date()
					};
				}
				_State4.default.openDialog = false;
				_State6.default.openPersonDialog = false;
				_State8.default.openPersonDialog = false;
				_this.onCancel();
			}).catch(function (err) {
				_krUi.Message.error(err.message);
			});
		};

		_this2.onCancel = function () {
			var onCancel = _this2.props.onCancel;

			onCancel && onCancel();
		};

		_this2.hasSelectClick = function (params) {
			if (params.value == "NO") {
				_Redux.Store.dispatch((0, _reduxForm.change)('NewVisitIndent', 'reasonId', ''));
				_State2.default.showMatureTime();
			} else if (params.value == "YES") {
				_State2.default.noShowMatureTime();
				_State2.default.noShowOtherContinue();
			}
		};

		_this2.otherContinue = function (value) {
			if (value) {
				if (value.label == '其他') {
					_State2.default.showOtherContinue();
				} else {
					_State2.default.noShowOtherContinue();
				}
			} else {
				_State2.default.noShowOtherContinue();
			}
		};

		_this2.renderContinue = function () {
			var selectDatas = _this2.props.selectDatas;

			var content = '';
			if (_State2.default.matureTime) {
				content = _react2.default.createElement(_krUi.KrField, { grid: 1 / 2, label: '\u653E\u5F03\u539F\u56E0', name: 'reasonId', style: { width: 261, marginLeft: -6 }, component: 'select',
					options: selectDatas.giveupList,
					requireLabel: true,
					onChange: _this2.otherContinue
				});
			}
			return content;
		};

		_this2.renderOtherContinue = function () {
			var content = '';
			if (_State2.default.otherContinue) {
				content = _react2.default.createElement(_krUi.KrField, { grid: 1 / 2, label: '\u5176\u4ED6\u539F\u56E0', name: 'reasonOther', style: { width: 261, marginLeft: 29 }, component: 'input',
					requireLabel: true
				});
			}
			return content;
		};

		return _this2;
	}

	_createClass(NewVisitIndent, [{
		key: 'componentDidMount',
		value: function componentDidMount() {
			_State2.default.noShowMatureTime();
			_State2.default.noShowOtherContinue();
		}
	}, {
		key: 'render',
		value: function render() {
			var _props = this.props,
			    error = _props.error,
			    handleSubmit = _props.handleSubmit,
			    pristine = _props.pristine,
			    reset = _props.reset,
			    selectDatas = _props.selectDatas;


			return _react2.default.createElement(
				'form',
				{ className: 'm-newVisitIndent', onSubmit: handleSubmit(this.onSubmit) },
				_react2.default.createElement(
					'div',
					{ className: 'title' },
					_react2.default.createElement(
						'div',
						null,
						_react2.default.createElement('span', { className: 'new-icon' }),
						_react2.default.createElement(
							'label',
							{ className: 'title-text', style: { marginLeft: 7 } },
							this.props.companyName
						)
					),
					_react2.default.createElement('div', { className: 'close', onClick: this.onCancel })
				),
				_react2.default.createElement(
					'div',
					{ className: 'kk', style: { marginTop: 27, marginLeft: 40 } },
					_react2.default.createElement(_krUi.KrField, { name: 'customerId', type: 'hidden' }),
					_react2.default.createElement(_krUi.KrField, { grid: 1 / 2, label: '\u62DC\u8BBF\u65B9\u5F0F', name: 'visitType', style: { width: 261, marginLeft: -6 }, component: 'select',
						options: selectDatas.visitTypeList,
						requireLabel: true
					}),
					_react2.default.createElement(_krUi.KrField, { grid: 1 / 2, label: '\u62DC\u8BBF\u65F6\u95F4', name: 'visitTime', style: { width: 260, marginLeft: 29 }, component: 'date', requireLabel: true }),
					_react2.default.createElement(_krUi.KrField, { grid: 1 / 2, label: '\u8054\u7CFB\u4EBA', name: 'linkName', style: { width: 261, marginLeft: -6 }, component: 'input', requireLabel: true }),
					_react2.default.createElement(_krUi.KrField, { grid: 1 / 2, label: '\u5BA2\u6237\u5206\u7C7B', name: 'levelId', component: 'select', style: { width: 261, marginLeft: 29 },
						options: selectDatas.levelList,
						requireLabel: true
					}),
					_react2.default.createElement(_krUi.KrField, { grid: 1 / 2, label: '\u8054\u7CFB\u65B9\u5F0F', name: 'linkTel', style: { width: 261, marginLeft: -6 }, component: 'input', requireLabel: true }),
					_react2.default.createElement(
						_krUi.KrField,
						{ grid: 1 / 2, label: '\u662F\u5426\u7EE7\u7EED\u8DDF\u8FDB', name: 'isContinue', style: { width: 261, marginLeft: 29 }, component: 'group', requireLabel: true },
						_react2.default.createElement(_krUi.KrField, { name: 'isContinue', label: '\u662F', value: 'YES', component: 'radio', type: 'radio', onClick: this.hasSelectClick }),
						_react2.default.createElement(_krUi.KrField, { name: 'isContinue', label: '\u5426', value: 'NO', component: 'radio', type: 'radio', onClick: this.hasSelectClick })
					),
					this.renderContinue(),
					this.renderOtherContinue(),
					_react2.default.createElement(
						'div',
						{ className: 'speakInfo' },
						_react2.default.createElement(_krUi.KrField, { grid: 1, label: '\u6C9F\u901A\u60C5\u51B5', name: 'visitDetail', style: { marginLeft: -6, marginTop: 3 }, heightStyle: { height: "80px", width: '543px' }, component: 'textarea', maxSize: 100, requireLabel: true, placeholder: '\u8BF7\u8F93\u5165\u6C9F\u901A\u60C5\u51B5', lengthClass: 'order-textarea' })
					),
					_react2.default.createElement(_krUi.KrField, { grid: 1, label: '\u5907\u6CE8', name: 'remark', style: { marginLeft: -6, marginTop: -17 }, heightStyle: { height: "80px", width: '543px' }, component: 'textarea', maxSize: 100, placeholder: '\u8BF7\u8F93\u5165\u63CF\u8FF0', lengthClass: 'visit-length-textarea' })
				),
				_react2.default.createElement(
					_krUi.Grid,
					{ style: { marginRight: 30 } },
					_react2.default.createElement(
						_krUi.Row,
						null,
						_react2.default.createElement(
							_krUi.Col,
							{ md: 12, align: 'center' },
							_react2.default.createElement(
								_krUi.ButtonGroup,
								null,
								_react2.default.createElement(
									'div',
									{ className: 'ui-btn-center' },
									_react2.default.createElement(_krUi.Button, { label: '\u786E\u5B9A', type: 'submit' })
								),
								_react2.default.createElement(_krUi.Button, { label: '\u53D6\u6D88', type: 'button', cancle: true, onTouchTap: this.onCancel })
							)
						)
					)
				)
			);
		}
	}]);

	return NewVisitIndent;
}(_react.Component)) || _class;

NewVisitIndent.PropTypes = {
	onSubmit: _react2.default.PropTypes.func,
	onCancel: _react2.default.PropTypes.func
};

var validate = function validate(values) {

	var errors = {};
	var phone = /(^((\+86)|(86))?[1][3456789][0-9]{9}$)|(^(0\d{2,3}-\d{7,8})(-\d{1,4})?$)/;
	//let email = /^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/;
	if (!values.visitType) {
		errors.visitType = '请填写拜访方式';
	}
	if (!values.visitTime) {
		errors.visitTime = '请填写拜访时间';
	}

	if (!values.linkName) {
		errors.linkName = '请填写联系人姓名';
	}

	if (!values.levelId) {
		errors.levelId = '请填写客户分类';
	}

	if (!values.linkTel) {
		errors.linkTel = '请填写联系人电话';
	} else if (!phone.test(values.linkTel)) {
		errors.linkTel = '联系人电话格式错误';
	}

	if (!values.reasonId) {
		errors.reasonId = '请填写放弃原因';
	}

	if (!values.reasonOther) {
		errors.reasonOther = '请填写其他原因';
	} else if (values.reasonOther.length > 50) {
		errors.reasonOther = '其他原因最多填写50个字';
	}

	if (!values.visitDetail) {
		errors.visitDetail = '请填写沟通情况';
	}

	return errors;
};

var _default = (0, _reduxForm.reduxForm)({ form: 'NewVisitIndent', validate: validate })(NewVisitIndent);

exports.default = _default;
;

var _temp = function () {
	if (typeof __REACT_HOT_LOADER__ === 'undefined') {
		return;
	}

	__REACT_HOT_LOADER__.register(NewVisitIndent, 'NewVisitIndent', '/Users/dongfanai/Desktop/project/kr-admin/src/Containers/Operation/CustomerManage/CustomerList/NewVisitIndent/index.js');

	__REACT_HOT_LOADER__.register(validate, 'validate', '/Users/dongfanai/Desktop/project/kr-admin/src/Containers/Operation/CustomerManage/CustomerList/NewVisitIndent/index.js');

	__REACT_HOT_LOADER__.register(_default, 'default', '/Users/dongfanai/Desktop/project/kr-admin/src/Containers/Operation/CustomerManage/CustomerList/NewVisitIndent/index.js');
}();

;