{"version":3,"sources":["src/Containers/Operation/BasicConfig/EquipmentDefinition/BatchUploadImageForm.js"],"names":["BatchUploadImageForm","props","context","onCancel","closeBatchUpload","openFinishTable","onSubmit","values","_this","uploadImage","tipOpen","communitys","tipCommunityOpen","setState","submitValuesParams","selectedCommunitys","picUrl","getRealEquipment","valuesParams","deviceId","dispatch","callAPI","then","response","length","seleletZero","submitCommunitys","submitNum","totalNum","openBatchUploadNum","catch","err","show","message","type","batchUploadNum","state","closeSchedule","openSchedule","openScheduleDiv","confirmSubmit","sendRealEquipment","timer","setInterval","split","innerBoxWidth","Number","uploadedNum","window","clearInterval","submitValues","requestURI","handleSubmit","detail","marginTop","getList","marginBottom","width","textAlign","padding","paddingRight","paddingLeft","height","position","left","top","fontSize","color","display","form"],"mappings":"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","file":"BatchUploadImageForm.js","sourceRoot":"/Users/liuyihao/Code/kr-admin","sourcesContent":["import React, {Component, PropTypes} from 'react';\nimport {connect} from 'kr/Redux';\nimport {reduxForm,formValueSelector,change,initialize,arrayPush,arrayInsert,FieldArray,reset} from 'redux-form';\nimport {Actions,Store} from 'kr/Redux';\nimport {\n\tUploadImage,\n\tKrField,\n\tGrid,\n\tRow,\n\tListGroup,\n\tListGroupItem,\n\tButton,\n\tDialog,\n\tNotify\n} from 'kr-ui';\nimport \"./index.less\";\nclass BatchUploadImageForm extends Component{\n\tconstructor(props,context){\n\t\tsuper(props,context);\n\t\tthis.state={\n\t\t\tpicUrl:'',\n\t\t\tselectedCommunitys:[],\n\t\t\tbatchUploadNum :false,\n\t\t\topenSchedule : false,\n\t\t\tsubmitValues : '',\n\t\t\tsubmitNum : 0,\n\t\t\tinnerBoxWidth :0,\n\t\t\tuploadedNum:0,\n\t\t\ttotalNum:0,\n\t\t\tsubmitValuesParams:{},\n\t\t\trequestURI:\"postEquipmentImg\",\n\t\t\tcommunitys: []\n\t\t}\n\t}\n\t// 首次加载获取社区列表\n\tcomponentDidMount(){\n\t}\n\tonCancel=()=>{\n\t\tlet {onCancel} = this.props;\n\t\tonCancel && onCancel();\n\t}\n\tcloseBatchUpload=()=>{\n\t\tlet {closeBatchUpload}=this.props;\n\t\tcloseBatchUpload && closeBatchUpload();\n\t}\n\topenFinishTable=()=>{\n\t\tconst {openFinishTable}=this.props;\n\t\topenFinishTable && openFinishTable();\n\t}\n\t\n\t// 提交(获取总共上传社区个数)\n\tonSubmit=(values)=>{\n\t\tlet _this =this;\n\t\tif(!values.uploadImage){\n\t\t\tconst {tipOpen} = this.props;\n\t\t\ttipOpen && tipOpen();\n\t\t\treturn\n\t\t};\n\t\tif(!values.communitys){\n\t\t\tconst {tipCommunityOpen} = this.props;\n\t\t\ttipCommunityOpen && tipCommunityOpen();\n\t\t\treturn\n\t\t};\n\t\tthis.setState({\n\t\t\tsubmitValuesParams : values,\n\t\t\tselectedCommunitys : values.communitys,\n\t\t\tpicUrl : values.uploadImage\n\t\t})\n\t\t_this.getRealEquipment(values);\n\t}\n\t// 获取真实设备数\n\tgetRealEquipment=(values)=>{\n\t\tlet _this =this;\n\t\tlet valuesParams = {\n\t\t\tdeviceId:values.communitys\n\t\t}\n\t\tStore.dispatch(Actions.callAPI('getEquipmentNum',{},valuesParams))\n\t      .then(function(response){\n\t      \tif(response.length == 0){\n\t      \t\tconst {seleletZero} = _this.props;\n\t      \t\tseleletZero && seleletZero();\n\t      \t\treturn;\n\t      \t}\n\t      \t_this.setState({\n\t      \t\tsubmitCommunitys : response,\n\t      \t\tsubmitNum : response.length,\n\t      \t\ttotalNum : response.length\n\t      \t},function(){\n\t      \t\tthis.openBatchUploadNum();\n\t      \t})\n\n\t      }).catch(function(err){\n\t        Notify.show([{\n\t          message: err.message,\n\t          type: 'danger',\n\t        }])\n\t    });\n\t    \n\t}\n\t// 是否打开确定上传窗口\n\topenBatchUploadNum=()=>{\n\t\tthis.setState({\n\t\t\tbatchUploadNum : !this.state.batchUploadNum\n\t\t})\n\t}\n\t// 关闭进度条\n\tcloseSchedule=()=>{\n\t\tthis.setState({\n\t\t\topenSchedule : false\n\t\t})\n\t}\n\t// 是否打开进度条\n\topenScheduleDiv=()=>{\n\t\tthis.setState({\n\t\t\topenSchedule : !this.state.openSchedule\n\t\t})\n\t}\n\t// 确定开始上传\n\tconfirmSubmit=()=>{\n\t\tlet _this = this;\n\t\t_this.openBatchUploadNum();\n\t\tlet sendRealEquipment = {\n\t\t\tdeviceId : _this.state.selectedCommunitys,\n\t\t\tpicUrl : _this.state.picUrl\n\t\t}\n\t    Store.dispatch(Actions.callAPI('oploadImgToEquipment',{},sendRealEquipment))\n\t      .then(function(response){\n\t      }).catch(function(err){\n\t        Notify.show([{\n\t          message: err.message,\n\t          type: 'danger',\n\t        }])\n\t    });\n\t    _this.openBatchUploadNum();\n\t    _this.openScheduleDiv();\n\t\tvar timer = setInterval(function(){\n\t\t\tStore.dispatch(Actions.callAPI('getPushImgRes',\"\"))\n\t\t\t.then(function(response){\n\t\t\t\tresponse = response.split(\"|\");\n\t\t\t\t_this.setState({\n\t\t\t\t\tinnerBoxWidth : Number((response[0]/response[1])*298),\n\t\t\t\t\tuploadedNum:response[0],\n\t\t\t\t\ttotalNum:response[1]\n\t\t\t\t})\n\t\t\t\tif(response[0] == response[1]){\n\t\t\t\t\t_this.setState({\n\t\t\t\t\t\topenSchedule : false\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\twindow.clearInterval(timer);\n\t\t\t\t\ttimer = null;\n\t\t\t\t\tif(timer == null){\n\t\t\t\t\t\t_this.closeSchedule();\n\t\t\t\t\t\t_this.closeBatchUpload();\n\t\t\t\t\t\t_this.openFinishTable();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t},1000);\n\t}\n\trender(){\n\t\tlet {communitys}=this.state;\n\t\tconst {handleSubmit,detail}=this.props;\n\t\treturn(\n\t\t\t\n\t\t\t\t<form onSubmit={handleSubmit(this.onSubmit)}>\n\t\t\t\t\t<KrField name=\"uploadImage\" \n\t\t\t\t\t\tcomponent=\"uploadImage\" \n\t\t\t\t\t\tstyle={{marginTop:10}} \n\t\t\t\t\t\tphotoSize={'212*136'} \n\t\t\t\t\t\tpictureFormat={'JPG'} \n\t\t\t\t\t\tpictureMemory={'32K'}\n\t\t\t\t\t\trequestURI = {this.state.requestURI}\n\t\t\t\t\t/>\n\t\t\t\t\t<KrField name=\"communitys\" \n\t\t\t\t\t\toptions={communitys} \n\t\t\t\t\t\tcomponent=\"doorCard\" \n\t\t\t\t\t\tdefaultValue={communitys}\n\t\t\t\t\t\tgetList={this.getList}\n\t\t\t\t\t/>\n\t\t\t\t\t<Grid style={{marginTop:25,marginBottom:'4px'}}>\n\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t<ListGroup>\n\t\t\t\t\t\t\t\t<ListGroupItem style={{width:'305px',textAlign:'right',padding:0,paddingRight:15}}>\n\t\t\t\t\t\t\t\t\t<Button  label=\"开始上传\" type=\"submit\"/>\n\t\t\t\t\t\t\t\t</ListGroupItem>\n\t\t\t\t\t\t\t\t<ListGroupItem style={{width:'254px',textAlign:'left',padding:0,paddingLeft:15}}>\n\t\t\t\t\t\t\t\t\t<Button  label=\"取消\" type=\"button\"  cancle={true} onTouchTap={this.onCancel} />\n\t\t\t\t\t\t\t\t</ListGroupItem>\n\t\t\t\t\t\t\t</ListGroup>\t\t\t\t\t\n\t\t\t\t\t\t</Row>\n\t\t\t\t\t</Grid>\n\t\t\t\t\t<Dialog\n\t\t\t          title=\"提示\"\n\t\t\t          open={this.state.batchUploadNum}\n\t\t\t          onClose={this.openBatchUploadNum}\n\t\t\t          contentStyle={{width:443,height:237,position:\"absolute\",left:\"123\",top:\"43%\"}}\n\t\t        \t>\n\t\t\t        \t<div style={{marginTop:45}}>\n\t\t\t        \t\t<p style={{fontSize:14,color:\"#333333\",textAlign:\"center\"}}>本次将上传{this.state.submitNum}台大门门禁设备，确定上传图片？</p>\n\t\t\t        \t\t<Grid style={{marginTop:60,marginBottom:'4px'}}>\n\t\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t\t<ListGroup>\n\t\t\t\t\t\t\t\t\t\t<ListGroupItem style={{width:'171px',textAlign:'right',padding:0,paddingRight:15}}>\n\t\t\t\t\t\t\t\t\t\t\t<Button  label=\"确定\" type=\"button\" onClick={this.confirmSubmit}/>\n\t\t\t\t\t\t\t\t\t\t</ListGroupItem>\n\t\t\t\t\t\t\t\t\t\t<ListGroupItem style={{width:'171px',textAlign:'left',padding:0,paddingLeft:15}}>\n\t\t\t\t\t\t\t\t\t\t\t<Button  label=\"取消\" type=\"button\"  cancle={true} onTouchTap={this.openBatchUploadNum} />\n\t\t\t\t\t\t\t\t\t\t</ListGroupItem>\n\t\t\t\t\t\t\t\t\t</ListGroup>\t\t\t\t\t\n\t\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t\t</Grid>\n\t\t\t        \t</div>\n\t\t\t        </Dialog>\n\t\t\t        <div className=\"uploadImageNum\" style={{display:this.state.openSchedule?\"block\":\"none\"}}>\n\t\t\t        \t<div className=\"uploadImageNumBox\" >\n\t\t\t        \t\t<p className=\"uploadImageProgress\" >{this.state.uploadedNum}/{this.state.totalNum}上传中...</p>\n\t\t\t\t        \t<div className=\"uploadImageProgressBar\">\n\t\t\t\t        \t\t<div className=\"uploadImageProgressBarIndex\" style={{width:this.state.innerBoxWidth}}></div>\n\t\t\t\t        \t</div>\n\t\t\t        \t</div>\n\t\t\t        </div>\n\t\t\t\t</form>\n\t\t\t\n\t\t);\n\t}\n}\nexport default BatchUploadImageForm = reduxForm({\n\tform: 'BatchUploadImageForm',\n\t// validate,\n})(BatchUploadImageForm);\n\n\n\n"]}