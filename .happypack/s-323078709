'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Redux = require('kr/Redux');

var _reactBinding = require('react-binding');

var _Utils = require('kr/Utils');

var _reduxForm = require('redux-form');

var _krUi = require('kr-ui');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var SelectStationForm = function (_Component) {
	_inherits(SelectStationForm, _Component);

	function SelectStationForm(props, context) {
		_classCallCheck(this, SelectStationForm);

		var _this2 = _possibleConstructorReturn(this, (SelectStationForm.__proto__ || Object.getPrototypeOf(SelectStationForm)).call(this, props, context));

		_this2.onSubmit = _this2.onSubmit.bind(_this2);
		_this2.onCancel = _this2.onCancel.bind(_this2);
		_this2.onSelect = _this2.onSelect.bind(_this2);
		_this2.getLoadData = _this2.getLoadData.bind(_this2);
		_this2.onChangeRentBeginDate = _this2.onChangeRentBeginDate.bind(_this2);

		_this2.state = {
			stationVos: [],
			selected: []
		};

		return _this2;
	}

	_createClass(SelectStationForm, [{
		key: 'componentDidMount',
		value: function componentDidMount() {
			this.getLoadData();
		}
	}, {
		key: 'onChangeRentBeginDate',
		value: function onChangeRentBeginDate(value) {
			value = (0, _Utils.DateFormat)(value, 'yyyy-mm-dd') + ' 00:00:00';

			var leaseBegindate = this.props.changeValues.leaseBegindate;
			//判断选择的时间是否大于租赁起始时间

			var beginDate = Date.parse((0, _Utils.DateFormat)(leaseBegindate, 'yyyy-mm-dd') + ' 00:00:00');
			var rentBeginDate = Date.parse(value);

			// if (beginDate > rentBeginDate) {
			// 	Notify.show([{
			// 		message: '选择的续租开始时间小于租赁期限的起始时间',
			// 		type: 'danger',
			// 	}]);
			// 	return false;
			// }


			var _state = this.state,
			    stationVos = _state.stationVos,
			    selected = _state.selected;

			stationVos = [].concat(stationVos);
			stationVos.map(function (item, index) {
				if (selected.indexOf(index) !== -1) {
					item.rentBeginDate = value;
				} else {
					item.rentBeginDate = '';
				}
				return item;
			});

			this.setState({
				stationVos: stationVos
			});
		}
	}, {
		key: 'getLoadData',
		value: function getLoadData() {
			var _this = this;
			var params = this.context.params;

			_Redux.Store.dispatch(_Redux.Actions.callAPI('getStationOrSettingList', {
				mainBillid: params.orderId,
				page: 1,
				pagesize: 100,
				contractId: params.id
			})).then(function (response) {
				console.log('response', response);
				response.items = response.items.map(function (item) {
					if (item.show) {
						item.rentBeginDate = item.lastEditDate;
					}
					return item;
				});
				console.log('response.items', response.items);
				_this.setState({
					stationVos: response.items
				});
			}).catch(function (err) {
				console.log(err);
				_krUi.Notify.show([{
					message: '后台出错请联系管理员',
					type: 'danger'
				}]);
			});
		}
	}, {
		key: 'onSelect',
		value: function onSelect(selected) {
			this.setState({
				selected: selected
			}, function () {});
		}
	}, {
		key: 'onSubmit',
		value: function onSubmit() {
			var _state2 = this.state,
			    stationVos = _state2.stationVos,
			    selected = _state2.selected;

			var selectedStationVos = [];

			selectedStationVos = stationVos.filter(function (item, index) {
				if (selected.indexOf(index) !== -1) {
					return true;
				}
				return false;
			});

			if (!selectedStationVos.length) {
				_krUi.Notify.show([{
					message: '请选择工位',
					type: 'danger'
				}]);

				return;
			}

			//选中的必须要有租赁结束日期
			var someStartDate = true;

			selectedStationVos.forEach(function (item, index) {
				if (!item.rentBeginDate) {
					someStartDate = false;
				}
			});

			if (!someStartDate) {
				_krUi.Notify.show([{
					message: '选择的工位必须要有相同的续租结束时间',
					type: 'danger'
				}]);
				return;
			}

			//工位结束时间相同
			var some = true;
			selectedStationVos.sort(function (pre, next) {
				var preDate = (0, _Utils.DateFormat)(pre.leaseEndDate, 'yyyy-mm-dd');
				var nextDate = (0, _Utils.DateFormat)(next.leaseEndDate, 'yyyy-mm-dd');
				if (preDate != nextDate) {
					some = false;
				}
				return -1;
			});

			if (!some) {
				_krUi.Notify.show([{
					message: '请选择相同日期',
					type: 'danger'
				}]);
				return false;
			}

			//修改日期
			var resultStationVos = [];
			selectedStationVos.forEach(function (item, index) {
				var obj = {};
				obj.id = item.id;
				obj.stationId = item.stationId;
				obj.stationType = item.stationType;
				obj.stationName = item.stationName;
				obj.whereFloor = item.whereFloor;
				obj.unitprice = item.unitprice;
				obj.leaseBeginDate = (0, _Utils.DateFormat)(item.leaseEndDate, 'yyyy-mm-dd');
				obj.leaseEndDate = item.rentBeginDate;
				resultStationVos.push(obj);
			});

			selectedStationVos = resultStationVos;

			var beginDate = Date.parse(selectedStationVos[0].leaseBeginDate);
			var endDate = Date.parse(selectedStationVos[0].leaseEndDate);

			if (beginDate > endDate) {
				_krUi.Notify.show([{
					message: '续租结束时间要大于选择的工位租赁结束时间',
					type: 'danger'
				}]);
				return false;
			}

			_Redux.Store.dispatch((0, _reduxForm.change)('reduceCreateForm', 'leaseBegindate', selectedStationVos[0].leaseEndDate));

			selectedStationVos.forEach(function (item, index) {
				var tmpDate = new Date();
				tmpDate.setTime(Date.parse(item.leaseBeginDate));
				tmpDate.setDate(tmpDate.getDate() + 1);
				item.leaseBeginDate = (0, _Utils.DateFormat)(tmpDate, 'yyyy-mm-dd');
			});

			console.log('selectedStationVos', selectedStationVos);

			var onSubmit = this.props.onSubmit;

			onSubmit && onSubmit(selectedStationVos);
		}
	}, {
		key: 'onCancel',
		value: function onCancel() {
			var onCancel = this.props.onCancel;

			onCancel && onCancel();
		}
	}, {
		key: 'render',
		value: function render() {
			var _props = this.props,
			    error = _props.error,
			    handleSubmit = _props.handleSubmit,
			    pristine = _props.pristine,
			    reset = _props.reset,
			    submitting = _props.submitting,
			    changeValues = _props.changeValues;
			var stationVos = this.state.stationVos;

			var overfolw = {
				'overflow': 'hidden',
				maxHeight: 510
			};
			var height = {
				height: stationVos.length * 45,
				maxHeight: 667
			};
			return _react2.default.createElement(
				'div',
				{ style: { height: 667, marginTop: 20 } },
				_react2.default.createElement(
					'form',
					{ onSubmit: handleSubmit(this.onSubmit) },
					_react2.default.createElement(_krUi.KrField, { grid: 1 / 2, name: 'rentBeginDate', component: 'date', label: '\u7EED\u79DF\u7ED3\u675F\u65F6\u95F4\uFF1A', onChange: this.onChangeRentBeginDate, inline: true }),
					_react2.default.createElement(
						_krUi.Table,
						{ onSelect: this.onSelect, style: overfolw },
						_react2.default.createElement(
							_krUi.TableHeader,
							null,
							_react2.default.createElement(
								_krUi.TableHeaderColumn,
								null,
								'\u7C7B\u522B'
							),
							_react2.default.createElement(
								_krUi.TableHeaderColumn,
								null,
								'\u7F16\u53F7\uFF0F\u540D\u79F0'
							),
							_react2.default.createElement(
								_krUi.TableHeaderColumn,
								null,
								'\u5355\u4EF7\uFF08\u5143\uFF0F\u6708\uFF09'
							),
							_react2.default.createElement(
								_krUi.TableHeaderColumn,
								null,
								'\u8D77\u59CB\u65E5\u671F'
							),
							_react2.default.createElement(
								_krUi.TableHeaderColumn,
								null,
								'\u7ED3\u675F\u65E5\u671F'
							),
							_react2.default.createElement(
								_krUi.TableHeaderColumn,
								null,
								'\u7EED\u79DF\u7ED3\u675F\u65F6\u95F4'
							)
						),
						_react2.default.createElement(
							_krUi.TableBody,
							null,
							stationVos && stationVos.map(function (item, index) {
								return _react2.default.createElement(
									_krUi.TableRow,
									{ key: index },
									_react2.default.createElement(
										_krUi.TableRowColumn,
										null,
										item.stationType == 1 ? '工位' : '会议室'
									),
									_react2.default.createElement(
										_krUi.TableRowColumn,
										null,
										item.stationName
									),
									_react2.default.createElement(
										_krUi.TableRowColumn,
										null,
										item.unitprice
									),
									_react2.default.createElement(
										_krUi.TableRowColumn,
										null,
										_react2.default.createElement(_krUi.KrDate, { value: item.leaseBeginDate })
									),
									_react2.default.createElement(
										_krUi.TableRowColumn,
										null,
										_react2.default.createElement(_krUi.KrDate, { value: item.leaseEndDate })
									),
									_react2.default.createElement(
										_krUi.TableRowColumn,
										null,
										item.rentBeginDate && (0, _Utils.DateFormat)(item.rentBeginDate, 'yyyy-mm-dd')
									)
								);
							})
						)
					),
					_react2.default.createElement(
						_krUi.Grid,
						null,
						_react2.default.createElement(
							_krUi.Row,
							{ style: { marginTop: 30, paddingBottom: 24 } },
							_react2.default.createElement(_krUi.Col, { md: 4 }),
							_react2.default.createElement(
								_krUi.Col,
								{ md: 2, align: 'right' },
								' ',
								_react2.default.createElement(_krUi.Button, { label: '\u786E\u5B9A', type: 'submit' }),
								' '
							),
							_react2.default.createElement(
								_krUi.Col,
								{ md: 2, align: 'right' },
								' ',
								_react2.default.createElement(_krUi.Button, { label: '\u53D6\u6D88', cancle: true, type: 'button', onTouchTap: this.onCancel }),
								' '
							),
							_react2.default.createElement(_krUi.Col, { md: 4 })
						)
					)
				)
			);
		}
	}]);

	return SelectStationForm;
}(_react.Component);

SelectStationForm.PropTypes = {
	searchParams: _react2.default.PropTypes.object,
	onSubmit: _react2.default.PropTypes.func,
	onCancel: _react2.default.PropTypes.func
};
SelectStationForm.contextTypes = {
	params: _react2.default.PropTypes.object.isRequired
};

var _default = (0, _reduxForm.reduxForm)({
	form: 'selectStationForm',
	enableReinitialize: true,
	keepDirtyOnReinitialize: true
})(SelectStationForm);

exports.default = _default;
;

var _temp = function () {
	if (typeof __REACT_HOT_LOADER__ === 'undefined') {
		return;
	}

	__REACT_HOT_LOADER__.register(SelectStationForm, 'SelectStationForm', '/Users/tmac_zc/Code/kr-admin/src/Containers/Operation/CustomerManage/Agreement/Renew/Edit/AllStation.js');

	__REACT_HOT_LOADER__.register(_default, 'default', '/Users/tmac_zc/Code/kr-admin/src/Containers/Operation/CustomerManage/Agreement/Renew/Edit/AllStation.js');
}();

;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9Db250YWluZXJzL09wZXJhdGlvbi9DdXN0b21lck1hbmFnZS9BZ3JlZW1lbnQvUmVuZXcvRWRpdC9BbGxTdGF0aW9uLmpzIl0sIm5hbWVzIjpbIlNlbGVjdFN0YXRpb25Gb3JtIiwicHJvcHMiLCJjb250ZXh0Iiwib25TdWJtaXQiLCJiaW5kIiwib25DYW5jZWwiLCJvblNlbGVjdCIsImdldExvYWREYXRhIiwib25DaGFuZ2VSZW50QmVnaW5EYXRlIiwic3RhdGUiLCJzdGF0aW9uVm9zIiwic2VsZWN0ZWQiLCJ2YWx1ZSIsImxlYXNlQmVnaW5kYXRlIiwiY2hhbmdlVmFsdWVzIiwiYmVnaW5EYXRlIiwiRGF0ZSIsInBhcnNlIiwicmVudEJlZ2luRGF0ZSIsImNvbmNhdCIsIm1hcCIsIml0ZW0iLCJpbmRleCIsImluZGV4T2YiLCJzZXRTdGF0ZSIsIl90aGlzIiwicGFyYW1zIiwiZGlzcGF0Y2giLCJjYWxsQVBJIiwibWFpbkJpbGxpZCIsIm9yZGVySWQiLCJwYWdlIiwicGFnZXNpemUiLCJjb250cmFjdElkIiwiaWQiLCJ0aGVuIiwicmVzcG9uc2UiLCJjb25zb2xlIiwibG9nIiwiaXRlbXMiLCJzaG93IiwibGFzdEVkaXREYXRlIiwiY2F0Y2giLCJlcnIiLCJtZXNzYWdlIiwidHlwZSIsInNlbGVjdGVkU3RhdGlvblZvcyIsImZpbHRlciIsImxlbmd0aCIsInNvbWVTdGFydERhdGUiLCJmb3JFYWNoIiwic29tZSIsInNvcnQiLCJwcmUiLCJuZXh0IiwicHJlRGF0ZSIsImxlYXNlRW5kRGF0ZSIsIm5leHREYXRlIiwicmVzdWx0U3RhdGlvblZvcyIsIm9iaiIsInN0YXRpb25JZCIsInN0YXRpb25UeXBlIiwic3RhdGlvbk5hbWUiLCJ3aGVyZUZsb29yIiwidW5pdHByaWNlIiwibGVhc2VCZWdpbkRhdGUiLCJwdXNoIiwiZW5kRGF0ZSIsInRtcERhdGUiLCJzZXRUaW1lIiwic2V0RGF0ZSIsImdldERhdGUiLCJlcnJvciIsImhhbmRsZVN1Ym1pdCIsInByaXN0aW5lIiwicmVzZXQiLCJzdWJtaXR0aW5nIiwib3ZlcmZvbHciLCJtYXhIZWlnaHQiLCJoZWlnaHQiLCJtYXJnaW5Ub3AiLCJwYWRkaW5nQm90dG9tIiwiUHJvcFR5cGVzIiwic2VhcmNoUGFyYW1zIiwib2JqZWN0IiwiZnVuYyIsImNvbnRleHRUeXBlcyIsImlzUmVxdWlyZWQiLCJmb3JtIiwiZW5hYmxlUmVpbml0aWFsaXplIiwia2VlcERpcnR5T25SZWluaXRpYWxpemUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7QUFDQTs7QUFDQTs7QUFFQTs7QUFFQTs7QUFJQTs7Ozs7Ozs7OztJQUVNQSxpQjs7O0FBVUwsNEJBQVlDLEtBQVosRUFBbUJDLE9BQW5CLEVBQTRCO0FBQUE7O0FBQUEscUlBQ3JCRCxLQURxQixFQUNkQyxPQURjOztBQUkzQixTQUFLQyxRQUFMLEdBQWdCLE9BQUtBLFFBQUwsQ0FBY0MsSUFBZCxRQUFoQjtBQUNBLFNBQUtDLFFBQUwsR0FBZ0IsT0FBS0EsUUFBTCxDQUFjRCxJQUFkLFFBQWhCO0FBQ0EsU0FBS0UsUUFBTCxHQUFnQixPQUFLQSxRQUFMLENBQWNGLElBQWQsUUFBaEI7QUFDQSxTQUFLRyxXQUFMLEdBQW1CLE9BQUtBLFdBQUwsQ0FBaUJILElBQWpCLFFBQW5CO0FBQ0EsU0FBS0kscUJBQUwsR0FBNkIsT0FBS0EscUJBQUwsQ0FBMkJKLElBQTNCLFFBQTdCOztBQUVBLFNBQUtLLEtBQUwsR0FBYTtBQUNaQyxlQUFZLEVBREE7QUFFWkMsYUFBVTtBQUZFLEdBQWI7O0FBVjJCO0FBZTNCOzs7O3NDQUVtQjtBQUNuQixRQUFLSixXQUFMO0FBQ0E7Ozt3Q0FHcUJLLEssRUFBTztBQUM1QkEsV0FBUSx1QkFBV0EsS0FBWCxFQUFrQixZQUFsQixJQUFrQyxXQUExQzs7QUFENEIsT0FNM0JDLGNBTjJCLEdBT3hCLEtBQUtaLEtBQUwsQ0FBV2EsWUFQYSxDQU0zQkQsY0FOMkI7QUFRNUI7O0FBQ0EsT0FBSUUsWUFBWUMsS0FBS0MsS0FBTCxDQUFXLHVCQUFX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QVksS0FBSzVFLFFBQWxFLEdBQTNCO0FBQUE7QUFBQSxRQUhBO0FBSUEsa0RBQUssSUFBSSxDQUFUO0FBSkE7QUFEQTtBQTVCTjtBQURHLElBREQ7QUF3Q0E7Ozs7OztBQWpTSUwsaUIsQ0FFRWtGLFMsR0FBWTtBQUNsQkMsZUFBYyxnQkFBTUQsU0FBTixDQUFnQkUsTUFEWjtBQUVsQmpGLFdBQVUsZ0JBQU0rRSxTQUFOLENBQWdCRyxJQUZSO0FBR2xCaEYsV0FBVSxnQkFBTTZFLFNBQU4sQ0FBZ0JHO0FBSFIsQztBQUZkckYsaUIsQ0FPRXNGLFksR0FBZTtBQUNyQjVELFNBQVEsZ0JBQU13RCxTQUFOLENBQWdCRSxNQUFoQixDQUF1Qkc7QUFEVixDOztlQTZSUiwwQkFBVTtBQUN4QkMsT0FBTSxtQkFEa0I7QUFFeEJDLHFCQUFvQixJQUZJO0FBR3hCQywwQkFBeUI7QUFIRCxDQUFWLEVBSVoxRixpQkFKWSxDOzs7Ozs7Ozs7OytCQXBTVEEsaUIiLCJmaWxlIjoiQWxsU3RhdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvdG1hY196Yy9Db2RlL2tyLWFkbWluIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCwgUHJvcFR5cGVzIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ2tyL1JlZHV4JztcbmltcG9ydCB7IEJpbmRlciB9IGZyb20gJ3JlYWN0LWJpbmRpbmcnO1xuXG5pbXBvcnQgeyBEYXRlRm9ybWF0IH0gZnJvbSAna3IvVXRpbHMnO1xuXG5pbXBvcnQgeyByZWR1eEZvcm0sIGZvcm1WYWx1ZVNlbGVjdG9yLCBjaGFuZ2UsIGluaXRpYWxpemUsIGFycmF5UHVzaCwgYXJyYXlJbnNlcnQsIEZpZWxkQXJyYXkgfSBmcm9tICdyZWR1eC1mb3JtJztcblxuaW1wb3J0IHsgQWN0aW9ucywgU3RvcmUgfSBmcm9tICdrci9SZWR1eCc7XG5cbmltcG9ydCB7IEZvcm0sIFRhYmxlLCBUYWJsZUJvZHksIFRhYmxlSGVhZGVyLCBUYWJsZUhlYWRlckNvbHVtbiwgVGFibGVSb3csIFRhYmxlUm93Q29sdW1uLCBUYWJsZUZvb3RlciwgS3JGaWVsZCwgR3JpZCwgUm93LCBDb2wsIEJ1dHRvbiwgTm90aWZ5LCBLckRhdGUsIH0gZnJvbSAna3ItdWknO1xuXG5jbGFzcyBTZWxlY3RTdGF0aW9uRm9ybSBleHRlbmRzIENvbXBvbmVudCB7XG5cblx0c3RhdGljIFByb3BUeXBlcyA9IHtcblx0XHRzZWFyY2hQYXJhbXM6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG5cdFx0b25TdWJtaXQ6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuXHRcdG9uQ2FuY2VsOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyxcblx0fVxuXHRzdGF0aWMgY29udGV4dFR5cGVzID0ge1xuXHRcdHBhcmFtczogUmVhY3QuUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkXG5cdH1cblx0Y29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcblx0XHRzdXBlcihwcm9wcywgY29udGV4dCk7XG5cblxuXHRcdHRoaXMub25TdWJtaXQgPSB0aGlzLm9uU3VibWl0LmJpbmQodGhpcyk7XG5cdFx0dGhpcy5vbkNhbmNlbCA9IHRoaXMub25DYW5jZWwuYmluZCh0aGlzKTtcblx0XHR0aGlzLm9uU2VsZWN0ID0gdGhpcy5vblNlbGVjdC5iaW5kKHRoaXMpO1xuXHRcdHRoaXMuZ2V0TG9hZERhdGEgPSB0aGlzLmdldExvYWREYXRhLmJpbmQodGhpcyk7XG5cdFx0dGhpcy5vbkNoYW5nZVJlbnRCZWdpbkRhdGUgPSB0aGlzLm9uQ2hhbmdlUmVudEJlZ2luRGF0ZS5iaW5kKHRoaXMpO1xuXG5cdFx0dGhpcy5zdGF0ZSA9IHtcblx0XHRcdHN0YXRpb25Wb3M6IFtdLFxuXHRcdFx0c2VsZWN0ZWQ6IFtdLFxuXHRcdH1cblxuXHR9XG5cblx0Y29tcG9uZW50RGlkTW91bnQoKSB7XG5cdFx0dGhpcy5nZXRMb2FkRGF0YSgpO1xuXHR9XG5cblxuXHRvbkNoYW5nZVJlbnRCZWdpbkRhdGUodmFsdWUpIHtcblx0XHR2YWx1ZSA9IERhdGVGb3JtYXQodmFsdWUsICd5eXl5LW1tLWRkJykgKyAnIDAwOjAwOjAwJztcblxuXG5cblx0XHRsZXQge1xuXHRcdFx0bGVhc2VCZWdpbmRhdGVcblx0XHR9ID0gdGhpcy5wcm9wcy5jaGFuZ2VWYWx1ZXM7XG5cdFx0Ly/liKTmlq3pgInmi6nnmoTml7bpl7TmmK/lkKblpKfkuo7np5/otYHotbflp4vml7bpl7Rcblx0XHRsZXQgYmVnaW5EYXRlID0gRGF0ZS5wYXJzZShEYXRlRm9ybWF0KGxlYXNlQmVnaW5kYXRlLCAneXl5eS1tbS1kZCcpICsgJyAwMDowMDowMCcpO1xuXHRcdGxldCByZW50QmVnaW5EYXRlID0gRGF0ZS5wYXJzZSh2YWx1ZSk7XG5cblx0XHQvLyBpZiAoYmVnaW5EYXRlID4gcmVudEJlZ2luRGF0ZSkge1xuXHRcdC8vIFx0Tm90aWZ5LnNob3coW3tcblx0XHQvLyBcdFx0bWVzc2FnZTogJ+mAieaLqeeahOe7reenn+W8gOWni+aXtumXtOWwj+S6juenn+i1geacn+mZkOeahOi1t+Wni+aXtumXtCcsXG5cdFx0Ly8gXHRcdHR5cGU6ICdkYW5nZXInLFxuXHRcdC8vIFx0fV0pO1xuXHRcdC8vIFx0cmV0dXJuIGZhbHNlO1xuXHRcdC8vIH1cblxuXG5cdFx0bGV0IHtcblx0XHRcdHN0YXRpb25Wb3MsXG5cdFx0XHRzZWxlY3RlZFxuXHRcdH0gPSB0aGlzLnN0YXRlO1xuXHRcdHN0YXRpb25Wb3MgPSBbXS5jb25jYXQoc3RhdGlvblZvcyk7XG5cdFx0c3RhdGlvblZvcy5tYXAoZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcblx0XHRcdGlmIChzZWxlY3RlZC5pbmRleE9mKGluZGV4KSAhPT0gLTEpIHtcblx0XHRcdFx0aXRlbS5yZW50QmVnaW5EYXRlID0gdmFsdWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpdGVtLnJlbnRCZWdpbkRhdGUgPSAnJztcblx0XHRcdH1cblx0XHRcdHJldHVybiBpdGVtO1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRzdGF0aW9uVm9zXG5cdFx0fSk7XG5cblx0fVxuXG5cblx0Z2V0TG9hZERhdGEoKSB7XG5cdFx0dmFyIF90aGlzID0gdGhpcztcblx0XHRsZXQge1xuXHRcdFx0cGFyYW1zXG5cdFx0fSA9IHRoaXMuY29udGV4dDtcblx0XHRTdG9yZS5kaXNwYXRjaChBY3Rpb25zLmNhbGxBUEkoJ2dldFN0YXRpb25PclNldHRpbmdMaXN0Jywge1xuXHRcdFx0bWFpbkJpbGxpZDogcGFyYW1zLm9yZGVySWQsXG5cdFx0XHRwYWdlOiAxLFxuXHRcdFx0cGFnZXNpemU6IDEwMCxcblx0XHRcdGNvbnRyYWN0SWQ6IHBhcmFtcy5pZFxuXHRcdH0pKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRjb25zb2xlLmxvZygncmVzcG9uc2UnLHJlc3BvbnNlKTtcblx0XHRcdHJlc3BvbnNlLml0ZW1zID0gcmVzcG9uc2UuaXRlbXMubWFwKChpdGVtKT0+e1xuXHRcdFx0XHRpZihpdGVtLnNob3cpe1xuXHRcdFx0XHRcdGl0ZW0ucmVudEJlZ2luRGF0ZSA9IGl0ZW0ubGFzdEVkaXREYXRlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBpdGVtO1xuXHRcdFx0fSlcblx0XHRcdGNvbnNvbGUubG9nKCdyZXNwb25zZS5pdGVtcycscmVzcG9uc2UuaXRlbXMpO1xuXHRcdFx0X3RoaXMuc2V0U3RhdGUoe1xuXHRcdFx0XHRzdGF0aW9uVm9zOiByZXNwb25zZS5pdGVtc1xuXHRcdFx0fSk7XG5cdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG5cdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xuXHRcdFx0Tm90aWZ5LnNob3coW3tcblx0XHRcdFx0bWVzc2FnZTogJ+WQjuWPsOWHuumUmeivt+iBlOezu+euoeeQhuWRmCcsXG5cdFx0XHRcdHR5cGU6ICdkYW5nZXInLFxuXHRcdFx0fV0pO1xuXHRcdH0pO1xuXHR9XG5cblx0b25TZWxlY3Qoc2VsZWN0ZWQpIHtcblx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdHNlbGVjdGVkXG5cdFx0fSwgZnVuY3Rpb24oKSB7XG5cblx0XHR9KTtcblx0fVxuXG5cblx0b25TdWJtaXQoKSB7XG5cblx0XHRsZXQge1xuXHRcdFx0c3RhdGlvblZvcyxcblx0XHRcdHNlbGVjdGVkXG5cdFx0fSA9IHRoaXMuc3RhdGU7XG5cdFx0bGV0IHNlbGVjdGVkU3RhdGlvblZvcyA9IFtdO1xuXG5cdFx0c2VsZWN0ZWRTdGF0aW9uVm9zID0gc3RhdGlvblZvcy5maWx0ZXIoZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcblx0XHRcdGlmIChzZWxlY3RlZC5pbmRleE9mKGluZGV4KSAhPT0gLTEpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fSk7XG5cblxuXHRcdGlmICghc2VsZWN0ZWRTdGF0aW9uVm9zLmxlbmd0aCkge1xuXHRcdFx0Tm90aWZ5LnNob3coW3tcblx0XHRcdFx0bWVzc2FnZTogJ+ivt+mAieaLqeW3peS9jScsXG5cdFx0XHRcdHR5cGU6ICdkYW5nZXInLFxuXHRcdFx0fV0pO1xuXG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Ly/pgInkuK3nmoTlv4XpobvopoHmnInnp5/otYHnu5PmnZ/ml6XmnJ9cblx0XHR2YXIgc29tZVN0YXJ0RGF0ZSA9IHRydWU7XG5cblx0XHRzZWxlY3RlZFN0YXRpb25Wb3MuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpbmRleCkge1xuXHRcdFx0aWYgKCFpdGVtLnJlbnRCZWdpbkRhdGUpIHtcblx0XHRcdFx0c29tZVN0YXJ0RGF0ZSA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKCFzb21lU3RhcnREYXRlKSB7XG5cdFx0XHROb3RpZnkuc2hvdyhbe1xuXHRcdFx0XHRtZXNzYWdlOiAn6YCJ5oup55qE5bel5L2N5b+F6aG76KaB5pyJ55u45ZCM55qE57ut56ef57uT5p2f5pe26Ze0Jyxcblx0XHRcdFx0dHlwZTogJ2RhbmdlcicsXG5cdFx0XHR9XSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Ly/lt6XkvY3nu5PmnZ/ml7bpl7Tnm7jlkIxcblx0XHR2YXIgc29tZSA9IHRydWU7XG5cdFx0c2VsZWN0ZWRTdGF0aW9uVm9zLnNvcnQoZnVuY3Rpb24ocHJlLCBuZXh0KSB7XG5cdFx0XHR2YXIgcHJlRGF0ZSA9IERhdGVGb3JtYXQocHJlLmxlYXNlRW5kRGF0ZSwgJ3l5eXktbW0tZGQnKTtcblx0XHRcdHZhciBuZXh0RGF0ZSA9IERhdGVGb3JtYXQobmV4dC5sZWFzZUVuZERhdGUsICd5eXl5LW1tLWRkJyk7XG5cdFx0XHRpZiAocHJlRGF0ZSAhPSBuZXh0RGF0ZSkge1xuXHRcdFx0XHRzb21lID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gLTE7XG5cdFx0fSk7XG5cblx0XHRpZiAoIXNvbWUpIHtcblx0XHRcdE5vdGlmeS5zaG93KFt7XG5cdFx0XHRcdG1lc3NhZ2U6ICfor7fpgInmi6nnm7jlkIzml6XmnJ8nLFxuXHRcdFx0XHR0eXBlOiAnZGFuZ2VyJyxcblx0XHRcdH1dKTtcblx0XHRcdHJldHVybiBmYWxzZTtcblx0XHR9XG5cblx0XHQvL+S/ruaUueaXpeacn1xuXHRcdHZhciByZXN1bHRTdGF0aW9uVm9zID0gW107XG5cdFx0c2VsZWN0ZWRTdGF0aW9uVm9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcblx0XHRcdHZhciBvYmogPSB7fTtcblx0XHRcdG9iai5pZCA9IGl0ZW0uaWQ7XG5cdFx0XHRvYmouc3RhdGlvbklkID0gaXRlbS5zdGF0aW9uSWQ7XG5cdFx0XHRvYmouc3RhdGlvblR5cGUgPSBpdGVtLnN0YXRpb25UeXBlO1xuXHRcdFx0b2JqLnN0YXRpb25OYW1lID0gaXRlbS5zdGF0aW9uTmFtZTtcblx0XHRcdG9iai53aGVyZUZsb29yID0gaXRlbS53aGVyZUZsb29yO1xuXHRcdFx0b2JqLnVuaXRwcmljZSA9IGl0ZW0udW5pdHByaWNlO1xuXHRcdFx0b2JqLmxlYXNlQmVnaW5EYXRlID0gRGF0ZUZvcm1hdChpdGVtLmxlYXNlRW5kRGF0ZSwgJ3l5eXktbW0tZGQnKTtcblx0XHRcdG9iai5sZWFzZUVuZERhdGUgPSBpdGVtLnJlbnRCZWdpbkRhdGU7XG5cdFx0XHRyZXN1bHRTdGF0aW9uVm9zLnB1c2gob2JqKTtcblx0XHR9KTtcblxuXHRcdHNlbGVjdGVkU3RhdGlvblZvcyA9IHJlc3VsdFN0YXRpb25Wb3M7XG5cblx0XHRsZXQgYmVnaW5EYXRlID0gRGF0ZS5wYXJzZShzZWxlY3RlZFN0YXRpb25Wb3NbMF0ubGVhc2VCZWdpbkRhdGUpO1xuXHRcdGxldCBlbmREYXRlID0gRGF0ZS5wYXJzZShzZWxlY3RlZFN0YXRpb25Wb3NbMF0ubGVhc2VFbmREYXRlKTtcblxuXHRcdGlmIChiZWdpbkRhdGUgPiBlbmREYXRlKSB7XG5cdFx0XHROb3RpZnkuc2hvdyhbe1xuXHRcdFx0XHRtZXNzYWdlOiAn57ut56ef57uT5p2f5pe26Ze06KaB5aSn5LqO6YCJ5oup55qE5bel5L2N56ef6LWB57uT5p2f5pe26Ze0Jyxcblx0XHRcdFx0dHlwZTogJ2RhbmdlcicsXG5cdFx0XHR9XSk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0U3RvcmUuZGlzcGF0Y2goY2hhbmdlKCdyZWR1Y2VDcmVhdGVGb3JtJywgJ2xlYXNlQmVnaW5kYXRlJywgc2VsZWN0ZWRTdGF0aW9uVm9zWzBdLmxlYXNlRW5kRGF0ZSkpO1xuXG5cdFx0c2VsZWN0ZWRTdGF0aW9uVm9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaW5kZXgpIHtcblx0XHRcdHZhciB0bXBEYXRlID0gbmV3IERhdGUoKTtcblx0XHRcdHRtcERhdGUuc2V0VGltZShEYXRlLnBhcnNlKGl0ZW0ubGVhc2VCZWdpbkRhdGUpKTtcblx0XHRcdHRtcERhdGUuc2V0RGF0ZSh0bXBEYXRlLmdldERhdGUoKSArIDEpO1xuXHRcdFx0aXRlbS5sZWFzZUJlZ2luRGF0ZSA9IERhdGVGb3JtYXQodG1wRGF0ZSwgJ3l5eXktbW0tZGQnKVxuXHRcdH0pO1xuXG5cdFx0Y29uc29sZS5sb2coJ3NlbGVjdGVkU3RhdGlvblZvcycsIHNlbGVjdGVkU3RhdGlvblZvcyk7XG5cblx0XHRjb25zdCB7XG5cdFx0XHRvblN1Ym1pdFxuXHRcdH0gPSB0aGlzLnByb3BzO1xuXHRcdG9uU3VibWl0ICYmIG9uU3VibWl0KHNlbGVjdGVkU3RhdGlvblZvcyk7XG5cdH1cblxuXG5cdG9uQ2FuY2VsKCkge1xuXHRcdGNvbnN0IHtcblx0XHRcdG9uQ2FuY2VsXG5cdFx0fSA9IHRoaXMucHJvcHM7XG5cdFx0b25DYW5jZWwgJiYgb25DYW5jZWwoKTtcblx0fVxuXG5cdHJlbmRlcigpIHtcblxuXHRcdGxldCB7XG5cdFx0XHRlcnJvcixcblx0XHRcdGhhbmRsZVN1Ym1pdCxcblx0XHRcdHByaXN0aW5lLFxuXHRcdFx0cmVzZXQsXG5cdFx0XHRzdWJtaXR0aW5nLFxuXHRcdFx0Y2hhbmdlVmFsdWVzXG5cdFx0fSA9IHRoaXMucHJvcHM7XG5cdFx0bGV0IHtcblx0XHRcdHN0YXRpb25Wb3Ncblx0XHR9ID0gdGhpcy5zdGF0ZTtcblx0XHRjb25zdCBvdmVyZm9sdyA9IHtcblx0XHRcdCdvdmVyZmxvdyc6ICdoaWRkZW4nLFxuXHRcdFx0bWF4SGVpZ2h0OiA1MTAsXG5cdFx0fVxuXHRcdGNvbnN0IGhlaWdodCA9IHtcblx0XHRcdGhlaWdodDogc3RhdGlvblZvcy5sZW5ndGggKiA0NSxcblx0XHRcdG1heEhlaWdodDogNjY3LFxuXHRcdH1cblx0XHRyZXR1cm4gKFxuXHRcdFx0PGRpdiBzdHlsZT17e2hlaWdodDo2NjcsbWFyZ2luVG9wOjIwfX0+XG48Zm9ybSBvblN1Ym1pdD17aGFuZGxlU3VibWl0KHRoaXMub25TdWJtaXQpfT5cblx0XHRcdDxLckZpZWxkIGdyaWQ9ezEvMn0gIG5hbWU9XCJyZW50QmVnaW5EYXRlXCIgY29tcG9uZW50PVwiZGF0ZVwiIGxhYmVsPVwi57ut56ef57uT5p2f5pe26Ze077yaXCIgb25DaGFuZ2U9e3RoaXMub25DaGFuZ2VSZW50QmVnaW5EYXRlfSBpbmxpbmU9e3RydWV9Lz5cbiAgICAgIDxUYWJsZSBvblNlbGVjdD17dGhpcy5vblNlbGVjdH0gc3R5bGU9e292ZXJmb2x3fT5cbiAgICAgICAgPFRhYmxlSGVhZGVyPlxuICAgICAgICAgIDxUYWJsZUhlYWRlckNvbHVtbj7nsbvliKs8L1RhYmxlSGVhZGVyQ29sdW1uPlxuICAgICAgICAgIDxUYWJsZUhlYWRlckNvbHVtbj7nvJblj7fvvI/lkI3np7A8L1RhYmxlSGVhZGVyQ29sdW1uPlxuICAgICAgICAgIDxUYWJsZUhlYWRlckNvbHVtbj7ljZXku7fvvIjlhYPvvI/mnIjvvIk8L1RhYmxlSGVhZGVyQ29sdW1uPlxuICAgICAgICAgIDxUYWJsZUhlYWRlckNvbHVtbj7otbflp4vml6XmnJ88L1RhYmxlSGVhZGVyQ29sdW1uPlxuICAgICAgICAgIDxUYWJsZUhlYWRlckNvbHVtbj7nu5PmnZ/ml6XmnJ88L1RhYmxlSGVhZGVyQ29sdW1uPlxuICAgICAgICAgIDxUYWJsZUhlYWRlckNvbHVtbj7nu63np5/nu5PmnZ/ml7bpl7Q8L1RhYmxlSGVhZGVyQ29sdW1uPlxuICAgICAgPC9UYWJsZUhlYWRlcj5cbiAgICAgIDxUYWJsZUJvZHk+XG4gICAgICB7c3RhdGlvblZvcyAmJiBzdGF0aW9uVm9zLm1hcCgoaXRlbSxpbmRleCk9PntcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8VGFibGVSb3cga2V5PXtpbmRleH0+XG4gICAgICAgICAgPFRhYmxlUm93Q29sdW1uID57KGl0ZW0uc3RhdGlvblR5cGUgPT0gMSkgPyflt6XkvY0nOifkvJrorq7lrqQnfTwvVGFibGVSb3dDb2x1bW4+XG4gICAgICAgICAgPFRhYmxlUm93Q29sdW1uID57aXRlbS5zdGF0aW9uTmFtZX08L1RhYmxlUm93Q29sdW1uPlxuICAgICAgICAgIDxUYWJsZVJvd0NvbHVtbiA+e2l0ZW0udW5pdHByaWNlfTwvVGFibGVSb3dDb2x1bW4+XG4gICAgICAgICAgPFRhYmxlUm93Q29sdW1uID48S3JEYXRlIHZhbHVlPXtpdGVtLmxlYXNlQmVnaW5EYXRlfS8+PC9UYWJsZVJvd0NvbHVtbj5cbiAgICAgICAgICA8VGFibGVSb3dDb2x1bW4gPjxLckRhdGUgdmFsdWU9e2l0ZW0ubGVhc2VFbmREYXRlfS8+PC9UYWJsZVJvd0NvbHVtbj5cbiAgICAgICAgICA8VGFibGVSb3dDb2x1bW4gPlxuXHRcdFx0XHR7aXRlbS5yZW50QmVnaW5EYXRlJiYgRGF0ZUZvcm1hdChpdGVtLnJlbnRCZWdpbkRhdGUsJ3l5eXktbW0tZGQnKX1cbiAgICAgICAgICA8L1RhYmxlUm93Q29sdW1uPlxuICAgICAgICAgPC9UYWJsZVJvdz5cbiAgICAgICAgKTtcbiAgICAgIH0pfVxuICAgICAgPC9UYWJsZUJvZHk+XG4gICAgICA8L1RhYmxlPlxuICAgICAgPEdyaWQ+XG4gICAgICA8Um93IHN0eWxlPXt7bWFyZ2luVG9wOjMwLHBhZGRpbmdCb3R0b206MjR9fT5cbiAgICAgIDxDb2wgbWQ9ezR9PjwvQ29sPlxuXHQgIDxDb2wgbWQ9ezJ9IGFsaWduPVwicmlnaHRcIj4gPEJ1dHRvbiAgbGFiZWw9XCLnoa7lrppcIiB0eXBlPVwic3VibWl0XCIgLz4gPC9Db2w+XG4gICAgICA8Q29sIG1kPXsyfSBhbGlnbj1cInJpZ2h0XCI+IDxCdXR0b24gIGxhYmVsPVwi5Y+W5raIXCIgY2FuY2xlPXt0cnVlfSB0eXBlPVwiYnV0dG9uXCIgIG9uVG91Y2hUYXA9e3RoaXMub25DYW5jZWx9Lz4gPC9Db2w+XG4gICAgICA8Q29sIG1kPXs0fT48L0NvbD5cbiAgICAgICA8L1Jvdz5cbiAgICAgIDwvR3JpZD5cbjwvZm9ybT5cblx0XHRcdDwvZGl2Pik7XG5cdH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgcmVkdXhGb3JtKHtcblx0Zm9ybTogJ3NlbGVjdFN0YXRpb25Gb3JtJyxcblx0ZW5hYmxlUmVpbml0aWFsaXplOiB0cnVlLFxuXHRrZWVwRGlydHlPblJlaW5pdGlhbGl6ZTogdHJ1ZVxufSkoU2VsZWN0U3RhdGlvbkZvcm0pOyJdfQ==