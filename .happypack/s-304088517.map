{"version":3,"sources":["src/Components/Select/Async.js"],"names":["propTypes","autoload","PropTypes","bool","isRequired","cache","any","children","func","ignoreAccents","ignoreCase","loadingPlaceholder","oneOfType","string","node","loadOptions","options","array","placeholder","noResultsText","onChange","searchPromptText","onInputChange","value","defaultCache","defaultProps","defaultChildren","Async","props","context","_cache","state","isLoading","_onInputChange","bind","nextProps","nextState","propertiesToSync","forEach","prop","setState","inputValue","hasOwnProperty","callback","error","data","_callback","promise","then","toLowerCase","select","ref","newValues","length","clearOptions","err"],"mappings":"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","file":"Async.js","sourceRoot":"/Users/tmac_zc/Code/kr-admin","sourcesContent":["import React, { Component, PropTypes } from 'react';\nimport Select from './Select';\nimport stripDiacritics from './utils/stripDiacritics';\n\nconst propTypes = {\n\tautoload: React.PropTypes.bool.isRequired,       // automatically call the `loadOptions` prop on-mount; defaults to true\n\tcache: React.PropTypes.any,                      // object to use to cache results; set to null/false to disable caching\n\tchildren: React.PropTypes.func.isRequired,       // Child function responsible for creating the inner Select component; (props: Object): PropTypes.element\n\tignoreAccents: React.PropTypes.bool,             // strip diacritics when filtering; defaults to true\n\tignoreCase: React.PropTypes.bool,                // perform case-insensitive filtering; defaults to true\n\tloadingPlaceholder: React.PropTypes.oneOfType([  // replaces the placeholder while options are loading\n\t\tReact.PropTypes.string,\n\t\tReact.PropTypes.node\n\t]),\n\tloadOptions: React.PropTypes.func.isRequired,    // callback to load options asynchronously; (inputValue: string, callback: Function): ?Promise\n\toptions: PropTypes.array.isRequired,             // array of options\n\tplaceholder: React.PropTypes.oneOfType([         // field placeholder, displayed when there's no value (shared with Select)\n\t\tReact.PropTypes.string,\n\t\tReact.PropTypes.node\n\t]),\n\tnoResultsText: React.PropTypes.oneOfType([       // field noResultsText, displayed when no options come back from the server\n\t\tReact.PropTypes.string,\n\t\tReact.PropTypes.node\n\t]),\n\tonChange: React.PropTypes.func,                  // onChange handler: function (newValue) {}\n\tsearchPromptText: React.PropTypes.oneOfType([    // label to prompt for search input\n\t\tReact.PropTypes.string,\n\t\tReact.PropTypes.node\n\t]),\n\tonInputChange: React.PropTypes.func,             // optional for keeping track of what is being typed\n\tvalue: React.PropTypes.any,                      // initial field value\n};\n\nconst defaultCache = {};\n\nconst defaultProps = {\n\tautoload: true,\n\tcache: defaultCache,\n\tchildren: defaultChildren,\n\tignoreAccents: true,\n\tignoreCase: true,\n\tloadingPlaceholder: 'Loading...',\n\toptions: [],\n\t//searchPromptText: 'Type to search',\n\tsearchPromptText: '',\n};\n\nexport default class Async extends Component {\n\tconstructor (props, context) {\n\t\tsuper(props, context);\n\n\t\tthis._cache = props.cache === defaultCache ? {} : props.cache;\n\n\t\tthis.state = {\n\t\t\tisLoading: false,\n\t\t\toptions: props.options,\n\t\t};\n\n\t\tthis._onInputChange = this._onInputChange.bind(this);\n\t}\n\n\tcomponentDidMount () {\n\t\tconst { autoload } = this.props;\n\n\t\tif (autoload) {\n\t\t\tthis.loadOptions('');\n\t\t}\n\t}\n\n\tcomponentWillUpdate (nextProps, nextState) {\n\t\tconst propertiesToSync = ['options'];\n\t\tpropertiesToSync.forEach((prop) => {\n\t\t\tif (this.props[prop] !== nextProps[prop]) {\n\t\t\t\tthis.setState({\n\t\t\t\t\t[prop]: nextProps[prop]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tclearOptions() {\n\t\tthis.setState({ options: [] });\n\t}\n\n\tloadOptions (inputValue) {\n\t\tconst { loadOptions } = this.props;\n\t\tconst cache = this._cache;\n\n\t\tif (\n\t\t\tcache &&\n\t\t\tcache.hasOwnProperty(inputValue)\n\t\t) {\n\t\t\tthis.setState({\n\t\t\t\toptions: cache[inputValue]\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst callback = (error, data) => {\n\t\t\tif (callback === this._callback) {\n\t\t\t\tthis._callback = null;\n\n\t\t\t\tconst options = data && data.options || [];\n\n\t\t\t\tif (cache) {\n\t\t\t\t\tcache[inputValue] = options;\n\t\t\t\t}\n\n\t\t\t\tthis.setState({\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\toptions\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\t// Ignore all but the most recent request\n\t\tthis._callback = callback;\n\n\t\tconst promise = loadOptions(inputValue, callback);\n\t\tif (promise) {\n\t\t\tpromise.then(\n\t\t\t\t(data) => callback(null, data),\n\t\t\t\t(error) => callback(error)\n\t\t\t);\n\t\t}\n\n\t\tif (\n\t\t\tthis._callback &&\n\t\t\t!this.state.isLoading\n\t\t) {\n\t\t\tthis.setState({\n\t\t\t\tisLoading: true\n\t\t\t});\n\t\t}\n\n\t\treturn inputValue;\n\t}\n\n\t_onInputChange (inputValue) {\n\t\tconst { ignoreAccents, ignoreCase, onInputChange } = this.props;\n\n\t\tif (ignoreAccents) {\n\t\t\tinputValue = stripDiacritics(inputValue);\n\t\t}\n\n\t\tif (ignoreCase) {\n\t\t\tinputValue = inputValue.toLowerCase();\n\t\t}\n\n\t\tif (onInputChange) {\n\t\t\tonInputChange(inputValue);\n\t\t}\n\n\t\treturn this.loadOptions(inputValue);\n\t}\n\n\tinputValue() {\n\t\tif (this.select) {\n\t\t\treturn this.select.state.inputValue;\n\t\t}\n\t\treturn '';\n\t}\n\n\tnoResultsText() {\n\t\tconst { loadingPlaceholder, noResultsText, searchPromptText } = this.props;\n\t\tconst { isLoading } = this.state;\n\n\t\tconst inputValue = this.inputValue();\n\n\t\tif (isLoading) {\n\t\t\treturn loadingPlaceholder;\n\t\t}\n\t\tif (inputValue && noResultsText) {\n\t\t\treturn '';\n\t\t}\n\t\treturn searchPromptText;\n\t}\n\n\trender () {\n\n\n\t\tconst { children, loadingPlaceholder, placeholder } = this.props;\n\t\tconst { isLoading, options } = this.state;\n\n\t\tconst props = {\n\t\t\tnoResultsText: this.noResultsText(),\n\t\t\tplaceholder: isLoading ? loadingPlaceholder : placeholder,\n\t\t\toptions: (isLoading && loadingPlaceholder) ? [] : options,\n\t\t\tref: (ref) => (this.select = ref),\n\t\t\tonChange: (newValues) => {\n\n\t\t\t\ttry{\n\n\t\t\t\tif (this.props.value && (newValues.length > this.props.value.length)) {\n\t\t\t\t\tthis.clearOptions();\n\t\t\t\t}\n\t\t\t\t}catch(err){\n\n\t\t\t\t}\n\t\t\t\tthis.props.onChange(newValues);\n\t\t\t}\n\t\t};\n\n\t\treturn children({\n\t\t\t...this.props,\n\t\t\t...props,\n\t\t\tisLoading,\n\t\t\tonInputChange: this._onInputChange\n\t\t});\n\t}\n}\n\nAsync.propTypes = propTypes;\nAsync.defaultProps = defaultProps;\n\nfunction defaultChildren (props) {\n\treturn (\n\t\t<Select {...props} />\n\t);\n};\n"]}