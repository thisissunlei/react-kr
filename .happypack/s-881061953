'use strict';

var _observable;

var _mobx = require('mobx');

var _mobx2 = _interopRequireDefault(_mobx);

var _Redux = require('kr/Redux');

var _krUi = require('kr-ui');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var State = (0, _mobx.observable)((_observable = {
	searchParams: {
		page: 1
	},
	openNewMerchants: false,
	openLookMerchants: false,
	openEditCustomerList: false,
	openNewCustomerIndent: false,
	openNewIndent: false,
	openEditIndent: false,
	openDelete: false,
	openSearchUpper: false,
	openSwitch: false,
	openPersonDialog: false,
	indentReady: {},
	listId: "",
	deleteId: '',
	companyName: ''
}, _defineProperty(_observable, 'openDelete', false), _defineProperty(_observable, 'editIndentData', {}), _defineProperty(_observable, 'editIndentId', ''), _defineProperty(_observable, 'customerName', ""), _defineProperty(_observable, 'orderCount', ""), _defineProperty(_observable, 'mainbillname', ""), _defineProperty(_observable, 'cityname', ""), _defineProperty(_observable, 'editCity', ''), _defineProperty(_observable, 'editprojectName', ''), _defineProperty(_observable, 'ishasOffice', false), _defineProperty(_observable, 'editIndentState', ""), _observable));
State.hasOfficeChange = (0, _mobx.action)(function (params) {
	this.ishasOffice = params;
});
//新建页的开关
State.switchNewCustomerList = (0, _mobx.action)(function () {
	this.openNewMerchants = !this.openNewMerchants;
});
//查看页面的开关
State.switchLookCustomerList = (0, _mobx.action)(function () {
	this.openLookMerchants = !this.openLookMerchants;
});
//编辑页面的开关
State.switchEditCustomerList = (0, _mobx.action)(function () {
	this.openEditCustomerList = !this.openEditCustomerList;
});
//新增排放记录的开关
State.switchCustomerIndent = (0, _mobx.action)(function () {
	this.openNewCustomerIndent = !this.openNewCustomerIndent;
});
//新建订单的开关
State.switchNewIndent = (0, _mobx.action)(function () {
	this.openNewIndent = !this.openNewIndent;
});
//编辑订单的开关
State.switchEditIndent = (0, _mobx.action)(function () {
	this.openEditIndent = !this.openEditIndent;
});
//高级查询的开关
State.searchUpperCustomer = (0, _mobx.action)(function () {
	this.openSearchUpper = !this.openSearchUpper;
});
//转移开关
State.openSwitchGoDialog = (0, _mobx.action)(function () {
	this.openSwitch = !this.openSwitch;
});
//删除订单
State.openDeleteOrder = (0, _mobx.action)(function () {
	this.openDelete = !this.openDelete;
});
//新建订单页得数据准备
State.indentReady = (0, _mobx.action)(function (params) {
	this.indentReady = params;
});

//编辑定点id
State.editIndentIdChange = (0, _mobx.action)(function (params) {
	this.editIndentId = params;
});
//订单名称
State.orderNameChange = (0, _mobx.action)(function (params) {
	this.orderName = params;
});

//获取订单名称
State.orderNameInit = (0, _mobx.action)(function (value) {
	var _this = this;
	var data = {};

	data.customerId = value;

	_Redux.Store.dispatch(_Redux.Actions.callAPI('get-customName-orderName', data)).then(function (response) {
		_this.customerName = response.customerName;
		_this.orderCount = response.orderCount;
	}).catch(function (err) {
		_krUi.Message.error(err.message);
	});
});

//转移提交
State.switchSureSubmit = (0, _mobx.action)(function (value) {
	var _this = this;
	_Redux.Store.dispatch(_Redux.Actions.callAPI('customerTransfer', {}, value)).then(function (response) {
		_this.openSwitch = false;
		_krUi.Message.success('转移成功');
		_this.openPersonDialog = false;
		_this.searchParams = {
			page: 1,
			time: +new Date()
		};
	}).catch(function (err) {
		_krUi.Message.error(err.message);
	});
});
//导出
State.exportData = (0, _mobx.action)(function (value) {
	var search = {};
	search.company = this.searchParams.company;
	search.cityId = this.searchParams.cityId;
	search.communityId = this.searchParams.communityId;
	search.signEndDate = this.searchParams.signEndDate;
	search.signStartDate = this.searchParams.signStartDate;
	if (!search.company) {
		search.company = '';
	}
	if (!search.cityId) {
		search.cityId = '';
	}
	if (!search.signStartDate) {
		search.signStartDate = '';
	}
	if (!search.communityId) {
		search.communityId = '';
	}
	if (!search.signEndDate) {
		search.signEndDate = '';
	}
	var customerIds = [];
	if (value.length != 0) {
		value.map(function (item, value) {
			customerIds.push(item.id);
		});
	}
	var url = '/api/krspace-finance-web/customer/sign-customers-export?customerIds=' + customerIds + '&company=' + search.company + '&cityId=' + search.cityId + '&signStartDate=' + search.signStartDate + '&communityId=' + search.communityId + '&signEndDate=' + search.signEndDate;
	window.location.href = url;
});
//城市改变
State.cityChange = (0, _mobx.action)(function (params) {
	this.cityname = params;
});
State.closeAllMerchants = (0, _mobx.action)(function () {
	this.openLookMerchants = false;
	this.openNewMerchants = false;
	this.openSearchUpper = false;
	this.openEditCustomerList = false;
	this.openNewCustomerIndent = false;
	this.openNewIndent = false;
	this.openEditIndent = false;
});
State.MerchantsListId = (0, _mobx.action)(function (params) {
	this.listId = params;
});
module.exports = State;