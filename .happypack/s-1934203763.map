{"version":3,"sources":["src/Components/PlanMap/Lib/PlanMap.js"],"names":["PlanMap","elementIdName","Configs","Plugins","configs","plugins","canvasElement","document","getElementById","context","getContext","scaleX","scaleY","backgroundImage","width","height","setAttribute","single","clickStation","default","translateX","translateY","stations","beginDragStation","selectedStations","eventType","click","clickLeft","clickRight","move","isJudgeDrag","drag","dragBegin","dragEnd","dragMap","dragStation","whell","whellUp","whellDown","mousePosition","down","x","y","up","current","operation","permission","edit","loading","_this","initializeStyle","loadBackgroundImage","hide","get","initialize","prototype","setOperation","value","getOperation","setPermission","options","getPermission","fullScreen","setPosition","type","loc","position","Math","floor","getPosition","setEventTrueSimilar","setEvent","hasOwnProperty","getEvent","initializeTransForm","initializeStations","initializeEvents","Number","callback","image","Image","src","onload","setTransform","reset","sw","sh","dw","dh","clearRect","fillStyle","fillRect","drawImage","pageWidth","window","innerWidth","pageHeight","innerHeight","compatMode","documentElement","clientWidth","clientHeight","body","isPointInPath","mapBeiginDrawStation","mouseDownPosition","offsetX","offsetY","getStations","forEach","station","index","mapEndDrawStation","mouseUpPosition","endDragStation","onDragStation","length","getChecked","createDragStationCanvas","onDragStationBegin","debug","selected","downPosition","selectedStation","hasPositionStation","push","map","item","basic","createDragStationCanvasModal","beginPath","rect","abs","strokeStyle","closePath","stroke","fill","drawStations","positionX","positionY","create","swapStationStaff","originStation","targetStation","Plugns","getBasicInfo","setChecked","splice","getIndex","setStations","onDragStationEnd","downLoc","upLoc","translate","onLeftEventClick","isOk","onCheckedStation","onRightEventClick","isPositionInStation","openStationDialog","Error","hasStation","i","calcScale","defaultScale","defaultTranslateX","defaultTranslateY","console","log","scale","canvasMouseWhellEvent","event","windowToCanvas","deltaY","addEventListener","canvasCancelRightMouseEvent","button","preventDefault","canvasMouseDown","setTimeout","canvasMouseMove","e","onDrag","style","cursor","removeEventListener","onDragEnd","onClick","judgeClick","diffX","diffY","judgeDragStationOrMap","isStation","onDragMap","onDragBegin","onDragMapBegin","onDragMapEnd","origin","cancelCheckedAllStation","checked","setClickStation","getClickStation","closeAllStationDialog","getCheckedStations","checkedStations","closeDialog","openDialog","setStationPostion","bbox","getBoundingClientRect","clientX","clientY","left","top","ceil","stationsData","module","exports"],"mappings":"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","file":"PlanMap.js","sourceRoot":"/Users/tmac_zc/Code/kr-admin","sourcesContent":["\nimport Loading from './Loading';\nimport Station from './Station';\nimport Log from './Log';\n\n//平面图\n//=======================\nvar PlanMap = function(elementIdName,Configs,Plugins){\n\n    this.configs = Configs;\n    this.plugins = Plugins;\n    //dom信息\n    this.elementIdName = elementIdName;\n    this.canvasElement = document.getElementById(elementIdName);\n\n    this.context = this.canvasElement.getContext('2d');\n\n    //基本信息\n    this.scaleX = 1;\n    this.scaleY = 1;\n    this.backgroundImage = null;\n\n    this.width = Configs.width;\n    this.height = Configs.height;\n\n\n    this.canvasElement.setAttribute('width',this.width);\n    this.canvasElement.setAttribute('height',this.height);\n\n\t//多选拖动、单选\n\tthis.single = 1;\n\n\t//clickstation\n\tthis.clickStation = null;\n\n    //默认\n    this.default = {\n      translateX:0,\n      translateY:0,\n    };\n\n    this.translateX = 0;\n    this.translateY = 0;\n\n\n    //工位信息\n    this.stations = [];\n    this.beginDragStation = null;\n    this.selectedStations = [];\n\n    //事件状态\n    this.eventType = {\n      //click\n      click:0,\n      clickLeft:0,\n      clickRight:0,\n      //move\n      move:0,\n      //drag\n      isJudgeDrag:0,\n      drag:0,\n      dragBegin:0,\n      dragEnd:0,\n      dragMap:0,\n      dragStation:0,\n      //whell－滚轮事件\n      whell:0,\n      whellUp:0,\n      whellDown:0\n    }\n\n    //坐标信息\n    this.mousePosition = {\n      down:{\n        x:0,\n        y:0\n      },\n      up:{\n        x:0,\n        y:0\n      },\n      move:{\n        x:0,\n        y:0\n      },\n      current:{\n        x:0,\n        y:0\n      }\n    }\n\n    //zoomIn、zoomOut、fulleScreen、translate\n    this.operation = '';\n\n    this.permission = {\n      edit:1,\n    }\n\n    this.loading = new Loading(this.canvasElement,this.context,this.width,this.height);\n\n    var _this = this;\n    // this.loading.show();\n    this.initializeStyle();\n    this.loadBackgroundImage(function(){\n      _this.loading.hide();\n        !_this.loading.get() && _this.initialize();\n    });\n}\n\nPlanMap.prototype.getContext = function(){\n  var canvasElement = this.canvasElement;\n  return canvasElement.getContext('2d');\n}\n\nPlanMap.prototype.setOperation = function(value){\n    this.operation = value;\n}\n\nPlanMap.prototype.getOperation = function(){\n  return this.operation;\n}\n\n//权限\nPlanMap.prototype.setPermission = function(options){\n    this.permission = Object.assign({},this.permission,options);\n}\n\nPlanMap.prototype.getPermission = function(){\n  return this.permission;\n}\n\nPlanMap.prototype.fullScreen = function(){\n  var canvasElement = this.canvasElement;\n}\n\n//坐标\nPlanMap.prototype.setPosition = function(type,loc){\n  var position = {\n    x:Math.floor(loc.x),\n    y:Math.floor(loc.y)\n  };\n  var mousePosition = Object.assign(this.mousePosition);\n  mousePosition[type] = position;\n  this.mousePosition = mousePosition;\n}\n\nPlanMap.prototype.getPosition = function(type){\n  var mousePosition = Object.assign(this.mousePosition);\n  return mousePosition[type];\n}\n\n//设置事件真值推理，其他值\nPlanMap.prototype.setEventTrueSimilar = function (type){\n  var eventType = this.eventType;\n  switch (type) {\n\n    case 'click': {\n      eventType = Object.assign({},eventType,{click:1,clickLeft:0});\n      break;\n    }\n\n    case 'clickLeft': {\n      eventType = Object.assign({},eventType,{click:1,clickLeft:1,clickRight:0});\n      break;\n    }\n    case 'clickRight': {\n      eventType = Object.assign({},eventType,{click:1,clickLeft:0,clickRight:1});\n      break;\n    }\n\n    case 'drag': {\n        eventType = Object.assign({},eventType,{drag:1,dragEnd:0});\n      break;\n    }\n\n    case 'dragBegin': {\n        eventType = Object.assign({},eventType,{drag:1,dragEnd:0,dragBegin:1});\n      break;\n    }\n    case 'dragEnd': {\n        eventType = Object.assign({},eventType,{drag:0,dragEnd:1,dragBegin:0,dragStation:0,dragMap:0});\n      break;\n    }\n    case 'dragMap': {\n        eventType = Object.assign({},eventType,{drag:1,dragEnd:0,dragStation:0});\n      break;\n    }\n    case 'dragStation': {\n        eventType = Object.assign({},eventType,{drag:1,dragEnd:0,dragMap:0});\n      break;\n    }\n\n    default:\n\n  }\n\n  this.eventType = eventType;\n}\n\n\nPlanMap.prototype.setEvent = function(type,value){\n\n  var eventType = Object.assign({},this.eventType);\n  if(!eventType.hasOwnProperty(type)){\n    return ;\n  }\n\n  //设置相似的值\n  value && this.setEventTrueSimilar(type);\n\n  eventType = this.eventType;\n  eventType[type] = value;\n  this.eventType = eventType;\n}\n\nPlanMap.prototype.getEvent = function(type){\n  var eventType = Object.assign({},this.eventType);\n  if(!eventType.hasOwnProperty(type)){\n    return false;\n  }\n  return eventType[type];\n}\n\n\n//平面图-初始化\nPlanMap.prototype.initialize = function(){\n  //this.initializeStyle();\n  this.initializeTransForm();\n  this.initializeStations();\n  this.initializeEvents();\n}\n\nPlanMap.prototype.initializeTransForm = function(){\n  var backgroundImage = this.backgroundImage;\n  var canvasElement = this.canvasElement;\n\n  this.scaleY = Number(canvasElement.height) / Number(canvasElement.height);\n\n}\n\n//平面图-初始化\nPlanMap.prototype.loadBackgroundImage = function(callback){\n  var image = new Image();\n  image.src = this.configs.backgroundImage;\n  var _this = this;\n  image.onload = function(){\n    _this.backgroundImage = this;\n    callback && callback();\n  }\n}\n\nPlanMap.prototype.setTransform = function(){\n  var context = this.context;\n  context.setTransform(this.scaleX,0,0,this.scaleY,this.translateX,this.translateY);\n}\n\nPlanMap.prototype.reset = function(){\n\n  var context = this.getContext();\n  var canvasElement = this.canvasElement;\n\n  var sw = canvasElement.width;\n  var sh = canvasElement.height;\n\n  var dw = sw*this.scaleX;\n  var dh = sh*this.scaleY;\n\n  canvasElement.width = canvasElement.width;\n\n  //context.setTransform(1,0,0,1,this.translateX,this.translateY);\n  context.setTransform(this.scaleX,0,0,this.scaleY,this.translateX,this.translateY);\n\n  context.clearRect(0,0,canvasElement.width,canvasElement.height);\n  context.fillStyle = '#fff';\n  context.fillRect(0,0,this.width,this.height);\n\n  context.drawImage(this.backgroundImage,0,0,this.backgroundImage.width,this.backgroundImage.height);\n\n}\n\n//平面图-外观样式\n\nPlanMap.prototype.initializeStyle = function(){\n  var canvasElement = this.canvasElement;\n  var pageWidth = window.innerWidth;\n  var pageHeight = window.innerHeight;\n\n  if(typeof pageWidth !== 'number'){\n\n    if(document.compatMode == 'CSS1Compat'){\n      pageWidth = document.documentElement.clientWidth;\n      pageHeight = document.documentElement.clientHeight;\n    }else{\n      pageWidth = document.body.clientWidth;\n      pageHeight = document.body.clientHeight;\n    }\n  }\n\n  if(!this.width){\n    this.width = pageWidth;\n    this.height = pageHeight;\n    canvasElement.setAttribute('width',pageWidth);\n    canvasElement.setAttribute('height',pageHeight);\n  }\n\n}\n\n//在工位中\nPlanMap.prototype.isPointInPath = function(x,y){\n  var context = this.getContext();\n  return context.isPointInPath(x,y);\n}\n//查找开始draw station\nPlanMap.prototype.mapBeiginDrawStation = function(){\n\n  var mouseDownPosition = this.getPosition('down');\n  var offsetX = mouseDownPosition.x;\n  var offsetY = mouseDownPosition.y;\n  var stations = this.getStations();\n  var beginDragStation  = null;\n  //查找起始工位\n\n  if(this.isPointInPath(offsetX,offsetY)){\n    stations.forEach(function(station,index){\n      if(offsetX >=station.x && offsetX<=(station.x+station.width)){\n        beginDragStation = station;\n      }\n    });\n  }\n  this.beginDragStation = beginDragStation;\n}\n//查找结束 draw station\nPlanMap.prototype.mapEndDrawStation = function(){\n\n  var mouseUpPosition = this.getPosition('up');\n  var offsetX = mouseUpPosition.x;\n  var offsetY = mouseUpPosition.y;\n\n  var stations = this.getStations();\n  var endDragStation  = null;\n\n  //查找起始工位\n\n  if(this.isPointInPath(offsetX,offsetY)){\n    stations.forEach(function(station,index){\n      if(offsetX >=station.x && offsetX<=(station.x+station.width)){\n        endDragStation = Object.assign({},station);\n      }\n    });\n  }\n\n  this.endDragStation = endDragStation;\n}\n\n\n//拖动工位\nPlanMap.prototype.onDragStation = function(){\n\n  //判断是否有权限\n\n  var permission = this.permission;\n\n  if(!(permission.hasOwnProperty('edit') && permission.edit)){\n    return ;\n  }\n\n  var clickStation = this.clickStation;\n\n  if(this.selectedStations.length && clickStation &&  clickStation.getChecked()){\n    this.createDragStationCanvas();\n  }\n\n  //响应拖拽工位开始事件\n  if(this.getEvent('dragBegin') && this.getEvent('dragStation')){\n    return ;\n  }\n\n  this.setEvent('drag',1);\n  this.setEvent('dragBegin',1);\n  this.setEvent('dragStation',1);\n  this.onDragStationBegin();\n\n}\n\nPlanMap.prototype.onDragStationBegin = function(){\n  var canvasElement = this.canvasElement;\n  Log.debug('拖拽工位开始了');\n  var selected = [];\n  if(this.single){\n    var downPosition = this.getPosition('down');\n    var selectedStation = this.hasPositionStation(downPosition);\n\n    if(selectedStation.getChecked()){\n      selected.push(selectedStation);\n    }\n  }else{\n    //选中的工位\n    var stations = this.getStations();\n    stations.map(function(item,index){\n      if(item.getChecked()){\n        var station = new Station(item.x,item.y,item.width,item.height,item.basic,item.index);\n        selected.push(station);\n      }\n    });\n  }\n  this.selectedStations = selected;\n}\n\nPlanMap.prototype.createDragStationCanvasModal = function(){\n\n  var context = this.context;\n  var canvasElement = this.canvasElement;\n  context.beginPath();\n  context.rect(-Math.abs(this.translateX),-Math.abs(this.translateY),this.width*this.scaleX+2*Math.abs(this.translateX),this.height+2*Math.abs(this.translateY));\n  context.strokeStyle = \"#ddd\";\n  context.fillStyle = \"rgba(0,0,0,0.5)\";\n  context.closePath();\n  context.stroke();\n  context.fill();\n}\n\nPlanMap.prototype.createDragStationCanvas = function(){\n\n  var context = this.context;\n  var canvasElement = this.canvasElement;\n  var selectedStations = this.selectedStations;\n\n  var position = this.getPosition('move');\n\n  this.drawStations();\n  this.createDragStationCanvasModal();\n\n  var move = this.getPosition('move');\n\n  var _this = this;\n\n  //选中的工位\n  selectedStations.map(function(station){\n\n    var positionX  = station.default.x + move.x / _this.scaleX - station.x;\n    var positionY = station.default.y + move.y / _this.scaleY - station.y;\n\n    station.position(positionX,positionY);\n    station.create(context);\n  });\n}\n\n//交换工位上的员工信息\nPlanMap.prototype.swapStationStaff = function(originStation,targetStation){\n\n\tvar Plugns = this.plugins;\n\n\tPlugns && Plugns.swapStationStaff && Plugns.swapStationStaff(originStation.getBasicInfo(),targetStation.getBasicInfo());\n\n\ttargetStation.setChecked(originStation.getChecked());\n\toriginStation.setChecked(!originStation.getChecked());\n\n\n\tvar stations = this.getStations();\n\tstations.splice(originStation.getIndex(),1,originStation);\n\tstations.splice(targetStation.getIndex(),1,targetStation);\n\n\tthis.setStations(stations);\n\n\tthis.drawStations();\n\n\n}\n\nPlanMap.prototype.onDragStationEnd = function(){\n\n\tvar downLoc = this.getPosition('down');\n\tvar upLoc = this.getPosition('up');\n\n\tvar originStation = this.hasPositionStation(downLoc);\n\tvar targetStation = this.hasPositionStation(upLoc);\n\n\tif(targetStation && originStation.getIndex() !== targetStation.getIndex()){\n\t\tthis.swapStationStaff(originStation,targetStation);\n\t}\n\n  this.selectedStations = [];\n\n}\n\n//默认前一个值\n/*\nPlanMap.prototype.setDefault = function(config){\n  var defaultConfigs = Object.assign({},this.default,config);\n  this.default = defaultConfigs;\n}\n*/\n//平面图移动\nPlanMap.prototype.translate = function(translateX,translateY){\n\n  var context = this.getContext();\n  var canvasElement = this.canvasElement;\n  var backgroundImage = this.backgroundImage;\n\n  //加上边界值\n  //translateX = (translateX<0?translateX:0);\n  //translateX = (translateX<-backgroundImage.width*this.scaleX?-backgroundImage.width*this.scaleX:translateX);\n\n  //translateY = (translateY<0?translateY:0);\n  //translateY = (translateY<-backgroundImage.height?-backgroundImage.height:translateY);\n\n  this.translateX = translateX;\n  this.translateY = translateY;\n\n}\n\n\n\n\nPlanMap.prototype.onLeftEventClick = function(){\n\n  var isOk = (this.getEvent('clickLeft') && !this.getEvent('clickRight'));\n  if(!isOk){\n    return ;\n  }\n\n  Log.debug('左点击事件');\n\n  var mouseUpPosition = this.getPosition('up');\n  this.onCheckedStation(mouseUpPosition);\n}\n\nPlanMap.prototype.onRightEventClick = function(){\n\n  var isOk = (!this.getEvent('clickLeft') && this.getEvent('clickRight'));\n  if(!isOk){\n    return ;\n  }\n\n  var mouseUpPosition = this.getPosition('up');\n\n  if(this.isPositionInStation(mouseUpPosition)){\n\n    var targetStation = this.hasPositionStation(mouseUpPosition);\n\n    if(targetStation === null){\n      return ;\n    }\n\n    this.openStationDialog(targetStation);\n  }\n\n}\n\nPlanMap.prototype.hasPositionStation = function(loc){\n\n  if(typeof loc !== 'object'){\n    throw new Error('PlanMap:hasPositionStation,参数@loc为对象');\n  }\n\n  var stations = this.getStations();\n  var hasStation = null;\n  for(var i = 0;i<stations.length;i++){\n    var station = stations[i];\n    if(loc.x >=station.x*this.scaleX && loc.x<=(station.x+station.width)*this.scaleX && (loc.y>=station.y*this.scaleY) && loc.y<= (station.y+station.height)*this.scaleY){\n      hasStation = station;\n      break;\n    }\n  }\n  return hasStation;\n}\n//坐标在工位上\nPlanMap.prototype.isPositionInStation = function(loc){\n  var isOk = false;\n  let stations = this.getStations();\n\n  /*\n  TODO:bug\n  if(!this.isPointInPath(loc.x,loc.y)){\n  return isOk;\n  }\n  */\n  if(this.hasPositionStation(loc)){\n    isOk = true;\n  }\n\n  return isOk;\n}\n\nPlanMap.prototype.calcScale = function(){\n\n  var move  = this.getPosition('move');\n\n  var defaultScale = 0.1;\n\n  //缩小\n   if(this.getEvent('whell') && this.getEvent('whellUp')){\n    defaultScale = -defaultScale;\n  }\n\n  var scaleX = this.scaleX+defaultScale;\n  var scaleY = this.scaleY+defaultScale;\n\n\n  var defaultTranslateX = Number(move.x)*Number(defaultScale);\n  //- Number(move.x);\n  var defaultTranslateY = Number(move.y)*Number(defaultScale);\n  // - Number(move.y);\n\n\n  //放大\n  if(this.getEvent('whell') && this.getEvent('whellDown')){\n    defaultTranslateX = -defaultTranslateX;\n    defaultTranslateY = -defaultTranslateY;\n    //缩小\n  }else if(this.getEvent('whell') && this.getEvent('whellUp')){\n    defaultTranslateX = -defaultTranslateX;\n    defaultTranslateY = -defaultTranslateY;\n  }\n\n  console.log(defaultTranslateX,move.x,defaultScale,defaultTranslateY);\n\n\nvar translateX = this.translateX + defaultTranslateX;\nvar translateY = this.translateY + defaultTranslateY;\n\n\n\tif(scaleX<0.6 || scaleX >10){\n\t\treturn ;\n\t}\n\n\tthis.translate(translateX,translateY);\n\tthis.scale(scaleX,scaleY);\n\n\tthis.drawStations();\n}\n\n//平面图－events\nPlanMap.prototype.initializeEvents = function(){\n\n\tlet canvasElement = this.canvasElement;\n\tlet context = this.getContext();\n\n\tlet _this = this;\n\n\n\tvar canvasMouseWhellEvent = function(event){\n\t\tvar position = _this.windowToCanvas(event);\n\t\t_this.setPosition('down',position)\n\n\t\t\tvar deltaY = event.deltaY;\n\t\tif(deltaY>0){\n\t\t\t_this.setEvent('whell',1);\n\t\t\t_this.setEvent('whellDown',1);\n\t\t\t_this.setEvent('whellUp',0);\n\t\t}else{\n\t\t\t_this.setEvent('whell',1);\n\t\t\t_this.setEvent('whellDown',0);\n\t\t\t_this.setEvent('whellUp',1);\n\t\t}\n\n\t\t_this.calcScale();\n\n\t}\n\n\twindow.addEventListener(\"mousewheel\",canvasMouseWhellEvent,false);\n\n\t//取消鼠标右击事件\n\n\tvar canvasCancelRightMouseEvent = function(event){\n\t\t// 鼠标右击事件\n\t\tif(event.button === 2){\n\t\t\tevent.preventDefault()\n\t\t};\n\t}\n\n\t//鼠标点击\n\tvar canvasMouseDown = function(event){\n\t\tevent = event || window.event;\n\n\t\tevent.preventDefault();\n\n\t\t_this.setEvent('drag',0);\n\n\t\tvar position = _this.windowToCanvas(event);\n\t\t_this.setPosition('down',position);\n\t\t//_this.setDefault({translateX:_this.translateX,translateY:_this.translateY});\n\n\t\t//鼠标右击事件\n\t\tif(event.button === 2){\n\t\t\tdocument.addEventListener('contextmenu', canvasCancelRightMouseEvent, false);\n\t\t\t_this.setEvent('clickRight',1);\n\t\t\t_this.setEvent('clickLeft',0);\n\n\t\t\treturn false;\n\t\t}else{\n\t\t\t_this.setEvent('clickRight',0);\n\t\t\t_this.setEvent('clickLeft',1);\n\t\t}\n\n\t\t//移动\n\t\twindow.setTimeout(function(){\n\t\t\t\tcanvasElement.addEventListener('mousemove',canvasMouseMove,false);\n\t\t\t\t},10);\n\t}\n\t//鼠标移动\n\tvar canvasMouseMove = function(e){\n\t\te = e || window.event;\n\n\n\t\t_this.setEvent('drag',1)\n\t\t\t_this.setEvent('click',0)\n\t\t\t_this.setEvent('clickLeft',0)\n\t\t\t_this.setEvent('clickRight',0)\n\n\n\t\t\t//判断是拖拽背景图、工位\n\t\t\tvar loc = _this.windowToCanvas(e);\n\t\t_this.setPosition('move',loc);\n\t\t_this.onDrag();\n\n\t}\n\n\tcanvasElement.addEventListener('mousemove',function(event){\n\t\t\t_this.setPosition('move',_this.windowToCanvas(event));\n\n\t\t\tvar canvasElement = _this.canvasElement;\n\t\t\tvar loc = _this.windowToCanvas(event);\n\t\t\t//更改鼠标状态\n\t\t\tif(_this.hasPositionStation(loc)){\n\t\t\tcanvasElement.style.cursor = 'pointer';\n\t\t\t}\n\n\t\t\t},false);\n\n\t//mousedown\n\tcanvasElement.addEventListener('mousedown',canvasMouseDown,false);\n\n\t//mouseup\n\tcanvasElement.addEventListener('mouseup',function(event){\n\t\t\tevent = event || window.event;\n\n\t\t\tdocument.removeEventListener('contextmenu', canvasCancelRightMouseEvent, false);\n\n\t\t\t_this.setPosition('up',_this.windowToCanvas(event))\n\n\t\t\tcanvasElement.removeEventListener('mousemove',canvasMouseMove,false);\n\n\t\t\t_this.onDragEnd();\n\n\n\n\t\t\t_this.onClick();\n\n\t\t\t});\n}\n\nPlanMap.prototype.judgeClick = function(){\n\n\tvar mouseDownPosition = this.getPosition('down');\n\tvar mouseUpPosition = this.getPosition('up');\n\tvar diffX = Math.abs(mouseDownPosition.x - mouseUpPosition.x);\n\tvar diffY = Math.abs(mouseDownPosition.y - mouseUpPosition.y);\n\n\tif(diffX < 1 && diffY<1){\n\t\tthis.setEvent('click',1);\n\t}\n\n}\n\n//判断是拖拽工位还是map\nPlanMap.prototype.judgeDragStationOrMap = function(){\n\n  var mouseDownPosition = this.getPosition('down');\n  var isStation = false;\n  if(this.hasPositionStation(this.getPosition('down'))){\n        isStation = true;\n  }\n\n  this.setEvent('dragStation',Number(isStation));\n  this.setEvent('dragMap',Number(!isStation));\n  this.setEvent('isJudgeDrag',1);\n}\n\nPlanMap.prototype.onDrag = function(){\n\n  if(!this.getEvent('isJudgeDrag')){\n\t   this.judgeDragStationOrMap();\n  }\n\n\tif(this.getEvent('drag') && this.getEvent('dragMap')){\n\t\tthis.onDragMap();\n\t\treturn ;\n\t}\n\n\tif(this.getEvent('drag') && this.getEvent('dragStation')){\n\t\tthis.onDragStation();\n\t\treturn ;\n\t}\n}\n\nPlanMap.prototype.onDragBegin = function(){\n  console.log('---???')\n\tthis.onDragMapBegin();\n}\n\nPlanMap.prototype.onDragEnd = function(){\n\n\t//重置\n\tthis.drawStations();\n\n\n  console.log('end');\n\tif(this.getEvent('drag') && this.getEvent('dragBegin') && this.getEvent('dargMap')){\n\t\tthis.onDragMapEnd();\n\t}\n\n\tif(this.getEvent('drag')  && this.getEvent('dragStation')){\n\t\tthis.onDragStationEnd();\n\t}\n\n\tthis.setEvent('drag',0);\n\tthis.setEvent('dragBeigin',0);\n\tthis.setEvent('dragEnd',1);\n\tthis.setEvent('dragMap',0);\n\tthis.setEvent('dragStation',0);\n  this.setEvent('isJudgeDrag',0);\n}\n\n//拖动平面图\n\nPlanMap.prototype.onDragMapBegin = function(){\n\n\tif(!(this.getEvent('drapBegin') && this.getEvent('dragMap'))){\n\t\treturn ;\n\t}\n\n\tLog.debug('拖拽底图开始了');\n}\n\nPlanMap.prototype.onDragMapEnd = function(){\n\tLog.debug('拖拽底图结束了');\n\tthis.setEvent('drag',0);\n}\n\nPlanMap.prototype.onDragMap = function(){\n\n\tvar origin = this.getPosition('down');\n\tvar move = this.getPosition('move');\n\tvar x = move.x - origin.x;\n\tvar y = move.y - origin.y;\n\n\tvar context = this.getContext();\n\tvar canvasElement = this.canvasElement;\n\tvar backgroundImage = this.backgroundImage;\n\n\tvar translateX = this.translateX+x;\n\tvar translateY = this.translateY+y;\n\n\n\tthis.translate(translateX,translateY);\n\n\tthis.drawStations(context);\n\n\tif(this.getEvent('dragBegin') && this.getEvent('dragMap')){\n\t\treturn ;\n\t}\n\n\tthis.setEvent('drag',1);\n\tthis.setEvent('dragBegin',1);\n\n\t//this.onDragBegin();\n\n}\n\n\nPlanMap.prototype.onClick = function(){\n\tif(!this.getEvent('click')){\n\t\treturn ;\n\t}\n\tthis.onRightEventClick();\n\tthis.onLeftEventClick();\n}\n\n//取消其他选中的station\nPlanMap.prototype.cancelCheckedAllStation = function(){\n\tvar stations = this.getStations();\n\tvar clickStation = this.clickStation;\n\n\tstations.forEach(function(station,index){\n\t\tif(station.getIndex() === clickStation.getIndex()){\n\t\t\treturn ;\n\t\t}\n\t\tstation.checked = false;\n\t});\n\n\tthis.setStations(stations);\n}\n\nPlanMap.prototype.setClickStation = function(clickStation){\n    this.clickStation = clickStation;\n}\n\nPlanMap.prototype.getClickStation = function(){\n  return this.clickStation;\n}\n\n//点击选中\nPlanMap.prototype.onCheckedStation = function(loc){\n\n\n\tlet stations = this.getStations();\n\t//关闭所有station dialog\n\tthis.closeAllStationDialog();\n\n\n\tlet clickStation = this.hasPositionStation(loc);\n\tif(!clickStation){\n\t\treturn ;\n\t}\n\n  clickStation.setChecked(!clickStation.getChecked());\n\tstations.splice(clickStation.getIndex(),1,clickStation);\n\n  this.setClickStation(clickStation);\n\n\n\tthis.setStations(stations);\n\n\tthis.drawStations();\n\n  var plugins = this.plugins;\n\n  plugins.onCheckedStation && plugins.onCheckedStation(clickStation,this.getCheckedStations());\n\n}\n\nPlanMap.prototype.getCheckedStations = function(){\n  var stations = this.stations;\n\n  var checkedStations = [];\n\n  stations.map(function(station){\n    if(station.getChecked()){\n      checkedStations.push(station);\n    }\n  });\n\n  return checkedStations;\n}\n\n//关闭所有的stations dialog\n\nPlanMap.prototype.closeAllStationDialog = function(station){\n\t//关闭其他的工位dialog\n\tvar stations = this.getStations();\n\tstations.map(function(item,index){\n\t\t\titem.closeDialog();\n\t\t\t});\n}\n\n//打开单个station dialog\nPlanMap.prototype.openStationDialog = function(station){\n\tif(!this.getEvent('clickRight')){\n\t\treturn ;\n\t}\n\n\tthis.closeAllStationDialog();\n\n\tLog.debug('选中了工位');\n\tLog.debug(station);\n\n\tstation.openDialog();\n\n}\n\n//平面图－工位拖拽\nPlanMap.prototype.dragStation = function(){\n\n}\n\n//平面图-选择工位\nPlanMap.prototype.setStationPostion = function(station){\n\tvar translateX = this.translateX;\n\tvar translateY = this.translateY;\n\treturn station;\n}\n\n//设置stations\nPlanMap.prototype.setStations = function(stations){\n\tthis.stations = stations;\n}\n\nPlanMap.prototype.getStations = function(){\n\treturn this.stations;\n}\n\nPlanMap.prototype.drawStations = function(context){\n\n\tcontext = context||this.getContext();\n\tvar canvasElement = this.canvasElement;\n\tvar stations = this.getStations();\n\n\tthis.reset();\n\tvar _this = this;\n\tstations.forEach(function(station,index){\n\t\t\tstation.position(Number(station.default.x),Number(station.default.y));\n\t\t\tstation.create(context);\n\t});\n}\n\n//平面图-鼠标位置\n\nPlanMap.prototype.windowToCanvas = function(event){\n\tvar position = {\nx:0,\n  y:0\n\t};\n\n\tvar canvasElement = this.canvasElement;\n\tlet bbox = {};\n\tbbox = canvasElement.getBoundingClientRect();\n\n\tvar clientX = event.clientX;\n\tvar clientY = event.clientY;\n\n\tposition.x = clientX-bbox.left * (this.width / bbox.width) -this.translateX;\n\tposition.y = clientY-bbox.top * (this.height / bbox.height)-this.translateY;\n\n\tposition.x = (position.x<0?Math.ceil(position.x):Math.floor(position.x));\n\tposition.y = (position.y<0?Math.ceil(position.y):Math.floor(position.y));\n\n\treturn position;\n\n};\n\n\nPlanMap.prototype.scale = function(scaleX,scaleY){\n\tthis.scaleX = scaleX;\n\tthis.scaleY = scaleY;\n}\n\n\n//平面图－工位信息－初始化\nPlanMap.prototype.initializeStations = function(){\n\n\t//工位数据\n\tvar stationsData = this.configs.stations;\n\tvar stations = [];\n\n\tvar context = this.getContext();\n\tvar translateX = this.translateX;\n\tvar translateY = this.translateY;\n\n\tstationsData.map(function(item,index){\n\n\t\t\tlet x = item.x;\n\t\t\tlet y = item.y;\n\t\t\tlet width = item.width;\n\t\t\tlet height = item.height;\n\t\t\tlet station =  new Station(x,y,width,height,item.basic,index);\n\n\t\t\tstations.push(station);\n\n\t\t\t});\n\n\tthis.setStations(stations);\n\n\tthis.drawStations();\n\n\n}\n\n\nmodule.exports = PlanMap;\n"]}