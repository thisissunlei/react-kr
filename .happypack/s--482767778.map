{"version":3,"sources":["src/Components/KrForm/Form/index.js"],"names":["KrForm","blur","focus","error","change","initializeValidations","initializeField","syncErrors","state","fields","values","props","context","fieldName","message","setState","name","fieldsItem","touched","active","value","validation","validations","checkValidation","getErrorMessage","errors","hasOwnProperty","String","length","test","validate","valiabled","validationKeys","Object","keys","_this","map","index","handleSubmit","onSubmit","reset","item","submit","event","window","preventDefault","initialValues","registeredFields","initial","nextProps","children","Component","displayName","defaultProps","propTypes","PropTypes","string","object","childContextTypes","func","isRequired"],"mappings":"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","file":"index.js","sourceRoot":"/Users/liuyihao/Code/kr-admin","sourcesContent":["import React from 'react';\n\nimport {ShallowEqual} from 'kr/Utils';\n\nexport default class KrForm  extends React.Component{\n\n  static displayName = 'KrForm';\n\n  static defaultProps = {\n    initialValues:{}\n  }\n  static propTypes = {\n    name:React.PropTypes.string,\n    initialValues:React.PropTypes.object,\n  }\n\n  static childContextTypes =  {\n          blur: React.PropTypes.func.isRequired,\n          focus: React.PropTypes.func.isRequired,\n          error: React.PropTypes.func.isRequired,\n          change: React.PropTypes.func.isRequired,\n          initializeField:React.PropTypes.func.isRequired,\n          syncErrors:React.PropTypes.object.isRequired,\n          fields:React.PropTypes.object.isRequired,\n          initializeValidations:React.PropTypes.func.isRequired,\n          values:React.PropTypes.object.isRequired,\n  }\n\n\tgetChildContext() {\n\t\t\t\treturn {\n\t\t\t\t\tblur:this.blur,\n\t\t\t\t\tfocus:this.focus,\n          error:this.error,\n\t\t\t\t\tchange:this.change,\n          initializeValidations:this.initializeValidations,\n          initializeField: this.initializeField,\n          syncErrors:this.state.syncErrors,\n          fields:this.state.fields,\n          values:this.state.values,\n\t\t\t\t};\n\t }\n\n\n\tconstructor(props,context){\n\t\tsuper(props, context);\n\n    let {initialValues} = this.props;\n\n    this.state = {\n      initialValues:initialValues,\n      registeredFields:[],\n      syncErrors:{},\n      fields:{},\n      values:initialValues,\n      initial:{},\n      validations:{}\n    }\n\n\t}\n\n  componentWillReceiveProps(nextProps) {\n\n    if(!ShallowEqual(nextProps.initialValues,this.props.initialValues)){\n        this.setState({\n          values:nextProps.initialValues\n        });\n    }\n\n  }\n\n  error =  (fieldName,message='')=>{\n\n    let {syncErrors} = this.state;\n    syncErrors[fieldName] = message;\n\n    this.setState({\n      syncErrors\n    });\n\n  }\n\n  blur =  (name)=>{\n\n    let {fields} = this.state;\n\n    let fieldsItem = fields[name] || {};\n    fieldsItem.touched = true;\n    fieldsItem.active = false;\n\n    fields[name] = fieldsItem;\n\n    this.setState({\n      fields\n    });\n\n  }\n\n  focus = (name)=>{\n\n    let {fields} = this.state;\n\n    let fieldsItem = fields[name] || {};\n    fieldsItem.touched = true;\n    fieldsItem.active = true;\n\n    fields[name] = fieldsItem;\n\n    this.setState({\n      fields\n    });\n\n  }\n\n  initializeField = (name,value = '')=>{\n    this.change(name,value);\n  }\n\n  initializeValidations = (name,validation)=>{\n\n    let {validations} = this.state;\n    validations[name] = validation;\n\n    this.setState({\n        validations\n    });\n\n  }\n\n  change =(fieldName,value)=>{\n\n    let {values,validations,syncErrors} = this.state;\n    let checkValidation = validations[fieldName];\n\n    values[fieldName] = value;\n\n    if(typeof checkValidation === 'object'){\n      syncErrors[fieldName] = this.getErrorMessage(values[fieldName],checkValidation);\n    }\n\n    this.setState({\n      values,\n      syncErrors\n    });\n\n\n  }\n\n  getErrorMessage = (value,validation)=>{\n\n    let {errors}  = validation;\n\n    if(typeof errors === 'undefined'){\n      return '';\n    }\n\n\t\tif(errors.hasOwnProperty('requiredValue') && !value){\n\t\t\treturn errors['requiredValue'];\n\t\t}\n\n\t\tif(errors.hasOwnProperty('minLength') && String(value).length<validation['minLength']){\n\n\t\t\treturn errors['minLength'];\n\t\t}\n\n\t\tif(errors.hasOwnProperty('maxLength') && String(value).length>validation['maxLength']){\n\t\t\treturn errors['maxLength'];\n\t\t}\n\n\t\tif(errors.hasOwnProperty('pattern') && !validation['pattern'].test(value)){\n\t\t\treturn errors['pattern'];\n\t\t}\n\n    return '';\n  }\n\n  validate = ()=>{\n\n    let valiabled = true;\n\n    let {validations,values,syncErrors,fields} = this.state;\n    let validationKeys = Object.keys(validations);\n\n    let checkValidation = {};\n    let _this = this;\n\n    validationKeys.map(function(fieldName,index){\n\n      if(!validations.hasOwnProperty(fieldName)){\n        return ;\n      }\n\n      checkValidation = validations[fieldName];\n\n      syncErrors[fieldName] = _this.getErrorMessage(values[fieldName],checkValidation);\n\n      fields[fieldName] = Object.assign({},fields[fieldName],{touched:true});\n\n      if(syncErrors[fieldName]){\n        valiabled = false;\n      }\n\n    });\n\n    this.setState({\n        syncErrors,\n        fields,\n    });\n\n    return valiabled;\n\n  }\n\n  handleSubmit = (onSubmit)=>{\n    //校验\n    let {values} = this.state;\n    onSubmit && onSubmit(values);\n  }\n\n  reset = ()=>{\n\n      let {values,syncErrors,fields} = this.state;\n\n      Object.keys(values).map(function(item,index){\n            values[item] = '';\n      });\n\n      Object.keys(syncErrors).map(function(item,index){\n            syncErrors[item] = '';\n      });\n\n/*\n      fields = Object.keys(fields).map(function(item,index){\n          return Object.assign({},item,{touched:false});\n      });\n      */\n\n      this.setState({\n        values,\n      });\n\n  }\n\n  submit =(event)=>{\n\n    event = event || window.event;\n    //取消默认事件\n     event.preventDefault();\n\n\n\n    //校验\n    if(!this.validate()){\n        return ;\n    }\n\n    const {values} = this.state;\n\n    const {onSubmit} = this.props;\n    onSubmit && onSubmit(values);\n\n     return false;\n  }\n\n\trender(){\n\n    const {name,children} = this.props;\n\n\t  return (\n\t\t  <form name={name} onSubmit={this.submit}>\n          {children}\n\t\t  </form>\n\t );\n\t}\n}\n"]}