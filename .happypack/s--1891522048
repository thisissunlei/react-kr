'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Redux = require('kr/Redux');

var _krUi = require('kr-ui');

var _OrderEditForm = require('./OrderEditForm');

var _OrderEditForm2 = _interopRequireDefault(_OrderEditForm);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var OrderCreate = function (_Component) {
	_inherits(OrderCreate, _Component);

	function OrderCreate(props, context) {
		_classCallCheck(this, OrderCreate);

		var _this2 = _possibleConstructorReturn(this, (OrderCreate.__proto__ || Object.getPrototypeOf(OrderCreate)).call(this, props, context));

		_this2.onSubmit = function (values) {

			if (_this2.isOk) {
				return false;
			}

			_this2.isOk = true;
			values.customerid = _this2.context.params.customerId;

			var _this = _this2;

			_Redux.Store.dispatch(_Redux.Actions.callAPI('enter-order', {}, values)).then(function (response) {

				_krUi.Notify.show([{
					message: '保存成功',
					type: 'success'
				}]);

				window.setTimeout(function () {
					window.top.location.reload();
					_this.isOk = false;
				}, 100);
			}).catch(function (err) {

				_krUi.Notify.show([{
					message: '创建失败',
					type: 'danger'
				}]);

				window.setTimeout(function () {
					_this.isOk = false;
				}, 0);
			});
		};

		_this2.onCancel = function () {
			window.top.location.reload();
		};

		_this2.getInitValues = function () {
			var _this = _this2;
			var communityOptions = [];
			var initialValues = {};

			var orderTypeOptions = [];
			_Redux.Store.dispatch(_Redux.Actions.callAPI('community-city-selected')).then(function (response) {
				communityOptions = response.communityCity.map(function (item) {
					item.value = String(item.communityId);
					item.label = item.communityName;
					return item;
				});

				orderTypeOptions = response.sysDicPayments.map(function (item) {
					item.value = String(item.id);
					item.label = item.dicName;
					return item;
				});

				_this.setState({
					communityOptions: communityOptions,
					orderTypeOptions: orderTypeOptions
				});
			}).catch(function (err) {});

			_Redux.Store.dispatch(_Redux.Actions.callAPI('get-customName-orderName', {
				customerId: _this2.props.params.customerId
			}, {})).then(function (response) {

				var initialValues = {};
				initialValues = response;
				initialValues.communityid = String(initialValues.communityid);
				_this.setState({
					initialValues: initialValues,
					loading: false
				});
			}).catch(function (err) {
				_krUi.Notify.show([{
					message: err.message,
					type: 'danger'
				}]);
			});
		};

		_this2.isOk = false;

		_this2.state = {
			loading: true,
			communityOptions: [],
			initialValues: {},
			orderTypeOptions: [{
				value: '',
				label: '请选择类型'
			}, {
				value: 'STATION',
				label: '工位服务订单'
			}, {
				value: 'INCUBAZION',
				label: '孵化订单'
			}, {
				value: 'REGISTER',
				label: '注册订单'
			}, {
				value: 'INCUSTOM',
				label: '场内消费订单'
			}, {
				value: 'ACTIVITY',
				label: '广告订单'
			}, {
				value: 'ADDEDSERVICE',
				label: '增值服务订单'
			}, {
				value: 'TRAINING',
				label: '培训订单'
			}, {
				value: 'OTHER',
				label: '其他服务订单'
			}]

		};
		_Redux.Store.dispatch(_Redux.Actions.switchSidebarNav(false));
		_Redux.Store.dispatch(_Redux.Actions.switchHeaderNav(false));

		return _this2;
	}

	_createClass(OrderCreate, [{
		key: 'componentDidMount',
		value: function componentDidMount() {
			var obj = document.body;
			obj.style.background = '#fff';
			this.getInitValues();
		}
	}, {
		key: 'componentWillReceiveProps',
		value: function componentWillReceiveProps(nextProps) {}
	}, {
		key: 'render',
		value: function render() {

			if (this.state.loading) {
				return _react2.default.createElement(_krUi.Loading, null);
			}
			var _state = this.state,
			    initialValues = _state.initialValues,
			    communityOptions = _state.communityOptions,
			    orderTypeOptions = _state.orderTypeOptions;


			return _react2.default.createElement(
				'div',
				null,
				_react2.default.createElement(_OrderEditForm2.default, { onSubmit: this.onSubmit, communityOptions: communityOptions, initialValues: initialValues, orderTypeOptions: orderTypeOptions, onCancel: this.onCancel })
			);
		}
	}]);

	return OrderCreate;
}(_react.Component);

// const selector = formValueSelector('orderEditForm');

// function mapStateToProps(state){

// 	let communitys = state.common['community-city-selected'];

// 	if(Object.prototype.toString.call(communitys) !== '[object Array]'){
// 		communitys = [];
// 	}

// 	const communityid = selector(state, 'communityid');

// 	let cityName = '';
// 	communitys.map(function(item){
// 		if(item.communityId == communityid){
// 			cityName = item.cityName;
// 		}
// 	});

// 	return {
// 		cityName,
// 		initialValues:state.common['get-simple-order'],
// 		communitys,
//    	};
// }


// export default connect(mapStateToProps)(OrderCreate);

// }


OrderCreate.contextTypes = {
	params: _react2.default.PropTypes.object.isRequired

};
exports.default = OrderCreate;
;

var _temp = function () {
	if (typeof __REACT_HOT_LOADER__ === 'undefined') {
		return;
	}

	__REACT_HOT_LOADER__.register(OrderCreate, 'OrderCreate', '/Users/liuyihao/Code/kr-admin/src/Containers/Operation/CustomerManage/Order/Create/index.js');
}();

;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9Db250YWluZXJzL09wZXJhdGlvbi9DdXN0b21lck1hbmFnZS9PcmRlci9DcmVhdGUvaW5kZXguanMiXSwibmFtZXMiOlsiT3JkZXJDcmVhdGUiLCJwcm9wcyIsImNvbnRleHQiLCJvblN1Ym1pdCIsInZhbHVlcyIsImlzT2siLCJjdXN0b21lcmlkIiwicGFyYW1zIiwiY3VzdG9tZXJJZCIsIl90aGlzIiwiZGlzcGF0Y2giLCJjYWxsQVBJIiwidGhlbiIsInJlc3BvbnNlIiwic2hvdyIsIm1lc3NhZ2UiLCJ0eXBlIiwid2luZG93Iiwic2V0VGltZW91dCIsInRvcCIsImxvY2F0aW9uIiwicmVsb2FkIiwiY2F0Y2giLCJlcnIiLCJvbkNhbmNlbCIsImdldEluaXRWYWx1ZXMiLCJjb21tdW5pdHlPcHRpb25zIiwiaW5pdGlhbFZhbHVlcyIsIm9yZGVyVHlwZU9wdGlvbnMiLCJjb21tdW5pdHlDaXR5IiwibWFwIiwiaXRlbSIsInZhbHVlIiwiU3RyaW5nIiwiY29tbXVuaXR5SWQiLCJsYWJlbCIsImNvbW11bml0eU5hbWUiLCJzeXNEaWNQYXltZW50cyIsImlkIiwiZGljTmFtZSIsInNldFN0YXRlIiwiY29tbXVuaXR5aWQiLCJsb2FkaW5nIiwic3RhdGUiLCJzd2l0Y2hTaWRlYmFyTmF2Iiwic3dpdGNoSGVhZGVyTmF2Iiwib2JqIiwiZG9jdW1lbnQiLCJib2R5Iiwic3R5bGUiLCJiYWNrZ3JvdW5kIiwibmV4dFByb3BzIiwiY29udGV4dFR5cGVzIiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7QUFJQTs7QUFNQTs7QUFpQkE7Ozs7Ozs7Ozs7OztJQUdxQkEsVzs7O0FBTXBCLHNCQUFZQyxLQUFaLEVBQW1CQyxPQUFuQixFQUE0QjtBQUFBOztBQUFBLHlIQUNyQkQsS0FEcUIsRUFDZEMsT0FEYzs7QUFBQSxTQXFENUJDLFFBckQ0QixHQXFEakIsVUFBQ0MsTUFBRCxFQUFZOztBQUV0QixPQUFJLE9BQUtDLElBQVQsRUFBZTtBQUNkLFdBQU8sS0FBUDtBQUNBOztBQUVELFVBQUtBLElBQUwsR0FBWSxJQUFaO0FBQ0FELFVBQU9FLFVBQVAsR0FBb0IsT0FBS0osT0FBTCxDQUFhSyxNQUFiLENBQW9CQyxVQUF4Qzs7QUFFQSxPQUFJQyxjQUFKOztBQUVBLGdCQUFNQyxRQUFOLENBQWUsZUFBUUMsT0FBUixDQUFnQixhQUFoQixFQUErQixFQUEvQixFQUFtQ1AsTUFBbkMsQ0FBZixFQUEyRFEsSUFBM0QsQ0FBZ0UsVUFBU0MsUUFBVCxFQUFtQjs7QUFFbEYsaUJBQU9DLElBQVAsQ0FBWSxDQUFDO0FBQ1pDLGNBQVMsTUFERztBQUVaQyxXQUFNO0FBRk0sS0FBRCxDQUFaOztBQUtBQyxXQUFPQyxVQUFQLENBQWtCLFlBQVc7QUFDNUJELFlBQU9FLEdBQVAsQ0FBV0MsUUFBWCxDQUFvQkMsTUFBcEI7QUFDQVosV0FBTUosSUFBTixHQUFhLEtBQWI7QUFDQSxLQUhELEVBR0csR0FISDtBQUtBLElBWkQsRUFZR2lCLEtBWkgsQ0FZUyxVQUFTQyxHQUFULEVBQWM7O0FBRXRCLGlCQUFPVCxJQUFQLENBQVksQ0FBQztBQUNaQyxjQUFTLE1BREc7QUFFWkMsV0FBTTtBQUZNLEtBQUQsQ0FBWjs7QUFLQUMsV0FBT0MsVUFBUCxDQUFrQixZQUFXO0FBQzVCVCxXQUFNSixJQUFOLEdBQWEsS0FBYjtBQUNBLEtBRkQsRUFFRyxDQUZIO0FBSUEsSUF2QkQ7QUF5QkEsR0F6RjJCOztBQUFBLFNBMEY1Qm1CLFFBMUY0QixHQTBGakIsWUFBTTtBQUNoQlAsVUFBT0UsR0FBUCxDQUFXQyxRQUFYLENBQW9CQyxNQUFwQjtBQUNBLEdBNUYyQjs7QUFBQSxTQStGNUJJLGFBL0Y0QixHQStGWixZQUFNO0FBQ3JCLE9BQUloQixjQUFKO0FBQ0EsT0FBSWlCLG1CQUFtQixFQUF2QjtBQUNBLE9BQUlDLGdCQUFnQixFQUFwQjs7QUFFQSxPQUFJQyxtQkFBbUIsRUFBdkI7QUFDQSxnQkFBTWxCLFFBQU4sQ0FBZSxlQUFRQyxPQUFSLENBQWdCLHlCQUFoQixDQUFmLEVBQTJEQyxJQUEzRCxDQUFnRSxVQUFTQyxRQUFULEVBQW1CO0FBQ2xGYSx1QkFBbUJiLFNBQVNnQixhQUFULENBQXVCQyxHQUF2QixDQUEyQixVQUFDQyxJQUFELEVBQVU7QUFDdkRBLFVBQUtDLEtBQUwsR0FBYUMsT0FBT0YsS0FBS0csV0FBWixDQUFiO0FBQ0FILFVBQUtJLEtBQUwsR0FBYUosS0FBS0ssYUFBbEI7QUFDQSxZQUFPTCxJQUFQO0FBQ0EsS0FKa0IsQ0FBbkI7O0FBTUFILHVCQUFtQmYsU0FBU3dCLGNBQVQsQ0FBd0JQLEdBQXhCLENBQTRCLFVBQUNDLElBQUQsRUFBVTtBQUN4REEsVUFBS0MsS0FBTCxHQUFhQyxPQUFPRixLQUFLTyxFQUFaLENBQWI7QUFDQVAsVUFBS0ksS0FBTCxHQUFhSixLQUFLUSxPQUFsQjtBQUNBLFlBQU9SLElBQVA7QUFDQSxLQUprQixDQUFuQjs7QUFNQXRCLFVBQU0rQixRQUFOLENBQWU7QUFDZGQsdUJBQWtCQSxnQkFESjtBQUVkRSx1QkFBa0JBO0FBRkosS0FBZjtBQUlBLElBakJELEVBaUJHTixLQWpCSCxDQWlCUyxVQUFTQyxHQUFULEVBQWMsQ0FBRSxDQWpCekI7O0FBb0JBLGdCQUFNYixRQUFOLENBQWUsZUFBUUMsT0FBUixDQUFnQiwwQkFBaEIsRUFBNEM7QUFDMURILGdCQUFZLE9BQUtQLEtBQUwsQ0FBV00sTUFBWCxDQUFrQkM7QUFENEIsSUFBNUMsRUFFWixFQUZZLENBQWYsRUFFUUksSUFGUixDQUVhLFVBQVNDLFFBQVQsRUFBbUI7O0FBRS9CLFFBQUljLGdCQUFnQixFQUFwQjtBQUNBQSxvQkFBZ0JkLFFBQWhCO0FBQ0FjLGtCQUFjYyxXQUFkLEdBQTRCUixPQUFPTixjQUFjYyxXQUFyQixDQUE1QjtBQUNBaEMsVUFBTStCLFFBQU4sQ0FBZTtBQUNkYixpQ0FEYztBQUVkZSxjQUFTO0FBRkssS0FBZjtBQUlBLElBWEQsRUFXR3BCLEtBWEgsQ0FXUyxVQUFTQyxHQUFULEVBQWM7QUFDdEIsaUJBQU9ULElBQVAsQ0FBWSxDQUFDO0FBQ1pDLGNBQVNRLElBQUlSLE9BREQ7QUFFWkMsV0FBTTtBQUZNLEtBQUQsQ0FBWjtBQUlBLElBaEJEO0FBaUJBLEdBMUkyQjs7QUFJM0IsU0FBS1gsSUFBTCxHQUFZLEtBQVo7O0FBR0EsU0FBS3NDLEtBQUwsR0FBYTtBQUNaRCxZQUFTLElBREc7QUFFWmhCLHFCQUFrQixFQUZOO0FBR1pDLGtCQUFlLEVBSEg7QUFJWkMscUJBQWtCLENBQUM7QUFDbEJJLFdBQU8sRUFEVztBQUVsQkcsV0FBTztBQUZXLElBQUQsRUFHZjtBQUNGSCxXQUFPLFNBREw7QUFFRkcsV0FBTztBQUZMLElBSGUsRUFNZjtBQUNGSCxXQUFPLFlBREw7QUFFRkcsV0FBTztBQUZMLElBTmUsRUFTZjtBQUNGSCxXQUFPLFVBREw7QUFFRkcsV0FBTztBQUZMLElBVGUsRUFZZjtBQUNGSCxXQUFPLFVBREw7QUFFRkcsV0FBTztBQUZMLElBWmUsRUFlZjtBQUNGSCxXQUFPLFVBREw7QUFFRkcsV0FBTztBQUZMLElBZmUsRUFrQmY7QUFDRkgsV0FBTyxjQURMO0FBRUZHLFdBQU87QUFGTCxJQWxCZSxFQXFCZjtBQUNGSCxXQUFPLFVBREw7QUFFRkcsV0FBTztBQUZMLElBckJlLEVBd0JmO0FBQ0ZILFdBQU8sT0FETDtBQUVGRyxXQUFPO0FBRkwsSUF4QmU7O0FBSk4sR0FBYjtBQWtDQSxlQUFNekIsUUFBTixDQUFlLGVBQVFrQyxnQkFBUixDQUF5QixLQUF6QixDQUFmO0FBQ0EsZUFBTWxDLFFBQU4sQ0FBZSxlQUFRbUMsZUFBUixDQUF3QixLQUF4QixDQUFmOztBQTFDMkI7QUE0QzNCOzs7O3NDQUVtQjtBQUNuQixPQUFJQyxNQUFNQyxTQUFTQyxJQUFuQjtBQUNBRixPQUFJRyxLQUFKLENBQVVDLFVBQVYsR0FBdUIsTUFBdkI7QUFDQSxRQUFLekIsYUFBTDtBQUdBOzs7NENBMEN5QjBCLFMsRUFBVyxDQUFFOzs7MkJBK0M5Qjs7QUFHUixPQUFJLEtBQUtSLEtBQUwsQ0FBV0QsT0FBZixFQUF3QjtBQUN2QixXQUFRLGtEQUFSO0FBQ0E7QUFMTyxnQkFVSixLQUFLQyxLQVZEO0FBQUEsT0FPUGhCLGFBUE8sVUFPUEEsYUFQTztBQUFBLE9BUVBELGdCQVJPLFVBUVBBLGdCQVJPO0FBQUEsT0FTUEUsZ0JBVE8sVUFTUEEsZ0JBVE87OztBQWNSLFVBRVM7QUFBQTtBQUFBO0FBQ1IsNkRBQWUsVUFBVSxLQUFLekIsUUFBOUIsRUFBd0Msa0JBQWtCdUIsZ0JBQTFELEVBQTRFLGVBQWVDLGFBQTNGLEVBQTBHLGtCQUFrQkMsZ0JBQTVILEVBQThJLFVBQVUsS0FBS0osUUFBN0o7QUFEUSxJQUZUO0FBUUE7Ozs7OztBQUlGOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFJQTs7QUFFQTs7O0FBM01xQnhCLFcsQ0FFYm9ELFksR0FBZTtBQUNyQjdDLFNBQVEsZ0JBQU04QyxTQUFOLENBQWdCQyxNQUFoQixDQUF1QkM7O0FBRFYsQztrQkFGRnZELFc7Ozs7Ozs7OytCQUFBQSxXIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9saXV5aWhhby9Db2RlL2tyLWFkbWluIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7XG5cdENvbXBvbmVudCxcblx0UHJvcFR5cGVzXG59IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7XG5cdGNvbm5lY3QsXG5cdFN0b3JlLFxuXHRBY3Rpb25zXG59IGZyb20gJ2tyL1JlZHV4JztcblxuaW1wb3J0IHtcblx0S3JGaWVsZCxcblx0TGFiZWxUZXh0LFxuXHRTZWN0aW9uLFxuXHRCcmVhZENydW1icyxcblx0R3JpZCxcblx0Um93LFxuXHRDb2wsXG5cdE5vdGlmeSxcblx0TG9hZGluZyxcblx0QnV0dG9uLFxuXHREaWFsb2csXG5cdFNuYWNrYmFyLFxuXHRMaXN0R3JvdXAsXG5cdExpc3RHcm91cEl0ZW1cbn0gZnJvbSAna3ItdWknO1xuXG5pbXBvcnQgT3JkZXJFZGl0Rm9ybSBmcm9tICcuL09yZGVyRWRpdEZvcm0nO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE9yZGVyQ3JlYXRlIGV4dGVuZHMgQ29tcG9uZW50IHtcblxuXHRzdGF0aWMgY29udGV4dFR5cGVzID0ge1xuXHRcdHBhcmFtczogUmVhY3QuUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuXG5cdH1cblx0Y29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcblx0XHRzdXBlcihwcm9wcywgY29udGV4dCk7XG5cblxuXHRcdHRoaXMuaXNPayA9IGZhbHNlO1xuXG5cblx0XHR0aGlzLnN0YXRlID0ge1xuXHRcdFx0bG9hZGluZzogdHJ1ZSxcblx0XHRcdGNvbW11bml0eU9wdGlvbnM6IFtdLFxuXHRcdFx0aW5pdGlhbFZhbHVlczoge30sXG5cdFx0XHRvcmRlclR5cGVPcHRpb25zOiBbe1xuXHRcdFx0XHR2YWx1ZTogJycsXG5cdFx0XHRcdGxhYmVsOiAn6K+36YCJ5oup57G75Z6LJ1xuXHRcdFx0fSwge1xuXHRcdFx0XHR2YWx1ZTogJ1NUQVRJT04nLFxuXHRcdFx0XHRsYWJlbDogJ+W3peS9jeacjeWKoeiuouWNlSdcblx0XHRcdH0sIHtcblx0XHRcdFx0dmFsdWU6ICdJTkNVQkFaSU9OJyxcblx0XHRcdFx0bGFiZWw6ICflrbXljJborqLljZUnXG5cdFx0XHR9LCB7XG5cdFx0XHRcdHZhbHVlOiAnUkVHSVNURVInLFxuXHRcdFx0XHRsYWJlbDogJ+azqOWGjOiuouWNlSdcblx0XHRcdH0sIHtcblx0XHRcdFx0dmFsdWU6ICdJTkNVU1RPTScsXG5cdFx0XHRcdGxhYmVsOiAn5Zy65YaF5raI6LS56K6i5Y2VJ1xuXHRcdFx0fSwge1xuXHRcdFx0XHR2YWx1ZTogJ0FDVElWSVRZJyxcblx0XHRcdFx0bGFiZWw6ICflub/lkYrorqLljZUnXG5cdFx0XHR9LCB7XG5cdFx0XHRcdHZhbHVlOiAnQURERURTRVJWSUNFJyxcblx0XHRcdFx0bGFiZWw6ICflop7lgLzmnI3liqHorqLljZUnXG5cdFx0XHR9LCB7XG5cdFx0XHRcdHZhbHVlOiAnVFJBSU5JTkcnLFxuXHRcdFx0XHRsYWJlbDogJ+WfueiureiuouWNlSdcblx0XHRcdH0sIHtcblx0XHRcdFx0dmFsdWU6ICdPVEhFUicsXG5cdFx0XHRcdGxhYmVsOiAn5YW25LuW5pyN5Yqh6K6i5Y2VJ1xuXHRcdFx0fV1cblxuXHRcdH1cblx0XHRTdG9yZS5kaXNwYXRjaChBY3Rpb25zLnN3aXRjaFNpZGViYXJOYXYoZmFsc2UpKTtcblx0XHRTdG9yZS5kaXNwYXRjaChBY3Rpb25zLnN3aXRjaEhlYWRlck5hdihmYWxzZSkpO1xuXG5cdH1cblxuXHRjb21wb25lbnREaWRNb3VudCgpIHtcblx0XHR2YXIgb2JqID0gZG9jdW1lbnQuYm9keTtcblx0XHRvYmouc3R5bGUuYmFja2dyb3VuZCA9ICcjZmZmJztcblx0XHR0aGlzLmdldEluaXRWYWx1ZXMoKTtcblxuXG5cdH1cblx0b25TdWJtaXQgPSAodmFsdWVzKSA9PiB7XG5cblx0XHRpZiAodGhpcy5pc09rKSB7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXG5cdFx0dGhpcy5pc09rID0gdHJ1ZTtcblx0XHR2YWx1ZXMuY3VzdG9tZXJpZCA9IHRoaXMuY29udGV4dC5wYXJhbXMuY3VzdG9tZXJJZDtcblxuXHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cblx0XHRTdG9yZS5kaXNwYXRjaChBY3Rpb25zLmNhbGxBUEkoJ2VudGVyLW9yZGVyJywge30sIHZhbHVlcykpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuXHRcdFx0Tm90aWZ5LnNob3coW3tcblx0XHRcdFx0bWVzc2FnZTogJ+S/neWtmOaIkOWKnycsXG5cdFx0XHRcdHR5cGU6ICdzdWNjZXNzJyxcblx0XHRcdH1dKTtcblxuXHRcdFx0d2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHdpbmRvdy50b3AubG9jYXRpb24ucmVsb2FkKCk7XG5cdFx0XHRcdF90aGlzLmlzT2sgPSBmYWxzZTtcblx0XHRcdH0sIDEwMCk7XG5cblx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcblxuXHRcdFx0Tm90aWZ5LnNob3coW3tcblx0XHRcdFx0bWVzc2FnZTogJ+WIm+W7uuWksei0pScsXG5cdFx0XHRcdHR5cGU6ICdkYW5nZXInLFxuXHRcdFx0fV0pO1xuXG5cdFx0XHR3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0X3RoaXMuaXNPayA9IGZhbHNlO1xuXHRcdFx0fSwgMCk7XG5cblx0XHR9KTtcblxuXHR9XG5cdG9uQ2FuY2VsID0gKCkgPT4ge1xuXHRcdHdpbmRvdy50b3AubG9jYXRpb24ucmVsb2FkKCk7XG5cdH1cblxuXHRjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge31cblx0Z2V0SW5pdFZhbHVlcyA9ICgpID0+IHtcblx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRcdGxldCBjb21tdW5pdHlPcHRpb25zID0gW107XG5cdFx0bGV0IGluaXRpYWxWYWx1ZXMgPSB7fTtcblxuXHRcdGxldCBvcmRlclR5cGVPcHRpb25zID0gW107XG5cdFx0U3RvcmUuZGlzcGF0Y2goQWN0aW9ucy5jYWxsQVBJKCdjb21tdW5pdHktY2l0eS1zZWxlY3RlZCcpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0XHRjb21tdW5pdHlPcHRpb25zID0gcmVzcG9uc2UuY29tbXVuaXR5Q2l0eS5tYXAoKGl0ZW0pID0+IHtcblx0XHRcdFx0aXRlbS52YWx1ZSA9IFN0cmluZyhpdGVtLmNvbW11bml0eUlkKTtcblx0XHRcdFx0aXRlbS5sYWJlbCA9IGl0ZW0uY29tbXVuaXR5TmFtZTtcblx0XHRcdFx0cmV0dXJuIGl0ZW07XG5cdFx0XHR9KTtcblxuXHRcdFx0b3JkZXJUeXBlT3B0aW9ucyA9IHJlc3BvbnNlLnN5c0RpY1BheW1lbnRzLm1hcCgoaXRlbSkgPT4ge1xuXHRcdFx0XHRpdGVtLnZhbHVlID0gU3RyaW5nKGl0ZW0uaWQpO1xuXHRcdFx0XHRpdGVtLmxhYmVsID0gaXRlbS5kaWNOYW1lO1xuXHRcdFx0XHRyZXR1cm4gaXRlbTtcblx0XHRcdH0pO1xuXG5cdFx0XHRfdGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdGNvbW11bml0eU9wdGlvbnM6IGNvbW11bml0eU9wdGlvbnMsXG5cdFx0XHRcdG9yZGVyVHlwZU9wdGlvbnM6IG9yZGVyVHlwZU9wdGlvbnNcblx0XHRcdH0pXG5cdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7fSk7XG5cblxuXHRcdFN0b3JlLmRpc3BhdGNoKEFjdGlvbnMuY2FsbEFQSSgnZ2V0LWN1c3RvbU5hbWUtb3JkZXJOYW1lJywge1xuXHRcdFx0Y3VzdG9tZXJJZDogdGhpcy5wcm9wcy5wYXJhbXMuY3VzdG9tZXJJZFxuXHRcdH0sIHt9KSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuXG5cdFx0XHRsZXQgaW5pdGlhbFZhbHVlcyA9IHt9O1xuXHRcdFx0aW5pdGlhbFZhbHVlcyA9IHJlc3BvbnNlO1xuXHRcdFx0aW5pdGlhbFZhbHVlcy5jb21tdW5pdHlpZCA9IFN0cmluZyhpbml0aWFsVmFsdWVzLmNvbW11bml0eWlkKTtcblx0XHRcdF90aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0aW5pdGlhbFZhbHVlcyxcblx0XHRcdFx0bG9hZGluZzogZmFsc2Vcblx0XHRcdH0pXG5cdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG5cdFx0XHROb3RpZnkuc2hvdyhbe1xuXHRcdFx0XHRtZXNzYWdlOiBlcnIubWVzc2FnZSxcblx0XHRcdFx0dHlwZTogJ2RhbmdlcicsXG5cdFx0XHR9XSk7XG5cdFx0fSk7XG5cdH1cblxuXG5cdHJlbmRlcigpIHtcblxuXG5cdFx0aWYgKHRoaXMuc3RhdGUubG9hZGluZykge1xuXHRcdFx0cmV0dXJuICg8TG9hZGluZy8+KTtcblx0XHR9XG5cdFx0bGV0IHtcblx0XHRcdGluaXRpYWxWYWx1ZXMsXG5cdFx0XHRjb21tdW5pdHlPcHRpb25zLFxuXHRcdFx0b3JkZXJUeXBlT3B0aW9uc1xuXHRcdH0gPSB0aGlzLnN0YXRlO1xuXG5cblxuXHRcdHJldHVybiAoXG4gICAgICAgICAgICBcbiAgICAgICAgICAgPGRpdj4gXG5cdFx0XHQ8T3JkZXJFZGl0Rm9ybSBvblN1Ym1pdD17dGhpcy5vblN1Ym1pdH0gY29tbXVuaXR5T3B0aW9ucz17Y29tbXVuaXR5T3B0aW9uc30gaW5pdGlhbFZhbHVlcz17aW5pdGlhbFZhbHVlc30gb3JkZXJUeXBlT3B0aW9ucz17b3JkZXJUeXBlT3B0aW9uc30gb25DYW5jZWw9e3RoaXMub25DYW5jZWx9Lz5cblxuICAgICAgICAgICA8L2Rpdj5cblxuXHRcdCk7XG5cdH1cbn1cblxuXG4vLyBjb25zdCBzZWxlY3RvciA9IGZvcm1WYWx1ZVNlbGVjdG9yKCdvcmRlckVkaXRGb3JtJyk7XG5cbi8vIGZ1bmN0aW9uIG1hcFN0YXRlVG9Qcm9wcyhzdGF0ZSl7XG5cbi8vIFx0bGV0IGNvbW11bml0eXMgPSBzdGF0ZS5jb21tb25bJ2NvbW11bml0eS1jaXR5LXNlbGVjdGVkJ107XG5cbi8vIFx0aWYoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGNvbW11bml0eXMpICE9PSAnW29iamVjdCBBcnJheV0nKXtcbi8vIFx0XHRjb21tdW5pdHlzID0gW107XG4vLyBcdH1cblxuLy8gXHRjb25zdCBjb21tdW5pdHlpZCA9IHNlbGVjdG9yKHN0YXRlLCAnY29tbXVuaXR5aWQnKTtcblxuLy8gXHRsZXQgY2l0eU5hbWUgPSAnJztcbi8vIFx0Y29tbXVuaXR5cy5tYXAoZnVuY3Rpb24oaXRlbSl7XG4vLyBcdFx0aWYoaXRlbS5jb21tdW5pdHlJZCA9PSBjb21tdW5pdHlpZCl7XG4vLyBcdFx0XHRjaXR5TmFtZSA9IGl0ZW0uY2l0eU5hbWU7XG4vLyBcdFx0fVxuLy8gXHR9KTtcblxuLy8gXHRyZXR1cm4ge1xuLy8gXHRcdGNpdHlOYW1lLFxuLy8gXHRcdGluaXRpYWxWYWx1ZXM6c3RhdGUuY29tbW9uWydnZXQtc2ltcGxlLW9yZGVyJ10sXG4vLyBcdFx0Y29tbXVuaXR5cyxcbi8vICAgIFx0fTtcbi8vIH1cblxuXG5cbi8vIGV4cG9ydCBkZWZhdWx0IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzKShPcmRlckNyZWF0ZSk7XG5cbi8vIH1cblxuIl19