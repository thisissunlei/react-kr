'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.default = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _simpleAssign = require('simple-assign');

var _simpleAssign2 = _interopRequireDefault(_simpleAssign);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reduxForm = require('redux-form');

var _Redux = require('kr/Redux');

var _fetch = require('kr/Redux/Utils/fetch');

var _fetch2 = _interopRequireDefault(_fetch);

var _krUi = require('kr-ui');

var _NewCreateForm = require('./NewCreateForm');

var _NewCreateForm2 = _interopRequireDefault(_NewCreateForm);

var _ConfirmFormDetail = require('./ConfirmFormDetail');

var _ConfirmFormDetail2 = _interopRequireDefault(_ConfirmFormDetail);

require('./index.less');

var _State = require('../../State');

var _State2 = _interopRequireDefault(_State);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var JoinCreate = function (_Component) {
	_inherits(JoinCreate, _Component);

	_createClass(JoinCreate, [{
		key: 'getChildContext',
		value: function getChildContext() {
			console.log(this.props.params);
			return {
				params: this.props.params
			};
		}
	}]);

	function JoinCreate(props, context) {
		_classCallCheck(this, JoinCreate);

		var _this2 = _possibleConstructorReturn(this, (JoinCreate.__proto__ || Object.getPrototypeOf(JoinCreate)).call(this, props, context));

		_this2.openConfirmCreateDialog = _this2.openConfirmCreateDialog.bind(_this2);
		_this2.onCreateSubmit = _this2.onCreateSubmit.bind(_this2);
		_this2.onCancel = _this2.onCancel.bind(_this2);
		_this2.onConfrimSubmit = _this2.onConfrimSubmit.bind(_this2);

		_this2.state = {
			initialValues: {},
			optionValues: {},
			formValues: {},
			openConfirmCreate: false
		};
		_Redux.Store.dispatch((0, _reduxForm.reset)('joinCreateForm'));

		_this2.isConfirmSubmiting = false;
		return _this2;
	}

	_createClass(JoinCreate, [{
		key: 'onCreateSubmit',
		value: function onCreateSubmit(formValues) {
			this.setState({
				formValues: formValues
			}, function () {
				this.openConfirmCreateDialog();
			});
		}
	}, {
		key: 'onConfrimSubmit',
		value: function onConfrimSubmit() {

			if (this.isConfirmSubmiting) {
				return;
			}

			this.isConfirmSubmiting = true;

			var formValues = this.state.formValues;
			var params = this.props.params;

			formValues.stationVos = JSON.stringify(formValues.stationVos);

			var _this = this;
			_Redux.Store.dispatch(_Redux.Actions.callAPI('addOrEditEnterContract', {}, formValues)).then(function (response) {

				_this.setState({ baiscInf: response });

				_this.isConfirmSubmiting = false;

				_krUi.Notify.show([{
					message: '创建成功',
					type: 'success'
				}]);
				_State2.default.ajaxListData({ cityName: '', communityName: '', createDateBegin: '', createDateEnd: '', createrName: '', customerName: '', page: '', pageSize: '', salerName: '' });
				_State2.default.openTowAgreement = false;
				_State2.default.openOneAgreement = false;
				// window.setTimeout(function() {
				// 	window.location.href = "./#/operation/customerManage/" + params.customerId + "/order/" + params.orderId + "/agreement/join/" + response.contractId + "/detail";
				// }, 0);

			}).catch(function (err) {
				_this.isConfirmSubmiting = false;
				_krUi.Notify.show([{
					message: err.message,
					type: 'danger'
				}]);
			});

			this.openConfirmCreateDialog();
		}
	}, {
		key: 'onCancel',
		value: function onCancel() {
			//window.history.back();
			_State2.default.openTowAgreement = false;
			_State2.default.openOneAgreement = false;
		}
	}, {
		key: 'openConfirmCreateDialog',
		value: function openConfirmCreateDialog() {
			this.setState({
				openConfirmCreate: !this.state.openConfirmCreate
			});
		}
	}, {
		key: 'componentDidMount',
		value: function componentDidMount() {

			var _this = this;
			var params = this.props.params;

			var initialValues = {};
			var optionValues = {};

			_Redux.Store.dispatch(_Redux.Actions.callAPI('fina-contract-intention', {
				customerId: params.customerId,
				mainBillId: params.orderId,
				communityId: 1
			})).then(function (response) {
				initialValues.contractstate = 'UNSTART';
				initialValues.mainbillid = params.orderId;

				initialValues.leaseContact = response.customer.customerMember;
				initialValues.leaseContacttel = response.customer.customerPhone;

				initialValues.leaseAddress = response.customer.customerAddress;

				optionValues.communityAddress = response.customer.communityAddress;
				optionValues.leaseAddress = response.customer.customerAddress;
				//合同类别，枚举类型（1:意向书,2:入住协议,3:增租协议,4.续租协议,5:减租协议,6退租协议）
				initialValues.contracttype = 'ENTER';

				optionValues.fnaCorporationList = response.fnaCorporation.map(function (item, index) {
					item.value = item.id;
					item.label = item.corporationName;
					return item;
				});
				optionValues.paymentList = response.payment.map(function (item, index) {
					item.value = item.id;
					item.label = item.dicName;
					return item;
				});
				optionValues.payTypeList = response.payType.map(function (item, index) {
					item.value = item.id;
					item.label = item.dicName;
					return item;
				});

				optionValues.floorList = response.customer.floor;
				optionValues.customerName = response.customer.customerName;
				optionValues.leaseAddress = response.customer.customerAddress;
				optionValues.communityName = response.customer.communityName;
				optionValues.communityId = response.customer.communityid;
				optionValues.mainbillCommunityId = response.mainbillCommunityId || 1;

				_this.setState({
					initialValues: initialValues,
					optionValues: optionValues
				});
			}).catch(function (err) {
				_krUi.Notify.show([{
					message: '后台出错请联系管理员',
					type: 'danger'
				}]);
			});
		}
	}, {
		key: 'render',
		value: function render() {
			var _state = this.state,
			    initialValues = _state.initialValues,
			    optionValues = _state.optionValues;


			return _react2.default.createElement(
				'div',
				null,
				_react2.default.createElement(_krUi.Title, { value: '\u521B\u5EFA\u5165\u9A7B\u534F\u8BAE\u4E66_\u8D22\u52A1\u7BA1\u7406' }),
				_react2.default.createElement(
					'div',
					{ style: { marginTop: 10 } },
					_react2.default.createElement(_NewCreateForm2.default, { onSubmit: this.onCreateSubmit, initialValues: initialValues, onCancel: this.onCancel, optionValues: optionValues })
				),
				_react2.default.createElement(
					_krUi.Dialog,
					{
						title: '\u5165\u9A7B\u534F\u8BAE\u4E66',
						modal: true,
						autoScrollBodyContent: true,
						autoDetectWindowHeight: true,
						open: this.state.openConfirmCreate,
						onClose: this.openConfirmCreateDialog },
					_react2.default.createElement(_ConfirmFormDetail2.default, { detail: (0, _simpleAssign2.default)({}, this.state.formValues), onSubmit: this.onConfrimSubmit, onCancel: this.openConfirmCreateDialog, optionValues: optionValues })
				)
			);
		}
	}]);

	return JoinCreate;
}(_react.Component);

JoinCreate.childContextTypes = {
	params: _react2.default.PropTypes.object.isRequired
};
exports.default = JoinCreate;
;

var _temp = function () {
	if (typeof __REACT_HOT_LOADER__ === 'undefined') {
		return;
	}

	__REACT_HOT_LOADER__.register(JoinCreate, 'JoinCreate', '/Users/liuyihao/Code/kr-admin/src/Containers/Operation/CustomerManage/AgreementList/Join/Create/index.js');
}();

;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9Db250YWluZXJzL09wZXJhdGlvbi9DdXN0b21lck1hbmFnZS9BZ3JlZW1lbnRMaXN0L0pvaW4vQ3JlYXRlL2luZGV4LmpzIl0sIm5hbWVzIjpbIkpvaW5DcmVhdGUiLCJjb25zb2xlIiwibG9nIiwicHJvcHMiLCJwYXJhbXMiLCJjb250ZXh0Iiwib3BlbkNvbmZpcm1DcmVhdGVEaWFsb2ciLCJiaW5kIiwib25DcmVhdGVTdWJtaXQiLCJvbkNhbmNlbCIsIm9uQ29uZnJpbVN1Ym1pdCIsInN0YXRlIiwiaW5pdGlhbFZhbHVlcyIsIm9wdGlvblZhbHVlcyIsImZvcm1WYWx1ZXMiLCJvcGVuQ29uZmlybUNyZWF0ZSIsImRpc3BhdGNoIiwiaXNDb25maXJtU3VibWl0aW5nIiwic2V0U3RhdGUiLCJzdGF0aW9uVm9zIiwiSlNPTiIsInN0cmluZ2lmeSIsIl90aGlzIiwiY2FsbEFQSSIsInRoZW4iLCJyZXNwb25zZSIsImJhaXNjSW5mIiwic2hvdyIsIm1lc3NhZ2UiLCJ0eXBlIiwiYWpheExpc3REYXRhIiwiY2l0eU5hbWUiLCJjb21tdW5pdHlOYW1lIiwiY3JlYXRlRGF0ZUJlZ2luIiwiY3JlYXRlRGF0ZUVuZCIsImNyZWF0ZXJOYW1lIiwiY3VzdG9tZXJOYW1lIiwicGFnZSIsInBhZ2VTaXplIiwic2FsZXJOYW1lIiwib3BlblRvd0FncmVlbWVudCIsIm9wZW5PbmVBZ3JlZW1lbnQiLCJjYXRjaCIsImVyciIsImN1c3RvbWVySWQiLCJtYWluQmlsbElkIiwib3JkZXJJZCIsImNvbW11bml0eUlkIiwiY29udHJhY3RzdGF0ZSIsIm1haW5iaWxsaWQiLCJsZWFzZUNvbnRhY3QiLCJjdXN0b21lciIsImN1c3RvbWVyTWVtYmVyIiwibGVhc2VDb250YWN0dGVsIiwiY3VzdG9tZXJQaG9uZSIsImxlYXNlQWRkcmVzcyIsImN1c3RvbWVyQWRkcmVzcyIsImNvbW11bml0eUFkZHJlc3MiLCJjb250cmFjdHR5cGUiLCJmbmFDb3Jwb3JhdGlvbkxpc3QiLCJmbmFDb3Jwb3JhdGlvbiIsIm1hcCIsIml0ZW0iLCJpbmRleCIsInZhbHVlIiwiaWQiLCJsYWJlbCIsImNvcnBvcmF0aW9uTmFtZSIsInBheW1lbnRMaXN0IiwicGF5bWVudCIsImRpY05hbWUiLCJwYXlUeXBlTGlzdCIsInBheVR5cGUiLCJmbG9vckxpc3QiLCJmbG9vciIsImNvbW11bml0eWlkIiwibWFpbmJpbGxDb21tdW5pdHlJZCIsIm1hcmdpblRvcCIsImNoaWxkQ29udGV4dFR5cGVzIiwiUHJvcFR5cGVzIiwib2JqZWN0IiwiaXNSZXF1aXJlZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBOzs7O0FBSUE7O0FBTUE7O0FBSUE7Ozs7QUFFQTs7QUFTQTs7OztBQUNBOzs7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7OztJQUdxQkEsVTs7Ozs7b0NBT0Q7QUFDakJDLFdBQVFDLEdBQVIsQ0FBWSxLQUFLQyxLQUFMLENBQVdDLE1BQXZCO0FBQ0UsVUFBTztBQUNIQSxZQUFRLEtBQUtELEtBQUwsQ0FBV0M7QUFEaEIsSUFBUDtBQUlDOzs7QUFFTCxxQkFBWUQsS0FBWixFQUFtQkUsT0FBbkIsRUFBNEI7QUFBQTs7QUFBQSx1SEFDckJGLEtBRHFCLEVBQ2RFLE9BRGM7O0FBRzNCLFNBQUtDLHVCQUFMLEdBQStCLE9BQUtBLHVCQUFMLENBQTZCQyxJQUE3QixRQUEvQjtBQUNBLFNBQUtDLGNBQUwsR0FBc0IsT0FBS0EsY0FBTCxDQUFvQkQsSUFBcEIsUUFBdEI7QUFDQSxTQUFLRSxRQUFMLEdBQWdCLE9BQUtBLFFBQUwsQ0FBY0YsSUFBZCxRQUFoQjtBQUNBLFNBQUtHLGVBQUwsR0FBdUIsT0FBS0EsZUFBTCxDQUFxQkgsSUFBckIsUUFBdkI7O0FBRUEsU0FBS0ksS0FBTCxHQUFhO0FBQ1pDLGtCQUFlLEVBREg7QUFFWkMsaUJBQWMsRUFGRjtBQUdaQyxlQUFZLEVBSEE7QUFJWkMsc0JBQW1CO0FBSlAsR0FBYjtBQU1BLGVBQU1DLFFBQU4sQ0FBZSxzQkFBTSxnQkFBTixDQUFmOztBQUVBLFNBQUtDLGtC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QUFyTW1CYixVLENBQ1o4RSxpQixHQUFvQjtBQUNyQjFFLFNBQVEsZ0JBQU0yRSxTQUFOLENBQWdCQyxNQUFoQixDQUF1QkM7QUFEVixDO2tCQURSakYsVTs7Ozs7Ozs7K0JBQUFBLFUiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2xpdXlpaGFvL0NvZGUva3ItYWRtaW4iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcblx0Q29tcG9uZW50LFxuXHRQcm9wVHlwZXNcbn0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcblx0cmVkdXhGb3JtLFxuXHRzdWJtaXRGb3JtLFxuXHRjaGFuZ2UsXG5cdHJlc2V0XG59IGZyb20gJ3JlZHV4LWZvcm0nO1xuaW1wb3J0IHtcblx0QWN0aW9ucyxcblx0U3RvcmVcbn0gZnJvbSAna3IvUmVkdXgnO1xuaW1wb3J0IGh0dHAgZnJvbSAna3IvUmVkdXgvVXRpbHMvZmV0Y2gnO1xuXG5pbXBvcnQge1xuXHREaWFsb2csXG5cdFNlY3Rpb24sXG5cdEdyaWQsXG5cdE5vdGlmeSxcblx0QnJlYWRDcnVtYnMsXG5cdFRpdGxlLFxufSBmcm9tICdrci11aSc7XG5cbmltcG9ydCBOZXdDcmVhdGVGb3JtIGZyb20gJy4vTmV3Q3JlYXRlRm9ybSc7XG5pbXBvcnQgQ29uZmlybUZvcm1EZXRhaWwgZnJvbSAnLi9Db25maXJtRm9ybURldGFpbCc7XG5pbXBvcnQgJy4vaW5kZXgubGVzcyc7XG5pbXBvcnQgYWxsU3RhdGUgZnJvbSBcIi4uLy4uL1N0YXRlXCI7XG5cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSm9pbkNyZWF0ZSBleHRlbmRzIENvbXBvbmVudCB7XG5cdCBzdGF0aWMgY2hpbGRDb250ZXh0VHlwZXMgPSB7XG4gICAgICAgIHBhcmFtczogUmVhY3QuUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkXG4gICAgIH1cblxuXG5cblx0XHRnZXRDaGlsZENvbnRleHQoKSB7XG5cdFx0XHRjb25zb2xlLmxvZyh0aGlzLnByb3BzLnBhcmFtcywpXG5cdCAgICByZXR1cm4ge1xuXHQgICAgICAgIHBhcmFtczogdGhpcy5wcm9wcy5wYXJhbXNcblx0ICAgICAgfVxuXG5cdCAgICB9XG5cblx0Y29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcblx0XHRzdXBlcihwcm9wcywgY29udGV4dCk7XG5cblx0XHR0aGlzLm9wZW5Db25maXJtQ3JlYXRlRGlhbG9nID0gdGhpcy5vcGVuQ29uZmlybUNyZWF0ZURpYWxvZy5iaW5kKHRoaXMpO1xuXHRcdHRoaXMub25DcmVhdGVTdWJtaXQgPSB0aGlzLm9uQ3JlYXRlU3VibWl0LmJpbmQodGhpcyk7XG5cdFx0dGhpcy5vbkNhbmNlbCA9IHRoaXMub25DYW5jZWwuYmluZCh0aGlzKTtcblx0XHR0aGlzLm9uQ29uZnJpbVN1Ym1pdCA9IHRoaXMub25Db25mcmltU3VibWl0LmJpbmQodGhpcyk7XG5cblx0XHR0aGlzLnN0YXRlID0ge1xuXHRcdFx0aW5pdGlhbFZhbHVlczoge30sXG5cdFx0XHRvcHRpb25WYWx1ZXM6IHt9LFxuXHRcdFx0Zm9ybVZhbHVlczoge30sXG5cdFx0XHRvcGVuQ29uZmlybUNyZWF0ZTogZmFsc2Vcblx0XHR9XG5cdFx0U3RvcmUuZGlzcGF0Y2gocmVzZXQoJ2pvaW5DcmVhdGVGb3JtJykpO1xuXG5cdFx0dGhpcy5pc0NvbmZpcm1TdWJtaXRpbmcgPSBmYWxzZTtcblx0fVxuXG5cdG9uQ3JlYXRlU3VibWl0KGZvcm1WYWx1ZXMpIHtcblx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdGZvcm1WYWx1ZXNcblx0XHR9LCBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMub3BlbkNvbmZpcm1DcmVhdGVEaWFsb2coKTtcblx0XHR9KTtcblx0fVxuXG5cdG9uQ29uZnJpbVN1Ym1pdCgpIHtcblxuXHRcdGlmKHRoaXMuaXNDb25maXJtU3VibWl0aW5nKXtcblx0XHRcdFx0cmV0dXJuIDtcblx0XHR9XG5cblx0XHR0aGlzLmlzQ29uZmlybVN1Ym1pdGluZyA9IHRydWU7XG5cblx0XHRsZXQge1xuXHRcdFx0Zm9ybVZhbHVlc1xuXHRcdH0gPSB0aGlzLnN0YXRlO1xuXG5cdFx0bGV0IHtcblx0XHRcdHBhcmFtc1xuXHRcdH0gPSB0aGlzLnByb3BzO1xuXHRcdGZvcm1WYWx1ZXMuc3RhdGlvblZvcyA9IEpTT04uc3RyaW5naWZ5KGZvcm1WYWx1ZXMuc3RhdGlvblZvcyk7XG5cblx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXHRcdFN0b3JlLmRpc3BhdGNoKEFjdGlvbnMuY2FsbEFQSSgnYWRkT3JFZGl0RW50ZXJDb250cmFjdCcsIHt9LCBmb3JtVmFsdWVzKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuXG5cdFx0XHRfdGhpcy5zZXRTdGF0ZSh7YmFpc2NJbmY6cmVzcG9uc2V9KTtcblxuXHRcdFx0X3RoaXMuaXNDb25maXJtU3VibWl0aW5nID0gZmFsc2U7XG5cblx0XHRcdE5vdGlmeS5zaG93KFt7XG5cdFx0XHRcdG1lc3NhZ2U6ICfliJvlu7rmiJDlip8nLFxuXHRcdFx0XHR0eXBlOiAnc3VjY2VzcycsXG5cdFx0XHR9XSk7XG5cdFx0XHRhbGxTdGF0ZS5hamF4TGlzdERhdGEoe2NpdHlOYW1lOicnLGNvbW11bml0eU5hbWU6JycsY3JlYXRlRGF0ZUJlZ2luOicnLGNyZWF0ZURhdGVFbmQ6JycsY3JlYXRlck5hbWU6JycsY3VzdG9tZXJOYW1lOicnLHBhZ2U6JycscGFnZVNpemU6Jycsc2FsZXJOYW1lOicnfSlcblx0XHRcdGFsbFN0YXRlLm9wZW5Ub3dBZ3JlZW1lbnQ9ZmFsc2U7XG5cdFx0XHRhbGxTdGF0ZS5vcGVuT25lQWdyZWVtZW50PWZhbHNlO1xuXHRcdFx0Ly8gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHQvLyBcdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIuLyMvb3BlcmF0aW9uL2N1c3RvbWVyTWFuYWdlL1wiICsgcGFyYW1zLmN1c3RvbWVySWQgKyBcIi9vcmRlci9cIiArIHBhcmFtcy5vcmRlcklkICsgXCIvYWdyZWVtZW50L2pvaW4vXCIgKyByZXNwb25zZS5jb250cmFjdElkICsgXCIvZGV0YWlsXCI7XG5cdFx0XHQvLyB9LCAwKTtcblxuXG5cdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG5cdFx0XHRfdGhpcy5pc0NvbmZpcm1TdWJtaXRpbmcgPSBmYWxzZTtcblx0XHRcdE5vdGlmeS5zaG93KFt7XG5cdFx0XHRcdG1lc3NhZ2U6IGVyci5tZXNzYWdlLFxuXHRcdFx0XHR0eXBlOiAnZGFuZ2VyJyxcblx0XHRcdH1dKTtcblx0XHR9KTtcblxuXHRcdHRoaXMub3BlbkNvbmZpcm1DcmVhdGVEaWFsb2coKTtcblx0fVxuXG5cdG9uQ2FuY2VsKCkge1xuXHRcdC8vd2luZG93Lmhpc3RvcnkuYmFjaygpO1xuXHRcdGFsbFN0YXRlLm9wZW5Ub3dBZ3JlZW1lbnQ9ZmFsc2U7XG5cdFx0YWxsU3RhdGUub3Blbk9uZUFncmVlbWVudD1mYWxzZTtcblx0fVxuXG5cdG9wZW5Db25maXJtQ3JlYXRlRGlhbG9nKCkge1xuXHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0b3BlbkNvbmZpcm1DcmVhdGU6ICF0aGlzLnN0YXRlLm9wZW5Db25maXJtQ3JlYXRlXG5cdFx0fSk7XG5cdH1cblxuXHRjb21wb25lbnREaWRNb3VudCgpIHtcblxuXHRcdHZhciBfdGhpcyA9IHRoaXM7XG5cdFx0Y29uc3Qge1xuXHRcdFx0cGFyYW1zXG5cdFx0fSA9IHRoaXMucHJvcHM7XG5cdFx0bGV0IGluaXRpYWxWYWx1ZXMgPSB7fTtcblx0XHRsZXQgb3B0aW9uVmFsdWVzID0ge307XG5cblx0XHRTdG9yZS5kaXNwYXRjaChBY3Rpb25zLmNhbGxBUEkoJ2ZpbmEtY29udHJhY3QtaW50ZW50aW9uJywge1xuXHRcdFx0Y3VzdG9tZXJJZDogcGFyYW1zLmN1c3RvbWVySWQsXG5cdFx0XHRtYWluQmlsbElkOiBwYXJhbXMub3JkZXJJZCxcblx0XHRcdGNvbW11bml0eUlkOiAxXG5cdFx0fSkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblx0XHRcdGluaXRpYWxWYWx1ZXMuY29udHJhY3RzdGF0ZSA9ICdVTlNUQVJUJztcblx0XHRcdGluaXRpYWxWYWx1ZXMubWFpbmJpbGxpZCA9IHBhcmFtcy5vcmRlcklkO1xuXG5cblx0XHRcdGluaXRpYWxWYWx1ZXMubGVhc2VDb250YWN0ID0gcmVzcG9uc2UuY3VzdG9tZXIuY3VzdG9tZXJNZW1iZXI7XG5cdFx0XHRpbml0aWFsVmFsdWVzLmxlYXNlQ29udGFjdHRlbCA9IHJlc3BvbnNlLmN1c3RvbWVyLmN1c3RvbWVyUGhvbmU7XG5cblxuXHRcdFx0aW5pdGlhbFZhbHVlcy5sZWFzZUFkZHJlc3MgPSByZXNwb25zZS5jdXN0b21lci5jdXN0b21lckFkZHJlc3M7XG5cblxuXHRcdFx0b3B0aW9uVmFsdWVzLmNvbW11bml0eUFkZHJlc3MgPSByZXNwb25zZS5jdXN0b21lci5jb21tdW5pdHlBZGRyZXNzO1xuXHRcdFx0b3B0aW9uVmFsdWVzLmxlYXNlQWRkcmVzcyA9IHJlc3BvbnNlLmN1c3RvbWVyLmN1c3RvbWVyQWRkcmVzcztcblx0XHRcdC8v5ZCI5ZCM57G75Yir77yM5p6a5Li+57G75Z6L77yIMTrmhI/lkJHkuaYsMjrlhaXkvY/ljY/orq4sMzrlop7np5/ljY/orq4sNC7nu63np5/ljY/orq4sNTrlh4/np5/ljY/orq4sNumAgOenn+WNj+iuru+8iVxuXHRcdFx0aW5pdGlhbFZhbHVlcy5jb250cmFjdHR5cGUgPSAnRU5URVInO1xuXG5cdFx0XHRvcHRpb25WYWx1ZXMuZm5hQ29ycG9yYXRpb25MaXN0ID0gcmVzcG9uc2UuZm5hQ29ycG9yYXRpb24ubWFwKGZ1bmN0aW9uKGl0ZW0sIGluZGV4KSB7XG5cdFx0XHRcdGl0ZW0udmFsdWUgPSBpdGVtLmlkO1xuXHRcdFx0XHRpdGVtLmxhYmVsID0gaXRlbS5jb3Jwb3JhdGlvbk5hbWU7XG5cdFx0XHRcdHJldHVybiBpdGVtO1xuXHRcdFx0fSk7XG5cdFx0XHRvcHRpb25WYWx1ZXMucGF5bWVudExpc3QgPSByZXNwb25zZS5wYXltZW50Lm1hcChmdW5jdGlvbihpdGVtLCBpbmRleCkge1xuXHRcdFx0XHRpdGVtLnZhbHVlID0gaXRlbS5pZDtcblx0XHRcdFx0aXRlbS5sYWJlbCA9IGl0ZW0uZGljTmFtZTtcblx0XHRcdFx0cmV0dXJuIGl0ZW07XG5cdFx0XHR9KTtcblx0XHRcdG9wdGlvblZhbHVlcy5wYXlUeXBlTGlzdCA9IHJlc3BvbnNlLnBheVR5cGUubWFwKGZ1bmN0aW9uKGl0ZW0sIGluZGV4KSB7XG5cdFx0XHRcdGl0ZW0udmFsdWUgPSBpdGVtLmlkO1xuXHRcdFx0XHRpdGVtLmxhYmVsID0gaXRlbS5kaWNOYW1lO1xuXHRcdFx0XHRyZXR1cm4gaXRlbTtcblx0XHRcdH0pO1xuXG5cdFx0XHRvcHRpb25WYWx1ZXMuZmxvb3JMaXN0ID0gcmVzcG9uc2UuY3VzdG9tZXIuZmxvb3I7XG5cdFx0XHRvcHRpb25WYWx1ZXMuY3VzdG9tZXJOYW1lID0gcmVzcG9uc2UuY3VzdG9tZXIuY3VzdG9tZXJOYW1lO1xuXHRcdFx0b3B0aW9uVmFsdWVzLmxlYXNlQWRkcmVzcyA9IHJlc3BvbnNlLmN1c3RvbWVyLmN1c3RvbWVyQWRkcmVzcztcblx0XHRcdG9wdGlvblZhbHVlcy5jb21tdW5pdHlOYW1lID0gcmVzcG9uc2UuY3VzdG9tZXIuY29tbXVuaXR5TmFtZTtcblx0XHRcdG9wdGlvblZhbHVlcy5jb21tdW5pdHlJZCA9IHJlc3BvbnNlLmN1c3RvbWVyLmNvbW11bml0eWlkO1xuXHRcdFx0b3B0aW9uVmFsdWVzLm1haW5iaWxsQ29tbXVuaXR5SWQgPSByZXNwb25zZS5tYWluYmlsbENvbW11bml0eUlkIHx8IDE7XG5cblx0XHRcdF90aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0aW5pdGlhbFZhbHVlcyxcblx0XHRcdFx0b3B0aW9uVmFsdWVzLFxuXHRcdFx0fSk7XG5cblx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcblx0XHRcdE5vdGlmeS5zaG93KFt7XG5cdFx0XHRcdG1lc3NhZ2U6ICflkI7lj7Dlh7rplJnor7fogZTns7vnrqHnkIblkZgnLFxuXHRcdFx0XHR0eXBlOiAnZGFuZ2VyJyxcblx0XHRcdH1dKTtcblx0XHR9KTtcblx0fVxuXG5cblx0cmVuZGVyKCkge1xuXG5cdFx0bGV0IHtcblx0XHRcdGluaXRpYWxWYWx1ZXMsXG5cdFx0XHRvcHRpb25WYWx1ZXNcblx0XHR9ID0gdGhpcy5zdGF0ZTtcblxuXG5cdFx0cmV0dXJuIChcblxuXHRcdFx0PGRpdj5cblxuXHRcdFx0XHQ8VGl0bGUgdmFsdWU9XCLliJvlu7rlhaXpqbvljY/orq7kuaZf6LSi5Yqh566h55CGXCIvPlxuXG5cdFx0XHQ8ZGl2IHN0eWxlPXt7bWFyZ2luVG9wOjEwfX0+XG5cdFx0XHRcdFx0PE5ld0NyZWF0ZUZvcm0gb25TdWJtaXQ9e3RoaXMub25DcmVhdGVTdWJtaXR9IGluaXRpYWxWYWx1ZXM9e2luaXRpYWxWYWx1ZXN9IG9uQ2FuY2VsPXt0aGlzLm9uQ2FuY2VsfSBvcHRpb25WYWx1ZXM9e29wdGlvblZhbHVlc30vPlxuXHRcdFx0PC9kaXY+XG5cblx0XHRcdDxEaWFsb2dcblx0XHRcdFx0dGl0bGU9XCLlhaXpqbvljY/orq7kuaZcIlxuXHRcdFx0XHRtb2RhbD17dHJ1ZX1cblx0XHRcdFx0YXV0b1Njcm9sbEJvZHlDb250ZW50PXt0cnVlfVxuXHRcdFx0XHRhdXRvRGV0ZWN0V2luZG93SGVpZ2h0PXt0cnVlfVxuXHRcdFx0XHRvcGVuPXt0aGlzLnN0YXRlLm9wZW5Db25maXJtQ3JlYXRlfVxuXHRcdFx0XHRvbkNsb3NlPXt0aGlzLm9wZW5Db25maXJtQ3JlYXRlRGlhbG9nfSA+XG5cdFx0XHRcdFx0XHQ8Q29uZmlybUZvcm1EZXRhaWwgZGV0YWlsPXtPYmplY3QuYXNzaWduKHt9LHRoaXMuc3RhdGUuZm9ybVZhbHVlcyl9IG9uU3VibWl0PXt0aGlzLm9uQ29uZnJpbVN1Ym1pdH0gb25DYW5jZWw9e3RoaXMub3BlbkNvbmZpcm1DcmVhdGVEaWFsb2d9IG9wdGlvblZhbHVlcz17b3B0aW9uVmFsdWVzfS8+XG5cdFx0XHQgIDwvRGlhbG9nPlxuXHRcdDwvZGl2PlxuXHRcdCk7XG5cdH1cbn1cbiJdfQ==