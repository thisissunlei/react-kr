{"version":3,"sources":["src/Redux/Middlewares/callAPIMiddleware.js"],"names":["polyfill","callAPIMiddleware","dispatch","getState","next","action","types","apiName","request","payload","Array","isArray","length","every","type","requestType","successType","failureType","name","resolve","reject","then","response","catch","err","error","module","exports"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,qBAAWA,QAAX;;AAGA,SAASC,iBAAT,OAA+C;AAAA,KAAnBC,QAAmB,QAAnBA,QAAmB;AAAA,KAAVC,QAAU,QAAVA,QAAU;;;AAE9C,QAAO,UAASC,IAAT,EAAc;;AAEpB,SAAO,UAASC,MAAT,EAAgB;AAAA,OAGrBC,KAHqB,GAOlBD,MAPkB,CAGrBC,KAHqB;AAAA,OAIrBC,OAJqB,GAOlBF,MAPkB,CAIrBE,OAJqB;AAAA,OAKrBC,OALqB,GAOlBH,MAPkB,CAKrBG,OALqB;AAAA,yBAOlBH,MAPkB,CAMrBI,OANqB;AAAA,OAMrBA,OANqB,mCAMZ,EANY;;;AAStB,OAAG,CAACH,KAAJ,EAAU;AACT,WAAOF,KAAKC,MAAL,CAAP;AACA;;AAED,OAAG,CAACK,MAAMC,OAAN,CAAcL,KAAd,CAAD,IACFA,MAAMM,MAAN,KAAgB,CADd,IAEF,CAACN,MAAMO,KAAN,CAAY;AAAA,WAAQ,OAAOC,IAAP,KAAgB,QAAxB;AAAA,IAAZ,CAFF,EAEgD;AAC9C;AACD;;AAED,OAAG,CAACP,OAAJ,EAAY;AACX;AACA;;AArBqB,+BAuBwBD,KAvBxB;AAAA,OAuBfS,WAvBe;AAAA,OAuBHC,WAvBG;AAAA,OAuBSC,WAvBT;;AA2BtB;;AAEAf,YAAS,4BAAc,EAAd,EAAiBO,OAAjB,EAAyB;AACjCK,UAAKC,WAD4B;AAEjCG,UAAKX;AAF4B,IAAzB,CAAT;;AAKA,UAAO,8BAAY,UAACY,OAAD,EAAUC,MAAV,EAAqB;;AAGvC,oBAAKZ,OAAL,CAAaD,OAAb,EAAqBC,OAArB,EAA6BC,OAA7B,EAAsCY,IAAtC,CAA2C,UAASC,QAAT,EAAkB;;AAE5DpB,cAAS,4BAAc,EAAd,EAAiBO,OAAjB,EAAyB;AACjCK,YAAKE,WAD4B;AAEjCM,gBAASA,QAFwB;AAGjCJ,YAAKX;AAH4B,MAAzB,CAAT;;AAMAY,aAAQG,QAAR;AAEA,KAVD,EAUGC,KAVH,CAUS,UAASC,GAAT,EAAa;;AAErBtB,cAAS,4BAAc,EAAd,EAAiBO,OAAjB,EAAyB;AACjCK,YAAKG,WAD4B;AAEjCQ,aAAMD,GAF2B;AAGjCN,YAAKX;AAH4B,MAAzB,CAAT;AAKAa,YAAOI,GAAP;AACA,KAlBD;AAmBA,IAtBM,CAAP;AAwBA,GA1DD;AA4DA,EA9DD;AAiEA;;AAEDE,OAAOC,OAAP,GAAiB1B,iBAAjB;;;;;;;;+BArESA,iB","file":"callAPIMiddleware.js","sourceRoot":"/Users/tmac_zc/Code/kr-admin","sourcesContent":["import http from 'kr/Redux/Utils/fetch';\nimport Promise from 'promise-polyfill';\nimport ES6Promise from 'es6-promise';\n\nES6Promise.polyfill();\n\n\nfunction callAPIMiddleware({dispatch,getState}){\n\n\treturn function(next){\n\n\t\treturn function(action){\n\n\t\t\tconst {\n\t\t\t\ttypes,\n\t\t\t\tapiName,\n\t\t\t\trequest,\n\t\t\t\tpayload= {}\n\t\t\t} = action;\n\n\t\t\tif(!types){\n\t\t\t\treturn next(action);\n\t\t\t}\n\n\t\t\tif(!Array.isArray(types) ||\n\t\t\t\ttypes.length !==3 ||\n\t\t\t\t!types.every(type => typeof type === 'string')){\n\t\t\t\t\t//throw new Error('参数有问题');\n\t\t\t}\n\n\t\t\tif(!apiName){\n\t\t\t\t//throw new Error('参数有问题');\n\t\t\t}\n\n\t\t\tconst [requestType,successType,failureType] = types;\n\n\n\n\t\t\t//获取数据\n\n\t\t\tdispatch(Object.assign({},payload,{\n\t\t\t\ttype:requestType,\n\t\t\t\tname:apiName\n\t\t\t}));\n\n\t\t\treturn new Promise((resolve, reject) => {\n\n\n\t\t\t\thttp.request(apiName,request,payload).then(function(response){\n\t\t\t\t\t\n\t\t\t\t\tdispatch(Object.assign({},payload,{\n\t\t\t\t\t\ttype:successType,\n\t\t\t\t\t\tresponse:response,\n\t\t\t\t\t\tname:apiName\n\t\t\t\t\t}));\n\n\t\t\t\t\tresolve(response);\n\n\t\t\t\t}).catch(function(err){\n\n\t\t\t\t\tdispatch(Object.assign({},payload,{\n\t\t\t\t\t\ttype:failureType,\n\t\t\t\t\t\terror:err,\n\t\t\t\t\t\tname:apiName\n\t\t\t\t\t}))\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t\t});\n\n\t\t}\n\n\t}\n\n\n}\n\nmodule.exports = callAPIMiddleware;\n"]}